From 724e652a8a6501f86e22bb24c42577ceab02f3a9 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 14:42:10 +0200
Subject: [PATCH 001/123] Step 1.3: Added build configuration for Ionic app
 scripts

---
 package.json | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/package.json b/package.json
index e38f7f9..7e219c3 100644
--- a/package.json
+++ b/package.json
@@ -49,5 +49,8 @@
       "locator": "ios"
     }
   ],
-  "description": "ionic2-meteor-messenger: An Ionic project"
+  "description": "ionic2-meteor-messenger: An Ionic project",
+  "config": {
+    "ionic_webpack": "./config/webpack.config.js"
+  }
 }
-- 
2.9.3 (Apple Git-75)


From 17f056b6404693545bb13002cc8caa3f135f9270 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 14:43:38 +0200
Subject: [PATCH 002/123] Step 1.4: Added webpack base file

---
 config/webpack.config.js | 61 ++++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 61 insertions(+)
 create mode 100644 config/webpack.config.js

diff --git a/config/webpack.config.js b/config/webpack.config.js
new file mode 100644
index 0000000..5053a0f
--- /dev/null
+++ b/config/webpack.config.js
@@ -0,0 +1,61 @@
+var path = require('path');
+var webpack = require('webpack');
+
+
+
+
+// for prod builds, we have already done AoT and AoT writes to disk
+// so read the JS file from disk
+// for dev buids, we actually want to pass in .ts files since we
+// don't have .js files on disk, they're exclusively in memory
+
+function getEntryPoint() {
+  if (process.env.IONIC_ENV === 'prod') {
+    return '{{TMP}}/app/main.prod.js';
+  }
+  return '{{TMP}}/app/main.dev.js';
+}
+
+function getPlugins() {
+  if (process.env.IONIC_ENV === 'prod') {
+    return [
+      // This helps ensure the builds are consistent if source hasn't changed:
+      new webpack.optimize.OccurrenceOrderPlugin(),
+      // Try to dedupe duplicated modules, if any:
+      // Add this back in when Angular fixes the issue: https://github.com/angular/angular-cli/issues/1587
+      //new DedupePlugin()
+    ];
+  }
+  return [];
+}
+
+module.exports = {
+  entry: getEntryPoint(),
+  output: {
+    path: '{{BUILD}}',
+    filename: 'main.js'
+  },
+
+  resolve: {
+    extensions: ['.js', '.json']
+  },
+
+  module: {
+    loaders: [
+      {
+        test: /\.json$/,
+        loader: 'json'
+      }
+    ]
+  },
+
+  plugins: getPlugins(),
+
+  // Some libraries import Node modules but don't use them in the browser.
+  // Tell Webpack to provide empty mocks for them so importing them works.
+  node: {
+    fs: 'empty',
+    net: 'empty',
+    tls: 'empty'
+  }
+};
-- 
2.9.3 (Apple Git-75)


From c7be25c030263439df629d477b090b5c5eb16c6a Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 17:39:11 +0200
Subject: [PATCH 003/123] Step 1.5: Updated webpack file

---
 config/webpack.config.js | 17 +++++++++++------
 1 file changed, 11 insertions(+), 6 deletions(-)

diff --git a/config/webpack.config.js b/config/webpack.config.js
index 5053a0f..3986ea5 100644
--- a/config/webpack.config.js
+++ b/config/webpack.config.js
@@ -1,9 +1,6 @@
 var path = require('path');
 var webpack = require('webpack');
 
-
-
-
 // for prod builds, we have already done AoT and AoT writes to disk
 // so read the JS file from disk
 // for dev buids, we actually want to pass in .ts files since we
@@ -26,7 +23,11 @@ function getPlugins() {
       //new DedupePlugin()
     ];
   }
-  return [];
+  return [
+    new webpack.ProvidePlugin({
+      __extends: 'typescript-extends'
+    })
+  ];
 }
 
 module.exports = {
@@ -37,7 +38,10 @@ module.exports = {
   },
 
   resolve: {
-    extensions: ['.js', '.json']
+    extensions: ['.js', '.json', '.ts'],
+    alias: {
+      'api': path.resolve(__dirname, '../api')
+    }
   },
 
   module: {
@@ -56,6 +60,7 @@ module.exports = {
   node: {
     fs: 'empty',
     net: 'empty',
-    tls: 'empty'
+    tls: 'empty',
+    __dirname: true
   }
 };
-- 
2.9.3 (Apple Git-75)


From 9153aa10a21fca82dd9f94f142040c1dc5c4a7d3 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 17:39:59 +0200
Subject: [PATCH 004/123] Step 1.6: Added typescript-extends package

---
 package.json | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/package.json b/package.json
index 7e219c3..1f2b431 100644
--- a/package.json
+++ b/package.json
@@ -31,7 +31,8 @@
   },
   "devDependencies": {
     "@ionic/app-scripts": "0.0.38",
-    "typescript": "2.0.6"
+    "typescript": "2.0.6",
+    "typescript-extends": "^1.0.1"
   },
   "cordovaPlugins": [
     "cordova-plugin-device",
-- 
2.9.3 (Apple Git-75)


From eae7423d5018f7cedcbc2fd9dc4e164396a1d2d7 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 17:40:24 +0200
Subject: [PATCH 005/123] Step 1.7: Updated typscript compiler config

---
 tsconfig.json | 20 +++++++++++---------
 1 file changed, 11 insertions(+), 9 deletions(-)

diff --git a/tsconfig.json b/tsconfig.json
index 2e450f9..715dd97 100644
--- a/tsconfig.json
+++ b/tsconfig.json
@@ -1,17 +1,19 @@
 {
   "compilerOptions": {
-    "allowSyntheticDefaultImports": true,
-    "declaration": false,
-    "emitDecoratorMetadata": true,
-    "experimentalDecorators": true,
+    "target": "es5",
     "lib": [
-      "dom",
-      "es2015"
+      "es6",
+      "dom"
     ],
-    "module": "es2015",
+    "module": "commonjs",
     "moduleResolution": "node",
+    "experimentalDecorators": true,
+    "emitDecoratorMetadata": true,
     "sourceMap": true,
-    "target": "es5"
+    "noImplicitAny": false,
+    "declaration": false,
+    "skipLibCheck": true,
+    "stripInternal": true
   },
   "include": [
     "src/**/*.ts"
@@ -23,4 +25,4 @@
   "atom": {
     "rewriteTsconfig": false
   }
-}
\ No newline at end of file
+}
-- 
2.9.3 (Apple Git-75)


From 791d091f0a4dfe187fc20e96834c17ac750e9df3 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 14:49:55 +0200
Subject: [PATCH 006/123] Step 2.1: Remove irrelevant pages

---
 src/app/app.module.ts          |  9 ---------
 src/pages/about/about.html     | 11 -----------
 src/pages/about/about.scss     |  3 ---
 src/pages/about/about.ts       | 15 ---------------
 src/pages/contact/contact.html | 17 -----------------
 src/pages/contact/contact.scss |  3 ---
 src/pages/contact/contact.ts   | 15 ---------------
 src/pages/home/home.html       | 17 -----------------
 src/pages/home/home.scss       |  3 ---
 src/pages/home/home.ts         | 15 ---------------
 10 files changed, 108 deletions(-)
 delete mode 100644 src/pages/about/about.html
 delete mode 100644 src/pages/about/about.scss
 delete mode 100644 src/pages/about/about.ts
 delete mode 100644 src/pages/contact/contact.html
 delete mode 100644 src/pages/contact/contact.scss
 delete mode 100644 src/pages/contact/contact.ts
 delete mode 100644 src/pages/home/home.html
 delete mode 100644 src/pages/home/home.scss
 delete mode 100644 src/pages/home/home.ts

diff --git a/src/app/app.module.ts b/src/app/app.module.ts
index 36bcff0..c4c5356 100644
--- a/src/app/app.module.ts
+++ b/src/app/app.module.ts
@@ -1,17 +1,11 @@
 import { NgModule } from '@angular/core';
 import { IonicApp, IonicModule } from 'ionic-angular';
 import { MyApp } from './app.component';
-import { AboutPage } from '../pages/about/about';
-import { ContactPage } from '../pages/contact/contact';
-import { HomePage } from '../pages/home/home';
 import { TabsPage } from '../pages/tabs/tabs';
 
 @NgModule({
   declarations: [
     MyApp,
-    AboutPage,
-    ContactPage,
-    HomePage,
     TabsPage
   ],
   imports: [
@@ -20,9 +14,6 @@ import { TabsPage } from '../pages/tabs/tabs';
   bootstrap: [IonicApp],
   entryComponents: [
     MyApp,
-    AboutPage,
-    ContactPage,
-    HomePage,
     TabsPage
   ],
   providers: []
diff --git a/src/pages/about/about.html b/src/pages/about/about.html
deleted file mode 100644
index 2763c93..0000000
--- a/src/pages/about/about.html
+++ /dev/null
@@ -1,11 +0,0 @@
-<ion-header>
-  <ion-navbar>
-    <ion-title>
-      About
-    </ion-title>
-  </ion-navbar>
-</ion-header>
-
-<ion-content padding>
-
-</ion-content>
diff --git a/src/pages/about/about.scss b/src/pages/about/about.scss
deleted file mode 100644
index 639956d..0000000
--- a/src/pages/about/about.scss
+++ /dev/null
@@ -1,3 +0,0 @@
-page-about {
-
-}
diff --git a/src/pages/about/about.ts b/src/pages/about/about.ts
deleted file mode 100644
index 1b4c5ad..0000000
--- a/src/pages/about/about.ts
+++ /dev/null
@@ -1,15 +0,0 @@
-import { Component } from '@angular/core';
-
-import { NavController } from 'ionic-angular';
-
-@Component({
-  selector: 'page-about',
-  templateUrl: 'about.html'
-})
-export class AboutPage {
-
-  constructor(public navCtrl: NavController) {
-
-  }
-
-}
diff --git a/src/pages/contact/contact.html b/src/pages/contact/contact.html
deleted file mode 100644
index c6ce324..0000000
--- a/src/pages/contact/contact.html
+++ /dev/null
@@ -1,17 +0,0 @@
-<ion-header>
-  <ion-navbar>
-    <ion-title>
-      Contact
-    </ion-title>
-  </ion-navbar>
-</ion-header>
-
-<ion-content>
-  <ion-list>
-    <ion-list-header>Follow us on Twitter</ion-list-header>
-    <ion-item>
-      <ion-icon name="ionic" item-left></ion-icon>
-      @ionicframework
-    </ion-item>
-  </ion-list>
-</ion-content>
diff --git a/src/pages/contact/contact.scss b/src/pages/contact/contact.scss
deleted file mode 100644
index 13d4440..0000000
--- a/src/pages/contact/contact.scss
+++ /dev/null
@@ -1,3 +0,0 @@
-page-contact {
-
-}
diff --git a/src/pages/contact/contact.ts b/src/pages/contact/contact.ts
deleted file mode 100644
index a344720..0000000
--- a/src/pages/contact/contact.ts
+++ /dev/null
@@ -1,15 +0,0 @@
-import { Component } from '@angular/core';
-
-import { NavController } from 'ionic-angular';
-
-@Component({
-  selector: 'page-contact',
-  templateUrl: 'contact.html'
-})
-export class ContactPage {
-
-  constructor(public navCtrl: NavController) {
-
-  }
-
-}
diff --git a/src/pages/home/home.html b/src/pages/home/home.html
deleted file mode 100644
index 485991e..0000000
--- a/src/pages/home/home.html
+++ /dev/null
@@ -1,17 +0,0 @@
-<ion-header>
-  <ion-navbar>
-    <ion-title>Home</ion-title>
-  </ion-navbar>
-</ion-header>
-
-<ion-content padding>
-  <h2>Welcome to Ionic!</h2>
-  <p>
-    This starter project comes with simple tabs-based layout for apps
-    that are going to primarily use a Tabbed UI.
-  </p>
-  <p>
-    Take a look at the <code>src/pages/</code> directory to add or change tabs,
-    update any existing page or create new pages.
-  </p>
-</ion-content>
diff --git a/src/pages/home/home.scss b/src/pages/home/home.scss
deleted file mode 100644
index d4cc8fc..0000000
--- a/src/pages/home/home.scss
+++ /dev/null
@@ -1,3 +0,0 @@
-page-home {
-
-}
diff --git a/src/pages/home/home.ts b/src/pages/home/home.ts
deleted file mode 100644
index e9f7e6a..0000000
--- a/src/pages/home/home.ts
+++ /dev/null
@@ -1,15 +0,0 @@
-import { Component } from '@angular/core';
-
-import { NavController } from 'ionic-angular';
-
-@Component({
-  selector: 'page-home',
-  templateUrl: 'home.html'
-})
-export class HomePage {
-
-  constructor(public navCtrl: NavController) {
-
-  }
-
-}
-- 
2.9.3 (Apple Git-75)


From 2357bfe9b3fee7709061db76b70ebc646a378626 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 14:50:46 +0200
Subject: [PATCH 007/123] Step 2.2: Removed tabs from the Component

---
 src/pages/tabs/tabs.ts | 10 ----------
 1 file changed, 10 deletions(-)

diff --git a/src/pages/tabs/tabs.ts b/src/pages/tabs/tabs.ts
index a95cdf4..5d241c9 100644
--- a/src/pages/tabs/tabs.ts
+++ b/src/pages/tabs/tabs.ts
@@ -1,19 +1,9 @@
 import { Component } from '@angular/core';
 
-import { HomePage } from '../home/home';
-import { AboutPage } from '../about/about';
-import { ContactPage } from '../contact/contact';
-
 @Component({
   templateUrl: 'tabs.html'
 })
 export class TabsPage {
-  // this tells the tabs component which Pages
-  // should be each tab's root Page
-  tab1Root: any = HomePage;
-  tab2Root: any = AboutPage;
-  tab3Root: any = ContactPage;
-
   constructor() {
 
   }
-- 
2.9.3 (Apple Git-75)


From 01fc794c9241aa8a67637749cf7fa5943c18c626 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 14:50:53 +0200
Subject: [PATCH 008/123] Step 2.3: Edit tabs template to contain the necessary
 tabs

---
 src/pages/tabs/tabs.html | 7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

diff --git a/src/pages/tabs/tabs.html b/src/pages/tabs/tabs.html
index fa3921a..bca6a7e 100644
--- a/src/pages/tabs/tabs.html
+++ b/src/pages/tabs/tabs.html
@@ -1,5 +1,6 @@
 <ion-tabs>
-  <ion-tab [root]="tab1Root" tabTitle="Home" tabIcon="home"></ion-tab>
-  <ion-tab [root]="tab2Root" tabTitle="About" tabIcon="information-circle"></ion-tab>
-  <ion-tab [root]="tab3Root" tabTitle="Contact" tabIcon="contacts"></ion-tab>
+  <ion-tab tabIcon="chatboxes"></ion-tab>
+  <ion-tab tabIcon="contacts"></ion-tab>
+  <ion-tab tabIcon="star"></ion-tab>
+  <ion-tab tabIcon="clock"></ion-tab>
 </ion-tabs>
-- 
2.9.3 (Apple Git-75)


From 3c870be621b8ac673ad2b5553fc3ca4d4564bc87 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 15:02:01 +0200
Subject: [PATCH 009/123] Step 2.4: Added moment

---
 package.json | 1 +
 1 file changed, 1 insertion(+)

diff --git a/package.json b/package.json
index 1f2b431..0ace12c 100644
--- a/package.json
+++ b/package.json
@@ -26,6 +26,7 @@
     "ionic-angular": "2.0.0-rc.1",
     "ionic-native": "2.2.3",
     "ionicons": "3.0.0",
+    "moment": "^2.15.2",
     "rxjs": "5.0.0-beta.12",
     "zone.js": "0.6.21"
   },
-- 
2.9.3 (Apple Git-75)


From 8d74ef5cc6f011451942e650bb671a858f542eae Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 15:02:20 +0200
Subject: [PATCH 010/123] Step 2.5: Added ChatsPage view

---
 src/pages/chats/chats.html | 11 +++++++++++
 1 file changed, 11 insertions(+)
 create mode 100644 src/pages/chats/chats.html

diff --git a/src/pages/chats/chats.html b/src/pages/chats/chats.html
new file mode 100644
index 0000000..ca3c3ec
--- /dev/null
+++ b/src/pages/chats/chats.html
@@ -0,0 +1,11 @@
+<ion-header>
+  <ion-navbar>
+    <ion-title>
+      Chats
+    </ion-title>
+  </ion-navbar>
+</ion-header>
+
+<ion-content padding>
+  Hello!
+</ion-content>
-- 
2.9.3 (Apple Git-75)


From 3a69a6fbb87eae22eb1781bc1013a8af8caaeba0 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 15:02:30 +0200
Subject: [PATCH 011/123] Step 2.6: Added ChatsPage Component

---
 src/pages/chats/chats.ts | 64 ++++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 64 insertions(+)
 create mode 100644 src/pages/chats/chats.ts

diff --git a/src/pages/chats/chats.ts b/src/pages/chats/chats.ts
new file mode 100644
index 0000000..8744db8
--- /dev/null
+++ b/src/pages/chats/chats.ts
@@ -0,0 +1,64 @@
+import * as moment from 'moment';
+import { Component } from '@angular/core';
+import { Observable } from "rxjs";
+
+@Component({
+  templateUrl: 'chats.html'
+})
+export class ChatsPage {
+  chats: Observable<any[]>;
+
+  constructor() {
+    this.chats = this.findChats();
+  }
+
+  private findChats(): Observable<any[]> {
+    return Observable.of([
+      {
+        _id: '0',
+        title: 'Ethan Gonzalez',
+        picture: 'https://randomuser.me/api/portraits/thumb/men/1.jpg',
+        lastMessage: {
+          content: 'You on your way?',
+          createdAt: moment().subtract(1, 'hours').toDate()
+        }
+      },
+      {
+        _id: '1',
+        title: 'Bryan Wallace',
+        picture: 'https://randomuser.me/api/portraits/thumb/lego/1.jpg',
+        lastMessage: {
+          content: 'Hey, it\'s me',
+          createdAt: moment().subtract(2, 'hours').toDate()
+        }
+      },
+      {
+        _id: '2',
+        title: 'Avery Stewart',
+        picture: 'https://randomuser.me/api/portraits/thumb/women/1.jpg',
+        lastMessage: {
+          content: 'I should buy a boat',
+          createdAt: moment().subtract(1, 'days').toDate()
+        }
+      },
+      {
+        _id: '3',
+        title: 'Katie Peterson',
+        picture: 'https://randomuser.me/api/portraits/thumb/women/2.jpg',
+        lastMessage: {
+          content: 'Look at my mukluks!',
+          createdAt: moment().subtract(4, 'days').toDate()
+        }
+      },
+      {
+        _id: '4',
+        title: 'Ray Edwards',
+        picture: 'https://randomuser.me/api/portraits/thumb/men/2.jpg',
+        lastMessage: {
+          content: 'This is wicked good ice cream.',
+          createdAt: moment().subtract(2, 'weeks').toDate()
+        }
+      }
+    ]);
+  }
+}
-- 
2.9.3 (Apple Git-75)


From 33bc73f83059510526df595960d44460adb99f6c Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 15:02:47 +0200
Subject: [PATCH 012/123] Step 2.7: Added ChatsPage to the module definition

---
 src/app/app.module.ts | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/src/app/app.module.ts b/src/app/app.module.ts
index c4c5356..4d5217f 100644
--- a/src/app/app.module.ts
+++ b/src/app/app.module.ts
@@ -2,10 +2,12 @@ import { NgModule } from '@angular/core';
 import { IonicApp, IonicModule } from 'ionic-angular';
 import { MyApp } from './app.component';
 import { TabsPage } from '../pages/tabs/tabs';
+import { ChatsPage } from "../pages/chats/chats";
 
 @NgModule({
   declarations: [
     MyApp,
+    ChatsPage,
     TabsPage
   ],
   imports: [
@@ -14,6 +16,7 @@ import { TabsPage } from '../pages/tabs/tabs';
   bootstrap: [IonicApp],
   entryComponents: [
     MyApp,
+    ChatsPage,
     TabsPage
   ],
   providers: []
-- 
2.9.3 (Apple Git-75)


From 6d72f1ba871aa89dd09151370ead16b10f95a9db Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 15:03:11 +0200
Subject: [PATCH 013/123] Step 2.8: Added chats tab root

---
 src/pages/tabs/tabs.ts | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/src/pages/tabs/tabs.ts b/src/pages/tabs/tabs.ts
index 5d241c9..ce05bbe 100644
--- a/src/pages/tabs/tabs.ts
+++ b/src/pages/tabs/tabs.ts
@@ -1,9 +1,12 @@
 import { Component } from '@angular/core';
+import { ChatsPage } from "../chats/chats";
 
 @Component({
   templateUrl: 'tabs.html'
 })
 export class TabsPage {
+  chatsTab = ChatsPage;
+
   constructor() {
 
   }
-- 
2.9.3 (Apple Git-75)


From c2874b89369823e4a1676e2860de5a16019573a5 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 15:03:34 +0200
Subject: [PATCH 014/123] Step 2.9: Added root to the tab element

---
 src/pages/tabs/tabs.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/pages/tabs/tabs.html b/src/pages/tabs/tabs.html
index bca6a7e..c361256 100644
--- a/src/pages/tabs/tabs.html
+++ b/src/pages/tabs/tabs.html
@@ -1,5 +1,5 @@
 <ion-tabs>
-  <ion-tab tabIcon="chatboxes"></ion-tab>
+  <ion-tab [root]="chatsTab" tabIcon="chatboxes"></ion-tab>
   <ion-tab tabIcon="contacts"></ion-tab>
   <ion-tab tabIcon="star"></ion-tab>
   <ion-tab tabIcon="clock"></ion-tab>
-- 
2.9.3 (Apple Git-75)


From 6c5f398aae0b58aa07247f5facbf141e0b186ce1 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 15:09:36 +0200
Subject: [PATCH 015/123] Step 2.10: Added chat and message models

---
 models/whatsapp-models.d.ts | 15 +++++++++++++++
 1 file changed, 15 insertions(+)
 create mode 100644 models/whatsapp-models.d.ts

diff --git a/models/whatsapp-models.d.ts b/models/whatsapp-models.d.ts
new file mode 100644
index 0000000..2f4b40f
--- /dev/null
+++ b/models/whatsapp-models.d.ts
@@ -0,0 +1,15 @@
+declare module 'api/models/whatsapp-models' {
+  interface Chat {
+    _id?: string;
+    title?: string;
+    picture?: string;
+    lastMessage?: Message;
+  }
+
+  interface Message {
+    _id?: string;
+    chatId?: string;
+    content?: string;
+    createdAt?: Date;
+  }
+}
-- 
2.9.3 (Apple Git-75)


From d8b4a04b643d5cc0a2d7de4be6b28006c1a50437 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 17:49:33 +0200
Subject: [PATCH 016/123] Step 2.11: Added models typings into the config

---
 tsconfig.json | 1 +
 1 file changed, 1 insertion(+)

diff --git a/tsconfig.json b/tsconfig.json
index 715dd97..d7b2d75 100644
--- a/tsconfig.json
+++ b/tsconfig.json
@@ -16,6 +16,7 @@
     "stripInternal": true
   },
   "include": [
+    "models/whatsapp-models.d.ts",
     "src/**/*.ts"
   ],
   "exclude": [
-- 
2.9.3 (Apple Git-75)


From 85c1759a2fce1e24ef3375d8761f4193b7d249c3 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 15:10:24 +0200
Subject: [PATCH 017/123] Step 2.12: Use Chat model in ChatsPage

---
 src/pages/chats/chats.ts | 5 +++--
 1 file changed, 3 insertions(+), 2 deletions(-)

diff --git a/src/pages/chats/chats.ts b/src/pages/chats/chats.ts
index 8744db8..ddf9164 100644
--- a/src/pages/chats/chats.ts
+++ b/src/pages/chats/chats.ts
@@ -1,18 +1,19 @@
 import * as moment from 'moment';
 import { Component } from '@angular/core';
 import { Observable } from "rxjs";
+import { Chat } from "api/models/whatsapp-models";
 
 @Component({
   templateUrl: 'chats.html'
 })
 export class ChatsPage {
-  chats: Observable<any[]>;
+  chats: Observable<Chat[]>;
 
   constructor() {
     this.chats = this.findChats();
   }
 
-  private findChats(): Observable<any[]> {
+  private findChats(): Observable<Chat[]> {
     return Observable.of([
       {
         _id: '0',
-- 
2.9.3 (Apple Git-75)


From 79e30666a137c3fab1d14ec8198e12414e3b9edd Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 15:20:40 +0200
Subject: [PATCH 018/123] Step 2.13: Added theme color definition

---
 src/theme/variables.scss | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/src/theme/variables.scss b/src/theme/variables.scss
index 49e7c6b..b9e42a3 100644
--- a/src/theme/variables.scss
+++ b/src/theme/variables.scss
@@ -27,7 +27,8 @@ $colors: (
   secondary:  #32db64,
   danger:     #f53d3d,
   light:      #f4f4f4,
-  dark:       #222
+  dark:       #222,
+  whatsapp:   #075E54
 );
 
 
-- 
2.9.3 (Apple Git-75)


From da7d5fe41bc654fb2bc67a1632e1ea2dc030fddd Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 15:21:10 +0200
Subject: [PATCH 019/123] Step 2.14: Added chats page view with a list of chats

---
 src/pages/chats/chats.html | 27 ++++++++++++++++++++++++---
 1 file changed, 24 insertions(+), 3 deletions(-)

diff --git a/src/pages/chats/chats.html b/src/pages/chats/chats.html
index ca3c3ec..baa7c5d 100644
--- a/src/pages/chats/chats.html
+++ b/src/pages/chats/chats.html
@@ -1,11 +1,32 @@
 <ion-header>
-  <ion-navbar>
+  <ion-navbar color="whatsapp">
     <ion-title>
       Chats
     </ion-title>
+    <ion-buttons end>
+      <button ion-button icon-only class="add-chat-button">
+        <ion-icon name="person-add"></ion-icon>
+      </button>
+      <button ion-button icon-only class="options-button">
+        <ion-icon name="more"></ion-icon>
+      </button>
+    </ion-buttons>
   </ion-navbar>
 </ion-header>
 
-<ion-content padding>
-  Hello!
+<ion-content padding class="chats-page-content">
+  <ion-list class="chats">
+    <button ion-item *ngFor="let chat of chats | async" class="chat">
+      <img class="chat-picture" [src]="chat.picture">
+
+      <div class="chat-info">
+        <h2 class="chat-title">{{chat.title}}</h2>
+
+        <span *ngIf="chat.lastMessage" class="last-message">
+          <p class="last-message-content">{{chat.lastMessage.content}}</p>
+          <span class="last-message-timestamp">{{chat.lastMessage.createdAt}}</span>
+        </span>
+      </div>
+    </button>
+  </ion-list>
 </ion-content>
-- 
2.9.3 (Apple Git-75)


From 382c3e5d08050035e56bd4d3b84048e528974433 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 15:21:19 +0200
Subject: [PATCH 020/123] Step 2.15: Added some styles

---
 src/pages/chats/chats.scss | 20 ++++++++++++++++++++
 1 file changed, 20 insertions(+)
 create mode 100644 src/pages/chats/chats.scss

diff --git a/src/pages/chats/chats.scss b/src/pages/chats/chats.scss
new file mode 100644
index 0000000..7b6878c
--- /dev/null
+++ b/src/pages/chats/chats.scss
@@ -0,0 +1,20 @@
+.chats-page-content {
+  .chat-picture {
+    border-radius: 50%;
+    width: 50px;
+    float: left;
+  }
+
+  .chat-info {
+    float: left;
+    margin: 10px 0 0 20px;
+
+    .last-message-timestamp {
+      position: absolute;
+      top: 10px;
+      right: 10px;
+      font-size: 14px;
+      color: #9A9898;
+    }
+  }
+}
-- 
2.9.3 (Apple Git-75)


From 50cb853d605060dd1abaf28cb30a2b493f01b838 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 15:39:29 +0200
Subject: [PATCH 021/123] Step 2.16: Added angular2-moment package

---
 package.json | 1 +
 1 file changed, 1 insertion(+)

diff --git a/package.json b/package.json
index 0ace12c..bc7802a 100644
--- a/package.json
+++ b/package.json
@@ -23,6 +23,7 @@
     "@angular/platform-browser-dynamic": "2.0.0",
     "@angular/platform-server": "2.0.0",
     "@ionic/storage": "1.1.6",
+    "angular2-moment": "^1.0.0-beta.6",
     "ionic-angular": "2.0.0-rc.1",
     "ionic-native": "2.2.3",
     "ionicons": "3.0.0",
-- 
2.9.3 (Apple Git-75)


From fc4006f996cf5529a9fe124d8cd5a49d0de5f05a Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 15:40:09 +0200
Subject: [PATCH 022/123] Step 2.17: Import MomentModule into the module
 definition

---
 src/app/app.module.ts | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/src/app/app.module.ts b/src/app/app.module.ts
index 4d5217f..f0f2cb5 100644
--- a/src/app/app.module.ts
+++ b/src/app/app.module.ts
@@ -3,6 +3,7 @@ import { IonicApp, IonicModule } from 'ionic-angular';
 import { MyApp } from './app.component';
 import { TabsPage } from '../pages/tabs/tabs';
 import { ChatsPage } from "../pages/chats/chats";
+import { MomentModule } from "angular2-moment";
 
 @NgModule({
   declarations: [
@@ -11,7 +12,8 @@ import { ChatsPage } from "../pages/chats/chats";
     TabsPage
   ],
   imports: [
-    IonicModule.forRoot(MyApp)
+    IonicModule.forRoot(MyApp),
+    MomentModule
   ],
   bootstrap: [IonicApp],
   entryComponents: [
-- 
2.9.3 (Apple Git-75)


From 66b027b5cfc9bd9c47b4a36e3e11269ae0808dc6 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 15:40:55 +0200
Subject: [PATCH 023/123] Step 2.18: Apply calendar pipe to chats view template

---
 src/pages/chats/chats.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/pages/chats/chats.html b/src/pages/chats/chats.html
index baa7c5d..a24f7bd 100644
--- a/src/pages/chats/chats.html
+++ b/src/pages/chats/chats.html
@@ -24,7 +24,7 @@
 
         <span *ngIf="chat.lastMessage" class="last-message">
           <p class="last-message-content">{{chat.lastMessage.content}}</p>
-          <span class="last-message-timestamp">{{chat.lastMessage.createdAt}}</span>
+          <span class="last-message-timestamp">{{chat.lastMessage.createdAt | amCalendar }}</span>
         </span>
       </div>
     </button>
-- 
2.9.3 (Apple Git-75)


From a68ae86f16a46c86f9208ab19ff21287cdcb782b Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 15:42:47 +0200
Subject: [PATCH 024/123] Step 2.19: Add chat removal button to view template

---
 src/pages/chats/chats.html | 25 +++++++++++++++----------
 1 file changed, 15 insertions(+), 10 deletions(-)

diff --git a/src/pages/chats/chats.html b/src/pages/chats/chats.html
index a24f7bd..1c48151 100644
--- a/src/pages/chats/chats.html
+++ b/src/pages/chats/chats.html
@@ -16,17 +16,22 @@
 
 <ion-content padding class="chats-page-content">
   <ion-list class="chats">
-    <button ion-item *ngFor="let chat of chats | async" class="chat">
-      <img class="chat-picture" [src]="chat.picture">
+    <ion-item-sliding *ngFor="let chat of chats | async">
+      <button ion-item class="chat">
+        <img class="chat-picture" [src]="chat.picture">
 
-      <div class="chat-info">
-        <h2 class="chat-title">{{chat.title}}</h2>
+        <div class="chat-info">
+          <h2 class="chat-title">{{chat.title}}</h2>
 
-        <span *ngIf="chat.lastMessage" class="last-message">
-          <p class="last-message-content">{{chat.lastMessage.content}}</p>
-          <span class="last-message-timestamp">{{chat.lastMessage.createdAt | amCalendar }}</span>
-        </span>
-      </div>
-    </button>
+          <span *ngIf="chat.lastMessage" class="last-message">
+            <p class="last-message-content">{{chat.lastMessage.content}}</p>
+            <span class="last-message-timestamp">{{chat.lastMessage.createdAt | amCalendar }}</span>
+          </span>
+        </div>
+      </button>
+      <ion-item-options class="chat-options">
+        <button ion-button color="danger" class="option option-remove" (click)="removeChat(chat)">Remove</button>
+      </ion-item-options>
+    </ion-item-sliding>
   </ion-list>
 </ion-content>
-- 
2.9.3 (Apple Git-75)


From c9a12b9da843e48505d5be9fa2b8585c9f072200 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 15:43:06 +0200
Subject: [PATCH 025/123] Step 2.20: Add chat removal stub method to chats
 component

---
 src/pages/chats/chats.ts | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/src/pages/chats/chats.ts b/src/pages/chats/chats.ts
index ddf9164..1901c10 100644
--- a/src/pages/chats/chats.ts
+++ b/src/pages/chats/chats.ts
@@ -62,4 +62,8 @@ export class ChatsPage {
       }
     ]);
   }
+
+  removeChat(chat: Chat): void {
+    // TODO: Implement it later
+  }
 }
-- 
2.9.3 (Apple Git-75)


From dbe0ba385ab34fe1661ae99997c8e292dbcdeddb Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 15:49:42 +0200
Subject: [PATCH 026/123] Step 3.1: Added meteor-clint-side

---
 package.json | 1 +
 1 file changed, 1 insertion(+)

diff --git a/package.json b/package.json
index bc7802a..db32f85 100644
--- a/package.json
+++ b/package.json
@@ -27,6 +27,7 @@
     "ionic-angular": "2.0.0-rc.1",
     "ionic-native": "2.2.3",
     "ionicons": "3.0.0",
+    "meteor-client-side": "^1.3.4",
     "moment": "^2.15.2",
     "rxjs": "5.0.0-beta.12",
     "zone.js": "0.6.21"
-- 
2.9.3 (Apple Git-75)


From adb05ff0ad2338e58f8bfd1423fcb42d725d581c Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 15:49:56 +0200
Subject: [PATCH 027/123] Step 3.2: Import meteor client side into the project

---
 src/app/main.dev.ts | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/src/app/main.dev.ts b/src/app/main.dev.ts
index 6af7a5b..f2f553b 100644
--- a/src/app/main.dev.ts
+++ b/src/app/main.dev.ts
@@ -1,3 +1,5 @@
+import 'meteor-client-side';
+
 import { platformBrowserDynamic } from '@angular/platform-browser-dynamic';
 
 import { AppModule } from './app.module';
-- 
2.9.3 (Apple Git-75)


From e4bbfba638a4409899052cfe10d7154fb899fcb8 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 16:25:04 +0200
Subject: [PATCH 028/123] Step 3.3: Create Meteor server side

---
 api/.gitignore                  |  1 +
 api/.meteor/.finished-upgraders | 15 +++++++++
 api/.meteor/.gitignore          |  1 +
 api/.meteor/.id                 |  7 ++++
 api/.meteor/packages            | 22 +++++++++++++
 api/.meteor/platforms           |  2 ++
 api/.meteor/release             |  1 +
 api/.meteor/versions            | 72 +++++++++++++++++++++++++++++++++++++++++
 api/client/main.css             |  1 +
 api/client/main.html            | 25 ++++++++++++++
 api/client/main.js              | 22 +++++++++++++
 api/package.json                | 10 ++++++
 api/server/main.js              |  5 +++
 13 files changed, 184 insertions(+)
 create mode 100644 api/.gitignore
 create mode 100644 api/.meteor/.finished-upgraders
 create mode 100644 api/.meteor/.gitignore
 create mode 100644 api/.meteor/.id
 create mode 100644 api/.meteor/packages
 create mode 100644 api/.meteor/platforms
 create mode 100644 api/.meteor/release
 create mode 100644 api/.meteor/versions
 create mode 100644 api/client/main.css
 create mode 100644 api/client/main.html
 create mode 100644 api/client/main.js
 create mode 100644 api/package.json
 create mode 100644 api/server/main.js

diff --git a/api/.gitignore b/api/.gitignore
new file mode 100644
index 0000000..c2658d7
--- /dev/null
+++ b/api/.gitignore
@@ -0,0 +1 @@
+node_modules/
diff --git a/api/.meteor/.finished-upgraders b/api/.meteor/.finished-upgraders
new file mode 100644
index 0000000..aa60704
--- /dev/null
+++ b/api/.meteor/.finished-upgraders
@@ -0,0 +1,15 @@
+# This file contains information which helps Meteor properly upgrade your
+# app when you run 'meteor update'. You should check it into version control
+# with your project.
+
+notices-for-0.9.0
+notices-for-0.9.1
+0.9.4-platform-file
+notices-for-facebook-graph-api-2
+1.2.0-standard-minifiers-package
+1.2.0-meteor-platform-split
+1.2.0-cordova-changes
+1.2.0-breaking-changes
+1.3.0-split-minifiers-package
+1.4.0-remove-old-dev-bundle-link
+1.4.1-add-shell-server-package
diff --git a/api/.meteor/.gitignore b/api/.meteor/.gitignore
new file mode 100644
index 0000000..4083037
--- /dev/null
+++ b/api/.meteor/.gitignore
@@ -0,0 +1 @@
+local
diff --git a/api/.meteor/.id b/api/.meteor/.id
new file mode 100644
index 0000000..7a4accc
--- /dev/null
+++ b/api/.meteor/.id
@@ -0,0 +1,7 @@
+# This file contains a token that is unique to your project.
+# Check it into your repository along with the rest of this directory.
+# It can be used for purposes such as:
+#   - ensuring you don't accidentally deploy one app on top of another
+#   - providing package authors with aggregated statistics
+
+10gwof37rrpbm1fc4j64
diff --git a/api/.meteor/packages b/api/.meteor/packages
new file mode 100644
index 0000000..0b61ae4
--- /dev/null
+++ b/api/.meteor/packages
@@ -0,0 +1,22 @@
+# Meteor packages used by this project, one per line.
+# Check this file (and the other files in this directory) into your repository.
+#
+# 'meteor add' and 'meteor remove' will edit this file for you,
+# but you can also edit it by hand.
+
+meteor-base@1.0.4             # Packages every Meteor app needs to have
+mobile-experience@1.0.4       # Packages for a great mobile UX
+mongo@1.1.14                   # The database Meteor supports right now
+blaze-html-templates@1.0.4 # Compile .html files into Meteor Blaze views
+reactive-var@1.0.11            # Reactive variable for tracker
+jquery@1.11.10                  # Helpful client-side library
+tracker@1.1.1                 # Meteor's client-side reactive programming library
+
+standard-minifier-css@1.3.2   # CSS minifier run for production mode
+standard-minifier-js@1.2.1    # JS minifier run for production mode
+es5-shim@4.6.15                # ECMAScript 5 compatibility for older browsers.
+ecmascript@0.5.9              # Enable ECMAScript2015+ syntax in app code
+shell-server@0.2.1            # Server-side component of the `meteor shell` command
+
+autopublish@1.0.7             # Publish all data to the clients (for prototyping)
+insecure@1.0.7                # Allow all DB writes from clients (for prototyping)
diff --git a/api/.meteor/platforms b/api/.meteor/platforms
new file mode 100644
index 0000000..efeba1b
--- /dev/null
+++ b/api/.meteor/platforms
@@ -0,0 +1,2 @@
+server
+browser
diff --git a/api/.meteor/release b/api/.meteor/release
new file mode 100644
index 0000000..c260846
--- /dev/null
+++ b/api/.meteor/release
@@ -0,0 +1 @@
+METEOR@1.4.2
diff --git a/api/.meteor/versions b/api/.meteor/versions
new file mode 100644
index 0000000..67c3899
--- /dev/null
+++ b/api/.meteor/versions
@@ -0,0 +1,72 @@
+allow-deny@1.0.5
+autopublish@1.0.7
+autoupdate@1.2.11
+babel-compiler@6.13.0
+babel-runtime@0.1.13
+base64@1.0.10
+binary-heap@1.0.10
+blaze@2.1.9
+blaze-html-templates@1.0.5
+blaze-tools@1.0.10
+boilerplate-generator@1.0.11
+caching-compiler@1.1.8
+caching-html-compiler@1.0.7
+callback-hook@1.0.10
+check@1.2.4
+ddp@1.2.5
+ddp-client@1.2.9
+ddp-common@1.2.7
+ddp-server@1.2.10
+deps@1.0.12
+diff-sequence@1.0.7
+ecmascript@0.5.9
+ecmascript-runtime@0.3.15
+ejson@1.0.13
+es5-shim@4.6.15
+fastclick@1.0.13
+geojson-utils@1.0.10
+hot-code-push@1.0.4
+html-tools@1.0.11
+htmljs@1.0.11
+http@1.1.8
+id-map@1.0.9
+insecure@1.0.7
+jquery@1.11.10
+launch-screen@1.0.12
+livedata@1.0.18
+logging@1.1.16
+meteor@1.6.0
+meteor-base@1.0.4
+minifier-css@1.2.15
+minifier-js@1.2.15
+minimongo@1.0.18
+mobile-experience@1.0.4
+mobile-status-bar@1.0.13
+modules@0.7.7
+modules-runtime@0.7.7
+mongo@1.1.14
+mongo-id@1.0.6
+npm-mongo@2.2.11_2
+observe-sequence@1.0.14
+ordered-dict@1.0.9
+promise@0.8.8
+random@1.0.10
+reactive-var@1.0.11
+reload@1.1.11
+retry@1.0.9
+routepolicy@1.0.12
+shell-server@0.2.1
+spacebars@1.0.13
+spacebars-compiler@1.0.13
+standard-minifier-css@1.3.2
+standard-minifier-js@1.2.1
+templating@1.2.15
+templating-compiler@1.2.15
+templating-runtime@1.2.15
+templating-tools@1.0.5
+tracker@1.1.1
+ui@1.0.12
+underscore@1.0.10
+url@1.0.11
+webapp@1.3.12
+webapp-hashing@1.0.9
diff --git a/api/client/main.css b/api/client/main.css
new file mode 100644
index 0000000..b6b4052
--- /dev/null
+++ b/api/client/main.css
@@ -0,0 +1 @@
+/* CSS declarations go here */
diff --git a/api/client/main.html b/api/client/main.html
new file mode 100644
index 0000000..96e1e44
--- /dev/null
+++ b/api/client/main.html
@@ -0,0 +1,25 @@
+<head>
+  <title>api</title>
+</head>
+
+<body>
+  <h1>Welcome to Meteor!</h1>
+
+  {{> hello}}
+  {{> info}}
+</body>
+
+<template name="hello">
+  <button>Click Me</button>
+  <p>You've pressed the button {{counter}} times.</p>
+</template>
+
+<template name="info">
+  <h2>Learn Meteor!</h2>
+  <ul>
+    <li><a href="https://www.meteor.com/try" target="_blank">Do the Tutorial</a></li>
+    <li><a href="http://guide.meteor.com" target="_blank">Follow the Guide</a></li>
+    <li><a href="https://docs.meteor.com" target="_blank">Read the Docs</a></li>
+    <li><a href="https://forums.meteor.com" target="_blank">Discussions</a></li>
+  </ul>
+</template>
diff --git a/api/client/main.js b/api/client/main.js
new file mode 100644
index 0000000..ecb3282
--- /dev/null
+++ b/api/client/main.js
@@ -0,0 +1,22 @@
+import { Template } from 'meteor/templating';
+import { ReactiveVar } from 'meteor/reactive-var';
+
+import './main.html';
+
+Template.hello.onCreated(function helloOnCreated() {
+  // counter starts at 0
+  this.counter = new ReactiveVar(0);
+});
+
+Template.hello.helpers({
+  counter() {
+    return Template.instance().counter.get();
+  },
+});
+
+Template.hello.events({
+  'click button'(event, instance) {
+    // increment the counter when button is clicked
+    instance.counter.set(instance.counter.get() + 1);
+  },
+});
diff --git a/api/package.json b/api/package.json
new file mode 100644
index 0000000..c8e293f
--- /dev/null
+++ b/api/package.json
@@ -0,0 +1,10 @@
+{
+  "name": "api",
+  "private": true,
+  "scripts": {
+    "start": "meteor run"
+  },
+  "dependencies": {
+    "meteor-node-stubs": "~0.2.0"
+  }
+}
diff --git a/api/server/main.js b/api/server/main.js
new file mode 100644
index 0000000..31a9e0e
--- /dev/null
+++ b/api/server/main.js
@@ -0,0 +1,5 @@
+import { Meteor } from 'meteor/meteor';
+
+Meteor.startup(() => {
+  // code to run on server at startup
+});
-- 
2.9.3 (Apple Git-75)


From 91ef13f94f2589a46b06bc6ecbef28200177752c Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 16:26:24 +0200
Subject: [PATCH 029/123] Step 3.4: Removed Meteor client side

---
 api/client/main.css  |  1 -
 api/client/main.html | 25 -------------------------
 api/client/main.js   | 22 ----------------------
 3 files changed, 48 deletions(-)
 delete mode 100644 api/client/main.css
 delete mode 100644 api/client/main.html
 delete mode 100644 api/client/main.js

diff --git a/api/client/main.css b/api/client/main.css
deleted file mode 100644
index b6b4052..0000000
--- a/api/client/main.css
+++ /dev/null
@@ -1 +0,0 @@
-/* CSS declarations go here */
diff --git a/api/client/main.html b/api/client/main.html
deleted file mode 100644
index 96e1e44..0000000
--- a/api/client/main.html
+++ /dev/null
@@ -1,25 +0,0 @@
-<head>
-  <title>api</title>
-</head>
-
-<body>
-  <h1>Welcome to Meteor!</h1>
-
-  {{> hello}}
-  {{> info}}
-</body>
-
-<template name="hello">
-  <button>Click Me</button>
-  <p>You've pressed the button {{counter}} times.</p>
-</template>
-
-<template name="info">
-  <h2>Learn Meteor!</h2>
-  <ul>
-    <li><a href="https://www.meteor.com/try" target="_blank">Do the Tutorial</a></li>
-    <li><a href="http://guide.meteor.com" target="_blank">Follow the Guide</a></li>
-    <li><a href="https://docs.meteor.com" target="_blank">Read the Docs</a></li>
-    <li><a href="https://forums.meteor.com" target="_blank">Discussions</a></li>
-  </ul>
-</template>
diff --git a/api/client/main.js b/api/client/main.js
deleted file mode 100644
index ecb3282..0000000
--- a/api/client/main.js
+++ /dev/null
@@ -1,22 +0,0 @@
-import { Template } from 'meteor/templating';
-import { ReactiveVar } from 'meteor/reactive-var';
-
-import './main.html';
-
-Template.hello.onCreated(function helloOnCreated() {
-  // counter starts at 0
-  this.counter = new ReactiveVar(0);
-});
-
-Template.hello.helpers({
-  counter() {
-    return Template.instance().counter.get();
-  },
-});
-
-Template.hello.events({
-  'click button'(event, instance) {
-    // increment the counter when button is clicked
-    instance.counter.set(instance.counter.get() + 1);
-  },
-});
-- 
2.9.3 (Apple Git-75)


From 716b145960df73872049363750f8884294fed734 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 16:26:37 +0200
Subject: [PATCH 030/123] Step 3.5: Added TypeScript compiler

---
 api/.meteor/packages | 1 +
 api/.meteor/versions | 3 +++
 2 files changed, 4 insertions(+)

diff --git a/api/.meteor/packages b/api/.meteor/packages
index 0b61ae4..c6e3dac 100644
--- a/api/.meteor/packages
+++ b/api/.meteor/packages
@@ -20,3 +20,4 @@ shell-server@0.2.1            # Server-side component of the `meteor shell` comm
 
 autopublish@1.0.7             # Publish all data to the clients (for prototyping)
 insecure@1.0.7                # Allow all DB writes from clients (for prototyping)
+barbatus:typescript
diff --git a/api/.meteor/versions b/api/.meteor/versions
index 67c3899..3a0a89c 100644
--- a/api/.meteor/versions
+++ b/api/.meteor/versions
@@ -3,6 +3,9 @@ autopublish@1.0.7
 autoupdate@1.2.11
 babel-compiler@6.13.0
 babel-runtime@0.1.13
+barbatus:typescript@0.5.2
+barbatus:typescript-compiler@0.8.4
+barbatus:typescript-runtime@0.1.2
 base64@1.0.10
 binary-heap@1.0.10
 blaze@2.1.9
-- 
2.9.3 (Apple Git-75)


From 4f1c44313353ec5ad12dd36aa885143990afc13a Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 16:27:15 +0200
Subject: [PATCH 031/123] Step 3.6: Changed the extension of the server main
 file

---
 api/server/{main.js => main.ts} | 0
 1 file changed, 0 insertions(+), 0 deletions(-)
 rename api/server/{main.js => main.ts} (100%)

diff --git a/api/server/main.js b/api/server/main.ts
similarity index 100%
rename from api/server/main.js
rename to api/server/main.ts
-- 
2.9.3 (Apple Git-75)


From 782df24839cdff60b04ca0426603a87b5ed159a1 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 16:29:15 +0200
Subject: [PATCH 032/123] Step 3.7: Created tsconfig.json

---
 api/tsconfig.json | 25 +++++++++++++++++++++++++
 1 file changed, 25 insertions(+)
 create mode 100644 api/tsconfig.json

diff --git a/api/tsconfig.json b/api/tsconfig.json
new file mode 100644
index 0000000..59f7332
--- /dev/null
+++ b/api/tsconfig.json
@@ -0,0 +1,25 @@
+{
+  "compilerOptions": {
+    "target": "es5",
+    "lib": [
+      "es6",
+      "dom"
+    ],
+    "module": "commonjs",
+    "moduleResolution": "node",
+    "experimentalDecorators": true,
+    "emitDecoratorMetadata": true,
+    "sourceMap": true
+  },
+  "exclude": [
+    "node_modules"
+  ],
+  "files": [
+    "typings.d.ts"
+  ],
+  "compileOnSave": false,
+  "angularCompilerOptions": {
+    "genDir": "aot",
+    "skipMetadataEmit": true
+  }
+}
-- 
2.9.3 (Apple Git-75)


From 79ddac1050364c8ecd3dee400ed1d4d1376ea63c Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 16:29:26 +0200
Subject: [PATCH 033/123] Step 3.8: Created TypeScript typings file

---
 api/typings.d.ts | 2 ++
 1 file changed, 2 insertions(+)
 create mode 100644 api/typings.d.ts

diff --git a/api/typings.d.ts b/api/typings.d.ts
new file mode 100644
index 0000000..3b63072
--- /dev/null
+++ b/api/typings.d.ts
@@ -0,0 +1,2 @@
+/// <reference types="meteor-typings" />
+/// <reference types="@types/underscore" />
-- 
2.9.3 (Apple Git-75)


From 739966a533082d7caef74dd9e5019133908aa8da Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 16:30:05 +0200
Subject: [PATCH 034/123] Step 3.9: Added missing server packages

---
 {models => api/models}/whatsapp-models.d.ts | 0
 api/package.json                            | 5 ++++-
 2 files changed, 4 insertions(+), 1 deletion(-)
 rename {models => api/models}/whatsapp-models.d.ts (100%)

diff --git a/models/whatsapp-models.d.ts b/api/models/whatsapp-models.d.ts
similarity index 100%
rename from models/whatsapp-models.d.ts
rename to api/models/whatsapp-models.d.ts
diff --git a/api/package.json b/api/package.json
index c8e293f..1d47be7 100644
--- a/api/package.json
+++ b/api/package.json
@@ -5,6 +5,9 @@
     "start": "meteor run"
   },
   "dependencies": {
-    "meteor-node-stubs": "~0.2.0"
+    "meteor-node-stubs": "^0.2.3",
+    "meteor-rxjs": "^0.4.3",
+    "meteor-typings": "^1.3.1",
+    "zone.js": "^0.6.26"
   }
 }
-- 
2.9.3 (Apple Git-75)


From 27b557dacf3b8c3b5197c5e80ade479382a6ded4 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 17:51:12 +0200
Subject: [PATCH 035/123] Step 3.10: Updated import path

---
 tsconfig.json | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/tsconfig.json b/tsconfig.json
index d7b2d75..268d345 100644
--- a/tsconfig.json
+++ b/tsconfig.json
@@ -16,7 +16,7 @@
     "stripInternal": true
   },
   "include": [
-    "models/whatsapp-models.d.ts",
+    "api/models/whatsapp-models.d.ts",
     "src/**/*.ts"
   ],
   "exclude": [
-- 
2.9.3 (Apple Git-75)


From 9234e73aad43441e660757c1394c48e0a2094a1b Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 16:35:32 +0200
Subject: [PATCH 036/123] Step 3.11: Created Collections

---
 api/collections/whatsapp-collections.ts | 4 ++++
 1 file changed, 4 insertions(+)
 create mode 100644 api/collections/whatsapp-collections.ts

diff --git a/api/collections/whatsapp-collections.ts b/api/collections/whatsapp-collections.ts
new file mode 100644
index 0000000..64c113e
--- /dev/null
+++ b/api/collections/whatsapp-collections.ts
@@ -0,0 +1,4 @@
+import { MongoObservable } from "meteor-rxjs";
+
+export const Chats = new MongoObservable.Collection("chats");
+export const Messages = new MongoObservable.Collection("messages");
-- 
2.9.3 (Apple Git-75)


From 8e0cd23ac6cda4162ff33e8ac19975295aa9841d Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 16:37:23 +0200
Subject: [PATCH 037/123] Step 3.12: Added moment to the server side

---
 api/package.json | 2 ++
 api/typings.d.ts | 1 +
 2 files changed, 3 insertions(+)

diff --git a/api/package.json b/api/package.json
index 1d47be7..c618752 100644
--- a/api/package.json
+++ b/api/package.json
@@ -5,9 +5,11 @@
     "start": "meteor run"
   },
   "dependencies": {
+    "@types/moment": "^2.13.0",
     "meteor-node-stubs": "^0.2.3",
     "meteor-rxjs": "^0.4.3",
     "meteor-typings": "^1.3.1",
+    "moment": "^2.15.2",
     "zone.js": "^0.6.26"
   }
 }
diff --git a/api/typings.d.ts b/api/typings.d.ts
index 3b63072..cf77f5a 100644
--- a/api/typings.d.ts
+++ b/api/typings.d.ts
@@ -1,2 +1,3 @@
 /// <reference types="meteor-typings" />
 /// <reference types="@types/underscore" />
+/// <reference types="@types/moment" />
-- 
2.9.3 (Apple Git-75)


From f15c4b2c1ff3d6abce8409f3f64a8ec43eef875f Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 16:37:43 +0200
Subject: [PATCH 038/123] Step 3.13: Added stub data to the collection in the
 server side

---
 api/server/main.ts | 61 +++++++++++++++++++++++++++++++++++++++++++++++++++++-
 1 file changed, 60 insertions(+), 1 deletion(-)

diff --git a/api/server/main.ts b/api/server/main.ts
index 31a9e0e..51b7c0c 100644
--- a/api/server/main.ts
+++ b/api/server/main.ts
@@ -1,5 +1,64 @@
 import { Meteor } from 'meteor/meteor';
+import { Chats, Messages } from "../collections/whatsapp-collections";
+import * as moment from "moment";
 
 Meteor.startup(() => {
-  // code to run on server at startup
+  if (Chats.find({}).cursor.count() === 0) {
+    let chatId;
+
+    chatId = Chats.collection.insert({
+      title: 'Ethan Gonzalez',
+      picture: 'https://randomuser.me/api/portraits/thumb/men/1.jpg'
+    });
+
+    Messages.collection.insert({
+      chatId: chatId,
+      content: 'You on your way?',
+      createdAt: moment().subtract(1, 'hours').toDate()
+    });
+
+    chatId = Chats.collection.insert({
+      title: 'Bryan Wallace',
+      picture: 'https://randomuser.me/api/portraits/thumb/lego/1.jpg'
+    });
+
+    Messages.collection.insert({
+      chatId: chatId,
+      content: 'Hey, it\'s me',
+      createdAt: moment().subtract(2, 'hours').toDate()
+    });
+
+    chatId = Chats.collection.insert({
+      title: 'Avery Stewart',
+      picture: 'https://randomuser.me/api/portraits/thumb/women/1.jpg'
+    });
+
+    Messages.collection.insert({
+      chatId: chatId,
+      content: 'I should buy a boat',
+      createdAt: moment().subtract(1, 'days').toDate()
+    });
+
+    chatId = Chats.collection.insert({
+      title: 'Katie Peterson',
+      picture: 'https://randomuser.me/api/portraits/thumb/women/2.jpg'
+    });
+
+    Messages.collection.insert({
+      chatId: chatId,
+      content: 'Look at my mukluks!',
+      createdAt: moment().subtract(4, 'days').toDate()
+    });
+
+    chatId = Chats.collection.insert({
+      title: 'Ray Edwards',
+      picture: 'https://randomuser.me/api/portraits/thumb/men/2.jpg'
+    });
+
+    Messages.collection.insert({
+      chatId: chatId,
+      content: 'This is wicked good ice cream.',
+      createdAt: moment().subtract(2, 'weeks').toDate()
+    });
+  }
 });
-- 
2.9.3 (Apple Git-75)


From 025d77fcb70308717432e7686d63a19d6b85c77b Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 16:38:32 +0200
Subject: [PATCH 039/123] Step 3.14: Added meteor-rxjs to the client side

---
 package.json        | 1 +
 src/app/main.dev.ts | 1 +
 2 files changed, 2 insertions(+)

diff --git a/package.json b/package.json
index db32f85..5b7657d 100644
--- a/package.json
+++ b/package.json
@@ -28,6 +28,7 @@
     "ionic-native": "2.2.3",
     "ionicons": "3.0.0",
     "meteor-client-side": "^1.3.4",
+    "meteor-rxjs": "^0.4.3",
     "moment": "^2.15.2",
     "rxjs": "5.0.0-beta.12",
     "zone.js": "0.6.21"
diff --git a/src/app/main.dev.ts b/src/app/main.dev.ts
index f2f553b..7872830 100644
--- a/src/app/main.dev.ts
+++ b/src/app/main.dev.ts
@@ -1,3 +1,4 @@
+import 'reflect-metadata';
 import 'meteor-client-side';
 
 import { platformBrowserDynamic } from '@angular/platform-browser-dynamic';
-- 
2.9.3 (Apple Git-75)


From cf349f52c9278c19a28c7b41f61e530b5e7b1d4f Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 18:15:15 +0200
Subject: [PATCH 040/123] Step 3.15: Added the chats with the last message
 using RxJS operators

---
 src/pages/chats/chats.ts | 74 ++++++++++++++----------------------------------
 1 file changed, 21 insertions(+), 53 deletions(-)

diff --git a/src/pages/chats/chats.ts b/src/pages/chats/chats.ts
index 1901c10..344f625 100644
--- a/src/pages/chats/chats.ts
+++ b/src/pages/chats/chats.ts
@@ -1,66 +1,34 @@
-import * as moment from 'moment';
-import { Component } from '@angular/core';
+import { Component, OnInit } from '@angular/core';
 import { Observable } from "rxjs";
 import { Chat } from "api/models/whatsapp-models";
+import { Chats, Messages } from "api/collections/whatsapp-collections";
 
 @Component({
   templateUrl: 'chats.html'
 })
-export class ChatsPage {
-  chats: Observable<Chat[]>;
+export class ChatsPage implements OnInit {
+  private chats;
 
   constructor() {
-    this.chats = this.findChats();
+
   }
 
-  private findChats(): Observable<Chat[]> {
-    return Observable.of([
-      {
-        _id: '0',
-        title: 'Ethan Gonzalez',
-        picture: 'https://randomuser.me/api/portraits/thumb/men/1.jpg',
-        lastMessage: {
-          content: 'You on your way?',
-          createdAt: moment().subtract(1, 'hours').toDate()
-        }
-      },
-      {
-        _id: '1',
-        title: 'Bryan Wallace',
-        picture: 'https://randomuser.me/api/portraits/thumb/lego/1.jpg',
-        lastMessage: {
-          content: 'Hey, it\'s me',
-          createdAt: moment().subtract(2, 'hours').toDate()
-        }
-      },
-      {
-        _id: '2',
-        title: 'Avery Stewart',
-        picture: 'https://randomuser.me/api/portraits/thumb/women/1.jpg',
-        lastMessage: {
-          content: 'I should buy a boat',
-          createdAt: moment().subtract(1, 'days').toDate()
-        }
-      },
-      {
-        _id: '3',
-        title: 'Katie Peterson',
-        picture: 'https://randomuser.me/api/portraits/thumb/women/2.jpg',
-        lastMessage: {
-          content: 'Look at my mukluks!',
-          createdAt: moment().subtract(4, 'days').toDate()
-        }
-      },
-      {
-        _id: '4',
-        title: 'Ray Edwards',
-        picture: 'https://randomuser.me/api/portraits/thumb/men/2.jpg',
-        lastMessage: {
-          content: 'This is wicked good ice cream.',
-          createdAt: moment().subtract(2, 'weeks').toDate()
-        }
-      }
-    ]);
+  ngOnInit() {
+    this.chats = Chats
+      .find({})
+      .mergeMap((chats: Chat[]) =>
+        Observable.combineLatest(
+          ...chats.map((chat: Chat) =>
+            Messages
+              .find({chatId: chat._id})
+              .startWith(null)
+              .map(messages => {
+                if (messages) chat.lastMessage = messages[0];
+                return chat;
+              })
+          )
+        )
+      ).zone();
   }
 
   removeChat(chat: Chat): void {
-- 
2.9.3 (Apple Git-75)


From 0576257c007589b5e01f672efb980faf677442d7 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 18:40:15 +0200
Subject: [PATCH 041/123] Step 4.1: Added showMessage method

---
 src/pages/chats/chats.ts | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/src/pages/chats/chats.ts b/src/pages/chats/chats.ts
index 344f625..297023e 100644
--- a/src/pages/chats/chats.ts
+++ b/src/pages/chats/chats.ts
@@ -2,6 +2,7 @@ import { Component, OnInit } from '@angular/core';
 import { Observable } from "rxjs";
 import { Chat } from "api/models/whatsapp-models";
 import { Chats, Messages } from "api/collections/whatsapp-collections";
+import { NavController } from "ionic-angular";
 
 @Component({
   templateUrl: 'chats.html'
@@ -9,7 +10,7 @@ import { Chats, Messages } from "api/collections/whatsapp-collections";
 export class ChatsPage implements OnInit {
   private chats;
 
-  constructor() {
+  constructor(private navCtrl: NavController) {
 
   }
 
@@ -31,6 +32,10 @@ export class ChatsPage implements OnInit {
       ).zone();
   }
 
+  showMessages(chat): void {
+    this.navCtrl.push(MessagesPage, {chat});
+  }
+
   removeChat(chat: Chat): void {
     // TODO: Implement it later
   }
-- 
2.9.3 (Apple Git-75)


From 919bb6a1ed6f3d43b6372eb1b0a98c80d501205a Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 18:41:07 +0200
Subject: [PATCH 042/123] Step 4.2: Added the action to the button

---
 src/pages/chats/chats.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/pages/chats/chats.html b/src/pages/chats/chats.html
index 1c48151..d5d8eaf 100644
--- a/src/pages/chats/chats.html
+++ b/src/pages/chats/chats.html
@@ -17,7 +17,7 @@
 <ion-content padding class="chats-page-content">
   <ion-list class="chats">
     <ion-item-sliding *ngFor="let chat of chats | async">
-      <button ion-item class="chat">
+      <button ion-item class="chat" (click)="showMessages(chat)">
         <img class="chat-picture" [src]="chat.picture">
 
         <div class="chat-info">
-- 
2.9.3 (Apple Git-75)


From db072434231f5cdd053775d055fc67915f79d4ac Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 18:42:32 +0200
Subject: [PATCH 043/123] Step 4.3: Create a stub for the component

---
 src/pages/messages/messages.ts | 21 +++++++++++++++++++++
 1 file changed, 21 insertions(+)
 create mode 100644 src/pages/messages/messages.ts

diff --git a/src/pages/messages/messages.ts b/src/pages/messages/messages.ts
new file mode 100644
index 0000000..3af8085
--- /dev/null
+++ b/src/pages/messages/messages.ts
@@ -0,0 +1,21 @@
+import { Component, OnInit } from "@angular/core";
+import { NavParams } from "ionic-angular";
+import { Chat } from "api/models/whatsapp-models";
+
+@Component({
+  selector: "messages-page",
+  template: `Messages Page`
+})
+export class MessagesPage implements OnInit {
+  private selectedChat: Chat;
+
+  constructor(navParams: NavParams) {
+    this.selectedChat = <Chat>navParams.get('chat');
+
+    console.log("Selected chat is: ", this.selectedChat);
+  }
+
+  ngOnInit() {
+
+  }
+}
-- 
2.9.3 (Apple Git-75)


From f28c383e55b98d258c63535f692691eabc71cd37 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 18:43:04 +0200
Subject: [PATCH 044/123] Step 4.4: Added the Component to the NgModule

---
 src/app/app.module.ts | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/src/app/app.module.ts b/src/app/app.module.ts
index f0f2cb5..0db4be3 100644
--- a/src/app/app.module.ts
+++ b/src/app/app.module.ts
@@ -4,12 +4,14 @@ import { MyApp } from './app.component';
 import { TabsPage } from '../pages/tabs/tabs';
 import { ChatsPage } from "../pages/chats/chats";
 import { MomentModule } from "angular2-moment";
+import { MessagesPage } from "../pages/messages/messages";
 
 @NgModule({
   declarations: [
     MyApp,
     ChatsPage,
-    TabsPage
+    TabsPage,
+    MessagesPage
   ],
   imports: [
     IonicModule.forRoot(MyApp),
@@ -19,7 +21,8 @@ import { MomentModule } from "angular2-moment";
   entryComponents: [
     MyApp,
     ChatsPage,
-    TabsPage
+    TabsPage,
+    MessagesPage
   ],
   providers: []
 })
-- 
2.9.3 (Apple Git-75)


From 02e24e8c9783fd67f05183007e386a07f8fb660f Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 18:43:34 +0200
Subject: [PATCH 045/123] Step 4.5: Added the correct import

---
 src/pages/chats/chats.ts | 1 +
 1 file changed, 1 insertion(+)

diff --git a/src/pages/chats/chats.ts b/src/pages/chats/chats.ts
index 297023e..a7bb1dd 100644
--- a/src/pages/chats/chats.ts
+++ b/src/pages/chats/chats.ts
@@ -3,6 +3,7 @@ import { Observable } from "rxjs";
 import { Chat } from "api/models/whatsapp-models";
 import { Chats, Messages } from "api/collections/whatsapp-collections";
 import { NavController } from "ionic-angular";
+import { MessagesPage } from "../messages/messages";
 
 @Component({
   templateUrl: 'chats.html'
-- 
2.9.3 (Apple Git-75)


From 8a6c13af612c6b2aba98f6a8c790c151066696a9 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 18:46:46 +0200
Subject: [PATCH 046/123] Step 4.6: Add basic messages component

---
 src/pages/messages/messages.ts | 26 ++++++++++++++++++++++----
 1 file changed, 22 insertions(+), 4 deletions(-)

diff --git a/src/pages/messages/messages.ts b/src/pages/messages/messages.ts
index 3af8085..adf7ed0 100644
--- a/src/pages/messages/messages.ts
+++ b/src/pages/messages/messages.ts
@@ -1,21 +1,39 @@
 import { Component, OnInit } from "@angular/core";
 import { NavParams } from "ionic-angular";
-import { Chat } from "api/models/whatsapp-models";
+import { Chat, Message } from "api/models/whatsapp-models";
+import { Messages } from "api/collections/whatsapp-collections";
+import { Observable} from "rxjs";
 
 @Component({
   selector: "messages-page",
-  template: `Messages Page`
+  templateUrl: "messages.html"
 })
 export class MessagesPage implements OnInit {
   private selectedChat: Chat;
+  private title: string;
+  private picture: string;
+  private messages: Observable<Message[]>;
 
   constructor(navParams: NavParams) {
     this.selectedChat = <Chat>navParams.get('chat');
-
-    console.log("Selected chat is: ", this.selectedChat);
+    this.title = this.selectedChat.title;
+    this.picture = this.selectedChat.picture;
   }
 
   ngOnInit() {
+    let isEven = false;
+
+    this.messages = Messages.find(
+      {chatId: this.selectedChat._id},
+      {sort: {createdAt: 1}}
+    ).map((messages: Message[]) => {
+      messages.forEach((message: Message) => {
+        message.ownership = isEven ? 'mine' : 'other';
+        isEven = !isEven;
+      });
 
+      return messages;
+    });
   }
 }
+
-- 
2.9.3 (Apple Git-75)


From cfc9ca33594732dc1b939d61e50cce79a3112946 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 18:47:04 +0200
Subject: [PATCH 047/123] Step 4.7: Add 'ownership' property to message model

---
 api/models/whatsapp-models.d.ts | 1 +
 1 file changed, 1 insertion(+)

diff --git a/api/models/whatsapp-models.d.ts b/api/models/whatsapp-models.d.ts
index 2f4b40f..51c5991 100644
--- a/api/models/whatsapp-models.d.ts
+++ b/api/models/whatsapp-models.d.ts
@@ -11,5 +11,6 @@ declare module 'api/models/whatsapp-models' {
     chatId?: string;
     content?: string;
     createdAt?: Date;
+    ownership?: string;
   }
 }
-- 
2.9.3 (Apple Git-75)


From d238b450cf1566c3ce523eff942407a79c8ccd01 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 18:52:18 +0200
Subject: [PATCH 048/123] Step 4.8: Add basic messages view template

---
 src/pages/messages/messages.html | 25 +++++++++++++++++++++++++
 1 file changed, 25 insertions(+)
 create mode 100644 src/pages/messages/messages.html

diff --git a/src/pages/messages/messages.html b/src/pages/messages/messages.html
new file mode 100644
index 0000000..d12798d
--- /dev/null
+++ b/src/pages/messages/messages.html
@@ -0,0 +1,25 @@
+<ion-header>
+  <ion-navbar color="whatsapp" class="messages-page-navbar">
+    <ion-buttons>
+      <img class="chat-picture" [src]="picture">
+    </ion-buttons>
+
+    <ion-title class="chat-title">{{title}}</ion-title>
+
+    <ion-buttons end>
+      <button ion-button icon-only class="attach-button"><ion-icon name="attach"></ion-icon></button>
+      <button ion-button icon-only class="settings-button"><ion-icon name="more"></ion-icon></button>
+    </ion-buttons>
+  </ion-navbar>
+</ion-header>
+
+<ion-content padding class="messages-page-content">
+  <ion-scroll scrollY="true" class="messages">
+    <div *ngFor="let message of messages | async" class="message-wrapper">
+      <div [class]="'message message-' + message.ownership">
+        <div class="message-content">{{message.content}}</div>
+        <span class="message-timestamp">{{message.createdAt}}</span>
+      </div>
+    </div>
+  </ion-scroll>
+</ion-content>
-- 
2.9.3 (Apple Git-75)


From ab16b65ef79e68ed8fbd0e713f39469a8c5a439e Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 18:52:27 +0200
Subject: [PATCH 049/123] Step 4.9: Add basic messages stylesheet

---
 src/pages/messages/messages.scss | 93 ++++++++++++++++++++++++++++++++++++++++
 1 file changed, 93 insertions(+)
 create mode 100644 src/pages/messages/messages.scss

diff --git a/src/pages/messages/messages.scss b/src/pages/messages/messages.scss
new file mode 100644
index 0000000..33c2b3a
--- /dev/null
+++ b/src/pages/messages/messages.scss
@@ -0,0 +1,93 @@
+.messages-page-navbar {
+  .chat-picture {
+    width: 50px;
+    border-radius: 50%;
+    float: left;
+  }
+
+  .chat-title {
+    line-height: 50px;
+    float: left;
+  }
+}
+
+.messages-page-content {
+  > .scroll-content {
+    margin: 42px -15px 53px !important;
+  }
+
+  .messages {
+    height: 100%;
+    background-image: url(/assets/chat-background.jpg);
+    background-color: #E0DAD6;
+    background-repeat: no-repeat;
+    background-size: cover;
+  }
+
+  .message-wrapper {
+    margin-bottom: 9px;
+
+    &::after {
+      content: "";
+      display: table;
+      clear: both;
+    }
+  }
+
+  .message {
+    display: inline-block;
+    position: relative;
+    max-width: 236px;
+    border-radius: 7px;
+    box-shadow: 0 1px 2px rgba(0, 0, 0, .15);
+
+    &.message-mine {
+      float: right;
+      background-color: #DCF8C6;
+
+      &::before {
+        right: -11px;
+        background-image: url(/assets/message-mine.png)
+      }
+    }
+
+    &.message-other {
+      float: left;
+      background-color: #FFF;
+
+      &::before {
+        left: -11px;
+        background-image: url(/assets/message-other.png)
+      }
+    }
+
+    &.message-other::before, &.message-mine::before {
+      content: "";
+      position: absolute;
+      bottom: 3px;
+      width: 12px;
+      height: 19px;
+      background-position: 50% 50%;
+      background-repeat: no-repeat;
+      background-size: contain;
+    }
+
+    .message-content {
+      padding: 5px 7px;
+      word-wrap: break-word;
+
+      &::after {
+        content: " \00a0\00a0\00a0\00a0\00a0\00a0\00a0\00a0\00a0\00a0\00a0\00a0\00a0\00a0\00a0\00a0\00a0\00a0\00a0";
+        display: inline;
+      }
+    }
+
+    .message-timestamp {
+      position: absolute;
+      bottom: 2px;
+      right: 7px;
+      font-size: 12px;
+      color: gray;
+    }
+  }
+}
-- 
2.9.3 (Apple Git-75)


From 4a48a2fba2ff720b4dd7c903cd9ac68522aff7c7 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 18:52:50 +0200
Subject: [PATCH 050/123] Step 4.10: Added images

---
 src/assets/chat-background.jpg | Bin 0 -> 29275 bytes
 src/assets/message-mine.png    | Bin 0 -> 564 bytes
 src/assets/message-other.png   | Bin 0 -> 500 bytes
 3 files changed, 0 insertions(+), 0 deletions(-)
 create mode 100644 src/assets/chat-background.jpg
 create mode 100644 src/assets/message-mine.png
 create mode 100644 src/assets/message-other.png

diff --git a/src/assets/chat-background.jpg b/src/assets/chat-background.jpg
new file mode 100644
index 0000000000000000000000000000000000000000..12cf45ccbab1e100d50efcd26272036456dc90fe
GIT binary patch
literal 29275
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

literal 0
HcmV?d00001

diff --git a/src/assets/message-mine.png b/src/assets/message-mine.png
new file mode 100644
index 0000000000000000000000000000000000000000..a5503eb98d97eaef8d3d24fc6fcc43e6c52d4aff
GIT binary patch
literal 564
zcmV-40?Yl0P)<h;3K|Lk000e1NJLTq000;O001Tk1^@s6-UnMH0005|Nkl<ZcmciD
zPe{{Y9LMqZwzM=e45aBH2s}u18P&yOMMsaFIx0kTi>T<ZLj*x5E9j7@wM#S_(I2Ym
zHq%^gK3n0$_D?4?ESVddL`2x1pCI3Z$k6sYe&Ka}-hB8?WPT<7H(ORKKno^rM*?$Y
z_0wozO-F~b)q-vk=(%|Aum#;DaJsvz9k8MIc5uPXzH3K}F7Un`I%702Hv94d;4l_Y
zx!@h3&R8H>m{dT6vA|p<zUsbp<&XuPB(Nql^P(59>tC>Lb}1YH>Wu~FDzV>QfB$j7
zraK@KU&p<`E&~Bs@h703o|F|D10r3FrusbYW(&327!ZkX6GMRA!~!v$A9G7Yb3h~(
z-(Q!A=79LTH2GjKG`PpYHf<#!A3pXeKk5Q(+82mQ{8zddxvLi5wOQDLZ3RTO9Q%=4
zj^0l!PMnZMIu>jmQ#0w3x;m_e_gmPg)_};Aq7lHMdx6MS)OVoSNFY<1`tmCLxCdy`
z7RZ!TQRPAppZNQ`ola*fuotk`6i5{!xvBY)0pF<SZ0E7gHeer6U-d7&%1?1MS@@7r
zx!|LbnD4y%_NAl10ibEKN2>;=^W(4M3&DYK^34su^7VS2-#g{%a<v03@*p_=>wiRY
zIg$Ym0u8`!piUmsae<G|E(492y7iCcz~D7v@csc+7*{a0)2RCZ0000<MNUMnLSTY$
Cwg*`N

literal 0
HcmV?d00001

diff --git a/src/assets/message-other.png b/src/assets/message-other.png
new file mode 100644
index 0000000000000000000000000000000000000000..a9477becb1931badfe6fdf6e409f9cc60dbae35d
GIT binary patch
literal 500
zcmV<Q0So?#P)<h;3K|Lk000e1NJLTq000;O001Tk1^@s6-UnMH0000PbVXQnQ*UN;
zcVTj606}DLVr3vnZDD6+Qe|Oed2z{QJOBUzmPtfGRCwC7m%mEGP!xxIV@Whx&?STT
zXAlH+EDk<^E|ST)kU?<B>gp!=2o4T{3T_#E2p>R*!7kcC9HroprfH79Kq4{5rcLho
z;E)h<?{|}PbMJ{DqDG1kq9F@PI#wFYum~`Cja2}2Zb6G%FyI#O<{$`yc~*g<C~Mq;
zP3|0QXFrOckVO<l&y*ltfPPjegY;K~(I4iGQl9{V$LteG6`+q@${|&N(Lb;W(Efl5
zkRm|a7UGpffOZ0LPyZl8a6x0JB|w{VDxs19_s$}2Xac4dBy;_VCS+nkvc_B@LYjh7
z0j}?jMx!eneX2mA0Ow2S^bALjY9fkCM_hA%Z5lQBBS@;UFGQ22bcAH!`~EQ&t`Au|
zP*IYFX_~s{d1k-gze7GgtLC6=7R5<vT9&og?RJkKyAH$fP3knw%Mf#p<81YMy%Pv;
zQDnW0`!+<4ACNeIGqJSO>9lOy-Z2bgL)Z0nP1BZDRb9pTzRVp>q(X$+Znt&h?wzGB
qN*NA^r>p|kbr%HJPhiTo00RK`eVB$<^o=V30000<MNUMnLSTZ-*wiHe

literal 0
HcmV?d00001

-- 
2.9.3 (Apple Git-75)


From 5376157a6f17f503b8c90eb8d83841a94f595176 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 18:53:09 +0200
Subject: [PATCH 051/123] Step 4.11: Apply date format pipe to messages view
 template

---
 src/pages/messages/messages.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/pages/messages/messages.html b/src/pages/messages/messages.html
index d12798d..0a7c0fa 100644
--- a/src/pages/messages/messages.html
+++ b/src/pages/messages/messages.html
@@ -18,7 +18,7 @@
     <div *ngFor="let message of messages | async" class="message-wrapper">
       <div [class]="'message message-' + message.ownership">
         <div class="message-content">{{message.content}}</div>
-        <span class="message-timestamp">{{message.createdAt}}</span>
+        <span class="message-timestamp">{{message.createdAt | amDateFormat: 'HH:MM'}}</span>
       </div>
     </div>
   </ion-scroll>
-- 
2.9.3 (Apple Git-75)


From 7af52356267b4638f29ca9dc22f3df73f38daf67 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 18:54:34 +0200
Subject: [PATCH 052/123] Step 4.12: Add message editor to messages view
 template

---
 src/pages/messages/messages.html | 16 ++++++++++++++++
 1 file changed, 16 insertions(+)

diff --git a/src/pages/messages/messages.html b/src/pages/messages/messages.html
index 0a7c0fa..7975a18 100644
--- a/src/pages/messages/messages.html
+++ b/src/pages/messages/messages.html
@@ -23,3 +23,19 @@
     </div>
   </ion-scroll>
 </ion-content>
+
+<ion-footer>
+  <ion-toolbar whatsapp class="messages-page-footer" position="bottom">
+    <ion-input [(ngModel)]="message" (keypress)="onInputKeypress($event)" class="message-editor" placeholder="Type a message"></ion-input>
+
+    <ion-buttons end>
+      <button ion-button icon-only *ngIf="message" class="message-editor-button" (click)="sendMessage()">
+        <ion-icon name="send"></ion-icon>
+      </button>
+
+      <button ion-button icon-only *ngIf="!message" class="message-editor-button">
+        <ion-icon name="mic"></ion-icon>
+      </button>
+    </ion-buttons>
+  </ion-toolbar>
+</ion-footer>
-- 
2.9.3 (Apple Git-75)


From 6549a8e6687e66741de76417c7617ac106ddda69 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 18:54:43 +0200
Subject: [PATCH 053/123] Step 4.13: Add message-editor style to messages
 stylesheet

---
 src/pages/messages/messages.scss | 19 +++++++++++++++++++
 1 file changed, 19 insertions(+)

diff --git a/src/pages/messages/messages.scss b/src/pages/messages/messages.scss
index 33c2b3a..863ecdc 100644
--- a/src/pages/messages/messages.scss
+++ b/src/pages/messages/messages.scss
@@ -91,3 +91,22 @@
     }
   }
 }
+
+.messages-page-footer {
+  padding-right: 0;
+
+  .message-editor {
+    margin-left: 2px;
+    padding-left: 5px;
+    background: white;
+    border-radius: 3px;
+  }
+
+  .message-editor-button {
+    box-shadow: none;
+    width: 50px;
+    height: 50px;
+    font-size: 17px;
+    margin: auto;
+  }
+}
-- 
2.9.3 (Apple Git-75)


From 4a172384dfbf221b859695d162738df636caea13 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 18:55:40 +0200
Subject: [PATCH 054/123] Step 4.14: Add 'sendMessage()' handler to messages
 component

---
 src/pages/messages/messages.ts | 14 ++++++++++++++
 1 file changed, 14 insertions(+)

diff --git a/src/pages/messages/messages.ts b/src/pages/messages/messages.ts
index adf7ed0..28ffc89 100644
--- a/src/pages/messages/messages.ts
+++ b/src/pages/messages/messages.ts
@@ -3,6 +3,7 @@ import { NavParams } from "ionic-angular";
 import { Chat, Message } from "api/models/whatsapp-models";
 import { Messages } from "api/collections/whatsapp-collections";
 import { Observable} from "rxjs";
+import { MeteorObservable } from "meteor-rxjs";
 
 @Component({
   selector: "messages-page",
@@ -13,6 +14,7 @@ export class MessagesPage implements OnInit {
   private title: string;
   private picture: string;
   private messages: Observable<Message[]>;
+  private message: string = "";
 
   constructor(navParams: NavParams) {
     this.selectedChat = <Chat>navParams.get('chat');
@@ -35,5 +37,17 @@ export class MessagesPage implements OnInit {
       return messages;
     });
   }
+
+  onInputKeypress({keyCode}: KeyboardEvent): void {
+    if (keyCode == 13) {
+      this.sendMessage();
+    }
+  }
+
+  sendMessage(): void {
+    MeteorObservable.call('addMessage', this.selectedChat._id, this.message).zone().subscribe(() => {
+      this.message = '';
+    });
+  }
 }
 
-- 
2.9.3 (Apple Git-75)


From 0bc88d28cbf998dc78a7177effb3d2bfc22fc8a7 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 19:02:50 +0200
Subject: [PATCH 055/123] Step 4.15: Add 'addMessage()' method to api

---
 api/server/methods.ts | 21 +++++++++++++++++++++
 1 file changed, 21 insertions(+)
 create mode 100644 api/server/methods.ts

diff --git a/api/server/methods.ts b/api/server/methods.ts
new file mode 100644
index 0000000..2c103f0
--- /dev/null
+++ b/api/server/methods.ts
@@ -0,0 +1,21 @@
+import { Meteor } from 'meteor/meteor';
+import {Chats, Messages} from "../collections/whatsapp-collections";
+
+export function initMethods() {
+  Meteor.methods({
+    addMessage(chatId: string, content: string) {
+      const chatExists = !!Chats.collection.find(chatId).count();
+
+      if (!chatExists) throw new Meteor.Error('chat-not-exists',
+        'Chat doesn\'t exist');
+
+      return {
+        messageId: Messages.collection.insert({
+          chatId: chatId,
+          content: content,
+          createdAt: new Date()
+        })
+      }
+    }
+  });
+}
-- 
2.9.3 (Apple Git-75)


From 8c0c321f1d50b5291b52c4813ce197e43c876662 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 19:03:12 +0200
Subject: [PATCH 056/123] Step 4.16: Init methods in the server side

---
 api/server/main.ts | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/api/server/main.ts b/api/server/main.ts
index 51b7c0c..ffb2997 100644
--- a/api/server/main.ts
+++ b/api/server/main.ts
@@ -1,8 +1,11 @@
 import { Meteor } from 'meteor/meteor';
 import { Chats, Messages } from "../collections/whatsapp-collections";
 import * as moment from "moment";
+import { initMethods } from "./methods";
 
 Meteor.startup(() => {
+  initMethods();
+
   if (Chats.find({}).cursor.count() === 0) {
     let chatId;
 
-- 
2.9.3 (Apple Git-75)


From 27c9c18261b40ac40a6d039df8b22ce795c17d0f Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 19:05:04 +0200
Subject: [PATCH 057/123] Step 4.17: Added check in the server side

---
 api/.meteor/packages | 1 +
 1 file changed, 1 insertion(+)

diff --git a/api/.meteor/packages b/api/.meteor/packages
index c6e3dac..07f406d 100644
--- a/api/.meteor/packages
+++ b/api/.meteor/packages
@@ -21,3 +21,4 @@ shell-server@0.2.1            # Server-side component of the `meteor shell` comm
 autopublish@1.0.7             # Publish all data to the clients (for prototyping)
 insecure@1.0.7                # Allow all DB writes from clients (for prototyping)
 barbatus:typescript
+check
-- 
2.9.3 (Apple Git-75)


From b586ff19ebc1ede24d9684b3d4be9ba6ee54b4fa Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 19:05:55 +0200
Subject: [PATCH 058/123] Step 4.18: Add validations to 'addMessage()' method
 in api

---
 api/server/methods.ts | 11 ++++++++++-
 1 file changed, 10 insertions(+), 1 deletion(-)

diff --git a/api/server/methods.ts b/api/server/methods.ts
index 2c103f0..3b76d86 100644
--- a/api/server/methods.ts
+++ b/api/server/methods.ts
@@ -1,9 +1,18 @@
 import { Meteor } from 'meteor/meteor';
-import {Chats, Messages} from "../collections/whatsapp-collections";
+import { Chats, Messages } from "../collections/whatsapp-collections";
+import { check, Match } from "meteor/check";
+
+const nonEmptyString = Match.Where((str) => {
+  check(str, String);
+  return str.length > 0;
+});
 
 export function initMethods() {
   Meteor.methods({
     addMessage(chatId: string, content: string) {
+      check(chatId, nonEmptyString);
+      check(content, nonEmptyString);
+
       const chatExists = !!Chats.collection.find(chatId).count();
 
       if (!chatExists) throw new Meteor.Error('chat-not-exists',
-- 
2.9.3 (Apple Git-75)


From a81e75a28404edb1d8e66f0cf514e08b31528364 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 19:11:50 +0200
Subject: [PATCH 059/123] Step 4.19: Add an auto scroller to messages component

---
 src/pages/messages/messages.ts | 41 +++++++++++++++++++++++++++++++++++++----
 1 file changed, 37 insertions(+), 4 deletions(-)

diff --git a/src/pages/messages/messages.ts b/src/pages/messages/messages.ts
index 28ffc89..d2c18ad 100644
--- a/src/pages/messages/messages.ts
+++ b/src/pages/messages/messages.ts
@@ -1,27 +1,55 @@
-import { Component, OnInit } from "@angular/core";
+import {Component, OnInit, OnDestroy, ElementRef} from "@angular/core";
 import { NavParams } from "ionic-angular";
 import { Chat, Message } from "api/models/whatsapp-models";
 import { Messages } from "api/collections/whatsapp-collections";
-import { Observable} from "rxjs";
+import { Observable, Subscription } from "rxjs";
 import { MeteorObservable } from "meteor-rxjs";
 
 @Component({
   selector: "messages-page",
   templateUrl: "messages.html"
 })
-export class MessagesPage implements OnInit {
+export class MessagesPage implements OnInit, OnDestroy {
   private selectedChat: Chat;
   private title: string;
   private picture: string;
   private messages: Observable<Message[]>;
   private message: string = "";
+  private autoScroller: Subscription;
 
-  constructor(navParams: NavParams) {
+  constructor(navParams: NavParams, element: ElementRef) {
     this.selectedChat = <Chat>navParams.get('chat');
     this.title = this.selectedChat.title;
     this.picture = this.selectedChat.picture;
   }
 
+  private get messagesPageContent(): Element {
+    return document.querySelector('.messages-page-content');
+  }
+
+  private get messagesPageFooter(): Element {
+    return document.querySelector('.messages-page-footer');
+  }
+
+  private get messagesList(): Element {
+    return this.messagesPageContent.querySelector('.messages');
+  }
+
+  private get messageEditor(): HTMLInputElement {
+    return <HTMLInputElement>this.messagesPageFooter.querySelector('.message-editor');
+  }
+
+  private get scroller(): Element {
+    return this.messagesList.querySelector('.scroll-content');
+  }
+
+  ngOnDestroy() {
+    if (this.autoScroller) {
+      this.autoScroller.unsubscribe();
+      this.autoScroller = undefined;
+    }
+  }
+
   ngOnInit() {
     let isEven = false;
 
@@ -36,6 +64,11 @@ export class MessagesPage implements OnInit {
 
       return messages;
     });
+
+    this.autoScroller = MeteorObservable.autorun().subscribe(() => {
+      this.scroller.scrollTop = this.scroller.scrollHeight;
+      this.messageEditor.focus();
+    });
   }
 
   onInputKeypress({keyCode}: KeyboardEvent): void {
-- 
2.9.3 (Apple Git-75)


From 3539f3a5991f744ad8217e400264dbf5389f2832 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 19:22:57 +0200
Subject: [PATCH 060/123] Step 5.1: Added server packages

---
 api/.meteor/packages |  3 +++
 api/.meteor/versions | 10 ++++++++++
 2 files changed, 13 insertions(+)

diff --git a/api/.meteor/packages b/api/.meteor/packages
index 07f406d..2c9aca3 100644
--- a/api/.meteor/packages
+++ b/api/.meteor/packages
@@ -22,3 +22,6 @@ autopublish@1.0.7             # Publish all data to the clients (for prototyping
 insecure@1.0.7                # Allow all DB writes from clients (for prototyping)
 barbatus:typescript
 check
+accounts-base
+npm-bcrypt
+mys:accounts-phone
diff --git a/api/.meteor/versions b/api/.meteor/versions
index 3a0a89c..769c63e 100644
--- a/api/.meteor/versions
+++ b/api/.meteor/versions
@@ -1,3 +1,4 @@
+accounts-base@1.2.14
 allow-deny@1.0.5
 autopublish@1.0.7
 autoupdate@1.2.11
@@ -19,12 +20,14 @@ check@1.2.4
 ddp@1.2.5
 ddp-client@1.2.9
 ddp-common@1.2.7
+ddp-rate-limiter@1.0.6
 ddp-server@1.2.10
 deps@1.0.12
 diff-sequence@1.0.7
 ecmascript@0.5.9
 ecmascript-runtime@0.3.15
 ejson@1.0.13
+email@1.0.16
 es5-shim@4.6.15
 fastclick@1.0.13
 geojson-utils@1.0.10
@@ -37,6 +40,7 @@ insecure@1.0.7
 jquery@1.11.10
 launch-screen@1.0.12
 livedata@1.0.18
+localstorage@1.0.12
 logging@1.1.16
 meteor@1.6.0
 meteor-base@1.0.4
@@ -49,18 +53,24 @@ modules@0.7.7
 modules-runtime@0.7.7
 mongo@1.1.14
 mongo-id@1.0.6
+mys:accounts-phone@0.0.21
+npm-bcrypt@0.9.2
 npm-mongo@2.2.11_2
 observe-sequence@1.0.14
 ordered-dict@1.0.9
 promise@0.8.8
 random@1.0.10
+rate-limit@1.0.6
 reactive-var@1.0.11
 reload@1.1.11
 retry@1.0.9
 routepolicy@1.0.12
+service-configuration@1.0.11
+sha@1.0.9
 shell-server@0.2.1
 spacebars@1.0.13
 spacebars-compiler@1.0.13
+srp@1.0.10
 standard-minifier-css@1.3.2
 standard-minifier-js@1.2.1
 templating@1.2.15
-- 
2.9.3 (Apple Git-75)


From 782a2d0d2b0771eea536ebc552ecfbff388ce589 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 19:23:07 +0200
Subject: [PATCH 061/123] Step 5.2: Added settings file

---
 api/private/settings.json | 8 ++++++++
 1 file changed, 8 insertions(+)
 create mode 100644 api/private/settings.json

diff --git a/api/private/settings.json b/api/private/settings.json
new file mode 100644
index 0000000..070dbe1
--- /dev/null
+++ b/api/private/settings.json
@@ -0,0 +1,8 @@
+{
+  "accounts-phone": {
+    "verificationWaitTime": 0,
+    "verificationRetriesWaitTime": 0,
+    "adminPhoneNumbers": ["+9721234567", "+97212345678", "+97212345679"],
+    "phoneVerificationMasterCode": "1234"
+  }
+}
-- 
2.9.3 (Apple Git-75)


From 934b4960799be52f93193d34a0a4f304191355f1 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 19:23:29 +0200
Subject: [PATCH 062/123] Step 5.3: Updated NPM script

---
 api/package.json | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/api/package.json b/api/package.json
index c618752..4e9418d 100644
--- a/api/package.json
+++ b/api/package.json
@@ -2,7 +2,7 @@
   "name": "api",
   "private": true,
   "scripts": {
-    "start": "meteor run"
+    "start": "meteor run --settings private/settings.json"
   },
   "dependencies": {
     "@types/moment": "^2.13.0",
-- 
2.9.3 (Apple Git-75)


From d8985f0745edc6d7199aad94a4c78233fafe499f Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 19:26:21 +0200
Subject: [PATCH 063/123] Step 5.4: Define SMS settings

---
 api/server/main.ts | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/api/server/main.ts b/api/server/main.ts
index ffb2997..dcd79c4 100644
--- a/api/server/main.ts
+++ b/api/server/main.ts
@@ -2,10 +2,18 @@ import { Meteor } from 'meteor/meteor';
 import { Chats, Messages } from "../collections/whatsapp-collections";
 import * as moment from "moment";
 import { initMethods } from "./methods";
+import { Accounts } from 'meteor/accounts-base';
+
+declare let SMS, Object;
 
 Meteor.startup(() => {
   initMethods();
 
+  if (Meteor.settings) {
+    Object.assign(Accounts._options, Meteor.settings['accounts-phone']);
+    SMS.twilio = Meteor.settings['twilio'];
+  }
+
   if (Chats.find({}).cursor.count() === 0) {
     let chatId;
 
-- 
2.9.3 (Apple Git-75)


From 45ecb93447643dacb43a973eb48157d238c014ab Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 19:28:10 +0200
Subject: [PATCH 064/123] Step 5.5: Added accounts packages to client side

---
 package.json | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/package.json b/package.json
index 5b7657d..be9f2ab 100644
--- a/package.json
+++ b/package.json
@@ -23,6 +23,8 @@
     "@angular/platform-browser-dynamic": "2.0.0",
     "@angular/platform-server": "2.0.0",
     "@ionic/storage": "1.1.6",
+    "accounts-base-client-side": "^0.1.1",
+    "accounts-phone": "0.0.1",
     "angular2-moment": "^1.0.0-beta.6",
     "ionic-angular": "2.0.0-rc.1",
     "ionic-native": "2.2.3",
-- 
2.9.3 (Apple Git-75)


From 6784f4ec72fd8be01fae6180d2a9d0836f8ff762 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 19:28:20 +0200
Subject: [PATCH 065/123] Step 5.6: Import accounts packages in client side

---
 src/app/main.dev.ts | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/src/app/main.dev.ts b/src/app/main.dev.ts
index 7872830..11ddf38 100644
--- a/src/app/main.dev.ts
+++ b/src/app/main.dev.ts
@@ -1,5 +1,7 @@
 import 'reflect-metadata';
 import 'meteor-client-side';
+import 'accounts-base-client-side';
+import 'accounts-phone';
 
 import { platformBrowserDynamic } from '@angular/platform-browser-dynamic';
 
-- 
2.9.3 (Apple Git-75)


From 67faf749d8e17db1dcf3e665e1d625b448f7a240 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 19:31:16 +0200
Subject: [PATCH 066/123] Step 5.7: Wait for user if logging in

---
 src/app/main.dev.ts | 14 ++++++++++++--
 1 file changed, 12 insertions(+), 2 deletions(-)

diff --git a/src/app/main.dev.ts b/src/app/main.dev.ts
index 11ddf38..9143254 100644
--- a/src/app/main.dev.ts
+++ b/src/app/main.dev.ts
@@ -4,7 +4,17 @@ import 'accounts-base-client-side';
 import 'accounts-phone';
 
 import { platformBrowserDynamic } from '@angular/platform-browser-dynamic';
-
 import { AppModule } from './app.module';
+import { MeteorObservable } from 'meteor-rxjs';
+
+Meteor.startup(() => {
+  const sub = MeteorObservable.autorun().subscribe(() => {
+    if (Meteor.loggingIn()) return;
+
+    setTimeout(() => {
+      sub.unsubscribe();
+    });
 
-platformBrowserDynamic().bootstrapModule(AppModule);
+    platformBrowserDynamic().bootstrapModule(AppModule);
+  });
+});
-- 
2.9.3 (Apple Git-75)


From 00c65eff330a879370fd85068a39d93ef1bbdc7f Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 19:38:13 +0200
Subject: [PATCH 067/123] Step 5.8: Create login component

---
 src/pages/auth/login.ts | 69 +++++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 69 insertions(+)
 create mode 100644 src/pages/auth/login.ts

diff --git a/src/pages/auth/login.ts b/src/pages/auth/login.ts
new file mode 100644
index 0000000..68856b3
--- /dev/null
+++ b/src/pages/auth/login.ts
@@ -0,0 +1,69 @@
+import { Component } from '@angular/core';
+import { NavController, AlertController } from 'ionic-angular';
+
+declare let Accounts;
+
+@Component({
+  selector: 'login',
+  templateUrl: "login.html"
+})
+export class LoginComponent {
+  phone = '';
+
+  constructor(
+    private navCtrl: NavController,
+    private alertCtrl: AlertController
+  ) {}
+
+  onInputKeypress({keyCode}: KeyboardEvent): void {
+    if (keyCode == 13) {
+      this.login();
+    }
+  }
+
+  login(): void {
+    const alert = this.alertCtrl.create({
+      title: 'Confirm',
+      message: `Would you like to proceed with the phone number ${this.phone}?`,
+      buttons: [
+        {
+          text: 'Cancel',
+          role: 'cancel'
+        },
+        {
+          text: 'Yes',
+          handler: () => {
+            this.handleLogin(alert);
+            return false;
+          }
+        }
+      ]
+    });
+
+    alert.present();
+  }
+
+  private handleLogin(alert): void {
+    Accounts.requestPhoneVerification(this.phone, (e: Error) => {
+      alert.dismiss().then(() => {
+        if (e) return this.handleError(e);
+
+        // this.navCtrl.push(VerificationComponent, {
+        //   phone: this.phone
+        // });
+      });
+    });
+  }
+
+  private handleError(e: Error): void {
+    console.error(e);
+
+    const alert = this.alertCtrl.create({
+      title: 'Oops!',
+      message: e.message,
+      buttons: ['OK']
+    });
+
+    alert.present();
+  }
+}
-- 
2.9.3 (Apple Git-75)


From 0c75c5f5831495678c71ea9d8f629c95203c7e0b Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 19:38:28 +0200
Subject: [PATCH 068/123] Step 5.9: Create login component view

---
 src/pages/auth/login.html | 25 +++++++++++++++++++++++++
 1 file changed, 25 insertions(+)
 create mode 100644 src/pages/auth/login.html

diff --git a/src/pages/auth/login.html b/src/pages/auth/login.html
new file mode 100644
index 0000000..4f1054d
--- /dev/null
+++ b/src/pages/auth/login.html
@@ -0,0 +1,25 @@
+<ion-header>
+  <ion-navbar whatsapp>
+    <ion-title>Login</ion-title>
+
+    <ion-buttons end>
+      <button ion-button class="done-button" (click)="login()">Done</button>
+    </ion-buttons>
+  </ion-navbar>
+</ion-header>
+
+<ion-content padding class="login-page-content">
+  <div class="instructions">
+    <div>
+      Please enter your phone number including its country code.
+    </div>
+    <br>
+    <div>
+      The messenger will send a one time SMS message to verify your phone number. Carrier SMS charges may apply.
+    </div>
+  </div>
+
+  <ion-item>
+    <ion-input [(ngModel)]="phone" (keypress)="onInputKeypress($event)" type="tel" placeholder="Your phone number"></ion-input>
+  </ion-item>
+</ion-content>
-- 
2.9.3 (Apple Git-75)


From 32965b0156c2c843896cadda1528e6c69338d866 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 19:38:38 +0200
Subject: [PATCH 069/123] Step 5.10: Add login component view style

---
 src/pages/auth/login.scss | 11 +++++++++++
 1 file changed, 11 insertions(+)
 create mode 100644 src/pages/auth/login.scss

diff --git a/src/pages/auth/login.scss b/src/pages/auth/login.scss
new file mode 100644
index 0000000..3b24972
--- /dev/null
+++ b/src/pages/auth/login.scss
@@ -0,0 +1,11 @@
+.login-page-content {
+  .instructions {
+    text-align: center;
+    font-size: medium;
+    margin: 50px;
+  }
+
+  .text-input {
+    text-align: center;
+  }
+}
-- 
2.9.3 (Apple Git-75)


From a2dcbaa323aa1d9e577a766c639e9d7c06819b9f Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 19:38:55 +0200
Subject: [PATCH 070/123] Step 5.11: Add login component to NgModule

---
 src/app/app.module.ts | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/src/app/app.module.ts b/src/app/app.module.ts
index 0db4be3..587a2b4 100644
--- a/src/app/app.module.ts
+++ b/src/app/app.module.ts
@@ -5,13 +5,15 @@ import { TabsPage } from '../pages/tabs/tabs';
 import { ChatsPage } from "../pages/chats/chats";
 import { MomentModule } from "angular2-moment";
 import { MessagesPage } from "../pages/messages/messages";
+import { LoginComponent } from "../pages/auth/login";
 
 @NgModule({
   declarations: [
     MyApp,
     ChatsPage,
     TabsPage,
-    MessagesPage
+    MessagesPage,
+    LoginComponent
   ],
   imports: [
     IonicModule.forRoot(MyApp),
@@ -22,7 +24,8 @@ import { MessagesPage } from "../pages/messages/messages";
     MyApp,
     ChatsPage,
     TabsPage,
-    MessagesPage
+    MessagesPage,
+    LoginComponent
   ],
   providers: []
 })
-- 
2.9.3 (Apple Git-75)


From 224ef41f0a49d98cb4d04d9396becbf33f87ea26 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 19:39:12 +0200
Subject: [PATCH 071/123] Step 5.12: Add user identifiation in app's main
 component

---
 src/app/app.component.ts | 7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

diff --git a/src/app/app.component.ts b/src/app/app.component.ts
index 218886a..102d39a 100644
--- a/src/app/app.component.ts
+++ b/src/app/app.component.ts
@@ -1,17 +1,18 @@
 import { Component } from '@angular/core';
 import { Platform } from 'ionic-angular';
 import { StatusBar, Splashscreen } from 'ionic-native';
-
 import { TabsPage } from '../pages/tabs/tabs';
-
+import { LoginComponent } from '../pages/auth/login';
 
 @Component({
   template: `<ion-nav [root]="rootPage"></ion-nav>`
 })
 export class MyApp {
-  rootPage = TabsPage;
+  rootPage: any;
 
   constructor(platform: Platform) {
+    this.rootPage = Meteor.user() ? TabsPage : LoginComponent;
+
     platform.ready().then(() => {
       // Okay, so the platform is ready and our plugins are available.
       // Here you can do any higher level native things you might need.
-- 
2.9.3 (Apple Git-75)


From 5f87b8f1459a290e06ecb0b28547d4da5eda6db1 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 19:41:21 +0200
Subject: [PATCH 072/123] Step 5.13: Add verification component

---
 src/pages/verification/verification.ts | 53 ++++++++++++++++++++++++++++++++++
 1 file changed, 53 insertions(+)
 create mode 100644 src/pages/verification/verification.ts

diff --git a/src/pages/verification/verification.ts b/src/pages/verification/verification.ts
new file mode 100644
index 0000000..57d102b
--- /dev/null
+++ b/src/pages/verification/verification.ts
@@ -0,0 +1,53 @@
+import { Component, OnInit, NgZone } from '@angular/core';
+import { NavController, NavParams, AlertController } from 'ionic-angular';
+
+declare let Accounts;
+
+@Component({
+  selector: 'verification',
+  templateUrl: 'verification.html'
+})
+export class VerificationComponent implements OnInit {
+  code: string = '';
+  phone: string;
+
+  constructor(
+    private navCtrl: NavController,
+    private alertCtrl: AlertController,
+    private zone: NgZone,
+    private navParams: NavParams) {}
+
+  ngOnInit() {
+    this.phone = this.navParams.get('phone');
+  }
+
+  onInputKeypress({keyCode}: KeyboardEvent): void {
+    if (keyCode == 13) {
+      this.verify();
+    }
+  }
+
+  verify(): void {
+    Accounts.verifyPhone(this.phone, this.code, (e: Error) => {
+      this.zone.run(() => {
+        if (e) return this.handleError(e);
+
+        // this.navCtrl.setRoot(ProfileComponent, {}, {
+        //   animate: true
+        // });
+      });
+    });
+  }
+
+  private handleError(e: Error): void {
+    console.error(e);
+
+    const alert = this.alertCtrl.create({
+      title: 'Oops!',
+      message: e.message,
+      buttons: ['OK']
+    });
+
+    alert.present();
+  }
+}
-- 
2.9.3 (Apple Git-75)


From 4ac30a90bbbeebb7dccc6d0cc82173eeafd888b1 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 19:41:32 +0200
Subject: [PATCH 073/123] Step 5.14: Add verification component view

---
 src/pages/verification/verification.html | 25 +++++++++++++++++++++++++
 1 file changed, 25 insertions(+)
 create mode 100644 src/pages/verification/verification.html

diff --git a/src/pages/verification/verification.html b/src/pages/verification/verification.html
new file mode 100644
index 0000000..da46cd2
--- /dev/null
+++ b/src/pages/verification/verification.html
@@ -0,0 +1,25 @@
+<ion-header>
+  <ion-navbar whatsapp>
+    <ion-title>Verification</ion-title>
+
+    <ion-buttons end>
+      <button class="verify-button" (click)="verify()">Verify</button>
+    </ion-buttons>
+  </ion-navbar>
+</ion-header>
+
+<ion-content padding class="verification-page-content">
+  <div class="instructions">
+    <div>
+      An SMS message with the verification code has been sent to {{phone}}.
+    </div>
+    <br>
+    <div>
+      To proceed, please enter the 4-digit verification code below.
+    </div>
+  </div>
+
+  <ion-item>
+    <ion-input [(ngModel)]="code" (keypress)="onInputKeypress($event)" type="tel" placeholder="Your verification code"></ion-input>
+  </ion-item>
+</ion-content>
-- 
2.9.3 (Apple Git-75)


From 3c2dfde2538c35edd8ce35ee648078d84b07969a Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 19:41:43 +0200
Subject: [PATCH 074/123] Step 5.15: Add verification component styles

---
 src/pages/verification/verification.scss | 11 +++++++++++
 1 file changed, 11 insertions(+)
 create mode 100644 src/pages/verification/verification.scss

diff --git a/src/pages/verification/verification.scss b/src/pages/verification/verification.scss
new file mode 100644
index 0000000..03d46ba
--- /dev/null
+++ b/src/pages/verification/verification.scss
@@ -0,0 +1,11 @@
+.verification-page-content {
+  .instructions {
+    text-align: center;
+    font-size: medium;
+    margin: 50px;
+  }
+
+  .text-input {
+    text-align: center;
+  }
+}
-- 
2.9.3 (Apple Git-75)


From a1acf19269f970c4c48af4297389973e24e63378 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 19:42:51 +0200
Subject: [PATCH 075/123] Step 5.16: Add VerificationComponent to NgModule

---
 src/app/app.module.ts | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/src/app/app.module.ts b/src/app/app.module.ts
index 587a2b4..11592ac 100644
--- a/src/app/app.module.ts
+++ b/src/app/app.module.ts
@@ -6,6 +6,7 @@ import { ChatsPage } from "../pages/chats/chats";
 import { MomentModule } from "angular2-moment";
 import { MessagesPage } from "../pages/messages/messages";
 import { LoginComponent } from "../pages/auth/login";
+import { VerificationComponent } from "../pages/verification/verification";
 
 @NgModule({
   declarations: [
@@ -13,7 +14,8 @@ import { LoginComponent } from "../pages/auth/login";
     ChatsPage,
     TabsPage,
     MessagesPage,
-    LoginComponent
+    LoginComponent,
+    VerificationComponent
   ],
   imports: [
     IonicModule.forRoot(MyApp),
@@ -25,7 +27,8 @@ import { LoginComponent } from "../pages/auth/login";
     ChatsPage,
     TabsPage,
     MessagesPage,
-    LoginComponent
+    LoginComponent,
+    VerificationComponent
   ],
   providers: []
 })
-- 
2.9.3 (Apple Git-75)


From 5801e325c78bb20913a5c7d401a40883f3e7302d Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 19:43:26 +0200
Subject: [PATCH 076/123] Step 5.17: Add navigation to verification page from
 the login component

---
 src/pages/auth/login.ts | 7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

diff --git a/src/pages/auth/login.ts b/src/pages/auth/login.ts
index 68856b3..650cdd4 100644
--- a/src/pages/auth/login.ts
+++ b/src/pages/auth/login.ts
@@ -1,5 +1,6 @@
 import { Component } from '@angular/core';
 import { NavController, AlertController } from 'ionic-angular';
+import { VerificationComponent } from "../verification/verification";
 
 declare let Accounts;
 
@@ -48,9 +49,9 @@ export class LoginComponent {
       alert.dismiss().then(() => {
         if (e) return this.handleError(e);
 
-        // this.navCtrl.push(VerificationComponent, {
-        //   phone: this.phone
-        // });
+        this.navCtrl.push(VerificationComponent, {
+          phone: this.phone
+        });
       });
     });
   }
-- 
2.9.3 (Apple Git-75)


From 1035232f535b3ab63b4478fc56314387e7b398ed Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 19:53:40 +0200
Subject: [PATCH 077/123] Step 5.18: Add profile model decleration

---
 api/models/whatsapp-models.d.ts | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/api/models/whatsapp-models.d.ts b/api/models/whatsapp-models.d.ts
index 51c5991..2a3fadf 100644
--- a/api/models/whatsapp-models.d.ts
+++ b/api/models/whatsapp-models.d.ts
@@ -1,4 +1,9 @@
 declare module 'api/models/whatsapp-models' {
+  interface Profile {
+    name?: string;
+    picture?: string;
+  }
+
   interface Chat {
     _id?: string;
     title?: string;
-- 
2.9.3 (Apple Git-75)


From 7edaeaaeff173841d4bb0d041c8548e72769f804 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 19:55:52 +0200
Subject: [PATCH 078/123] Step 5.19: Add profile component

---
 src/pages/profile/profile.ts | 50 ++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 50 insertions(+)
 create mode 100644 src/pages/profile/profile.ts

diff --git a/src/pages/profile/profile.ts b/src/pages/profile/profile.ts
new file mode 100644
index 0000000..16a2396
--- /dev/null
+++ b/src/pages/profile/profile.ts
@@ -0,0 +1,50 @@
+import { Component, OnInit } from '@angular/core';
+import { NavController, AlertController } from 'ionic-angular';
+import { MeteorObservable } from 'meteor-rxjs';
+import { Profile } from 'api/models/whatsapp-models';
+import { TabsPage } from "../tabs/tabs";
+
+declare let Meteor;
+
+@Component({
+  selector: 'profile',
+  templateUrl: 'profile.html'
+})
+export class ProfileComponent implements OnInit {
+  profile: Profile;
+
+  constructor(
+    private navCtrl: NavController,
+    private alertCtrl: AlertController
+  ) {}
+
+  ngOnInit(): void {
+    this.profile = Meteor.user().profile || {
+        name: '',
+        picture: '/ionicons/svg/ios-contact.svg'
+      };
+  }
+
+  done(): void {
+    MeteorObservable.call('updateProfile', this.profile).subscribe({
+      next: () => {
+        this.navCtrl.push(TabsPage);
+      },
+      error: (e: Error) => {
+        this.handleError(e);
+      }
+    });
+  }
+
+  private handleError(e: Error): void {
+    console.error(e);
+
+    const alert = this.alertCtrl.create({
+      title: 'Oops!',
+      message: e.message,
+      buttons: ['OK']
+    });
+
+    alert.present();
+  }
+}
-- 
2.9.3 (Apple Git-75)


From 39792a536b836311be5c5d09b4542033ab10d965 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 19:56:12 +0200
Subject: [PATCH 079/123] Step 5.20: Add profile component view

---
 src/pages/profile/profile.html | 21 +++++++++++++++++++++
 1 file changed, 21 insertions(+)
 create mode 100644 src/pages/profile/profile.html

diff --git a/src/pages/profile/profile.html b/src/pages/profile/profile.html
new file mode 100644
index 0000000..185fd03
--- /dev/null
+++ b/src/pages/profile/profile.html
@@ -0,0 +1,21 @@
+<ion-header>
+  <ion-navbar whatsapp>
+    <ion-title>Profile</ion-title>
+
+    <ion-buttons end>
+      <button ion-button class="done-button" (click)="done()">Done</button>
+    </ion-buttons>
+  </ion-navbar>
+</ion-header>
+
+<ion-content class="profile-page-content">
+  <div class="profile-picture">
+    <img [src]="profile.picture">
+    <ion-icon name="create"></ion-icon>
+  </div>
+
+  <ion-item class="profile-name">
+    <ion-label stacked>Name</ion-label>
+    <ion-input [(ngModel)]="profile.name" placeholder="Your name"></ion-input>
+  </ion-item>
+</ion-content>
-- 
2.9.3 (Apple Git-75)


From deea7da810cad142fce2bfe558872ba7eddf0a46 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 19:56:19 +0200
Subject: [PATCH 080/123] Step 5.21: Add profile component view style

---
 src/pages/profile/profile.scss | 20 ++++++++++++++++++++
 1 file changed, 20 insertions(+)
 create mode 100644 src/pages/profile/profile.scss

diff --git a/src/pages/profile/profile.scss b/src/pages/profile/profile.scss
new file mode 100644
index 0000000..2309800
--- /dev/null
+++ b/src/pages/profile/profile.scss
@@ -0,0 +1,20 @@
+.profile-page-content {
+  .profile-picture {
+    max-width: 300px;
+    display: block;
+    margin: auto;
+
+    img {
+      margin-bottom: -33px;
+      width: 100%;
+    }
+
+    ion-icon {
+      float: right;
+      font-size: 30px;
+      opacity: 0.5;
+      border-left: black solid 1px;
+      padding-left: 5px;
+    }
+  }
+}
-- 
2.9.3 (Apple Git-75)


From aca756c844f1aa801e1ded929d1bb10bf6a3f932 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 19:56:44 +0200
Subject: [PATCH 081/123] Step 5.22: Add profile component to NgModule

---
 src/app/app.module.ts | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/src/app/app.module.ts b/src/app/app.module.ts
index 11592ac..d06c2f7 100644
--- a/src/app/app.module.ts
+++ b/src/app/app.module.ts
@@ -7,6 +7,7 @@ import { MomentModule } from "angular2-moment";
 import { MessagesPage } from "../pages/messages/messages";
 import { LoginComponent } from "../pages/auth/login";
 import { VerificationComponent } from "../pages/verification/verification";
+import { ProfileComponent } from "../pages/profile/profile";
 
 @NgModule({
   declarations: [
@@ -15,7 +16,8 @@ import { VerificationComponent } from "../pages/verification/verification";
     TabsPage,
     MessagesPage,
     LoginComponent,
-    VerificationComponent
+    VerificationComponent,
+    ProfileComponent
   ],
   imports: [
     IonicModule.forRoot(MyApp),
@@ -28,7 +30,8 @@ import { VerificationComponent } from "../pages/verification/verification";
     TabsPage,
     MessagesPage,
     LoginComponent,
-    VerificationComponent
+    VerificationComponent,
+    ProfileComponent
   ],
   providers: []
 })
-- 
2.9.3 (Apple Git-75)


From 40e62bd235b79035fb6d534923e175dd73cf3aad Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 19:57:11 +0200
Subject: [PATCH 082/123] Step 5.23: Add profile component to verification
 navigation

---
 src/pages/verification/verification.ts | 7 ++++---
 1 file changed, 4 insertions(+), 3 deletions(-)

diff --git a/src/pages/verification/verification.ts b/src/pages/verification/verification.ts
index 57d102b..98e1c10 100644
--- a/src/pages/verification/verification.ts
+++ b/src/pages/verification/verification.ts
@@ -1,5 +1,6 @@
 import { Component, OnInit, NgZone } from '@angular/core';
 import { NavController, NavParams, AlertController } from 'ionic-angular';
+import { ProfileComponent } from "../profile/profile";
 
 declare let Accounts;
 
@@ -32,9 +33,9 @@ export class VerificationComponent implements OnInit {
       this.zone.run(() => {
         if (e) return this.handleError(e);
 
-        // this.navCtrl.setRoot(ProfileComponent, {}, {
-        //   animate: true
-        // });
+        this.navCtrl.setRoot(ProfileComponent, {}, {
+          animate: true
+        });
       });
     });
   }
-- 
2.9.3 (Apple Git-75)


From b1a1cdbabffc7ae33affbfda9f8b65aa63f67a19 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 19:57:54 +0200
Subject: [PATCH 083/123] Step 5.24: Add senderId property to addMessage method

---
 api/server/methods.ts | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/api/server/methods.ts b/api/server/methods.ts
index 3b76d86..974c0e7 100644
--- a/api/server/methods.ts
+++ b/api/server/methods.ts
@@ -10,6 +10,9 @@ const nonEmptyString = Match.Where((str) => {
 export function initMethods() {
   Meteor.methods({
     addMessage(chatId: string, content: string) {
+      if (!this.userId) throw new Meteor.Error('unauthorized',
+        'User must be logged-in to create a new chat');
+
       check(chatId, nonEmptyString);
       check(content, nonEmptyString);
 
@@ -20,6 +23,7 @@ export function initMethods() {
 
       return {
         messageId: Messages.collection.insert({
+          senderId: this.userId,
           chatId: chatId,
           content: content,
           createdAt: new Date()
-- 
2.9.3 (Apple Git-75)


From 851ff536f1ee45bdd6ae94ecece223e0d181a1c2 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 19:58:14 +0200
Subject: [PATCH 084/123] Step 5.25: Add it also to the model

---
 api/models/whatsapp-models.d.ts | 1 +
 1 file changed, 1 insertion(+)

diff --git a/api/models/whatsapp-models.d.ts b/api/models/whatsapp-models.d.ts
index 2a3fadf..3cd220e 100644
--- a/api/models/whatsapp-models.d.ts
+++ b/api/models/whatsapp-models.d.ts
@@ -17,5 +17,6 @@ declare module 'api/models/whatsapp-models' {
     content?: string;
     createdAt?: Date;
     ownership?: string;
+    senderId?: string;
   }
 }
-- 
2.9.3 (Apple Git-75)


From 08794850e6fe023ca71c9501d48d5f7a11d0eb3b Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 19:59:27 +0200
Subject: [PATCH 085/123] Step 5.26: Determine message ownership based on
 sender id

---
 src/pages/messages/messages.ts | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/src/pages/messages/messages.ts b/src/pages/messages/messages.ts
index d2c18ad..ec3ea4b 100644
--- a/src/pages/messages/messages.ts
+++ b/src/pages/messages/messages.ts
@@ -16,11 +16,14 @@ export class MessagesPage implements OnInit, OnDestroy {
   private messages: Observable<Message[]>;
   private message: string = "";
   private autoScroller: Subscription;
+  private senderId: string;
 
   constructor(navParams: NavParams, element: ElementRef) {
     this.selectedChat = <Chat>navParams.get('chat');
     this.title = this.selectedChat.title;
     this.picture = this.selectedChat.picture;
+    this.senderId = Meteor.userId();
+
   }
 
   private get messagesPageContent(): Element {
@@ -51,15 +54,12 @@ export class MessagesPage implements OnInit, OnDestroy {
   }
 
   ngOnInit() {
-    let isEven = false;
-
     this.messages = Messages.find(
       {chatId: this.selectedChat._id},
       {sort: {createdAt: 1}}
     ).map((messages: Message[]) => {
       messages.forEach((message: Message) => {
-        message.ownership = isEven ? 'mine' : 'other';
-        isEven = !isEven;
+        message.ownership = this.senderId == message.senderId ? 'mine' : 'other';
       });
 
       return messages;
-- 
2.9.3 (Apple Git-75)


From 17dcf0cab1f65bc0dd1538d82ce2a8a5ae907921 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 20:05:38 +0200
Subject: [PATCH 086/123] Step 5.27: Add chats-options component

---
 src/pages/chat-options/chat-options.ts | 72 ++++++++++++++++++++++++++++++++++
 1 file changed, 72 insertions(+)
 create mode 100644 src/pages/chat-options/chat-options.ts

diff --git a/src/pages/chat-options/chat-options.ts b/src/pages/chat-options/chat-options.ts
new file mode 100644
index 0000000..5cd8ac4
--- /dev/null
+++ b/src/pages/chat-options/chat-options.ts
@@ -0,0 +1,72 @@
+import { Component } from '@angular/core';
+import { NavController, ViewController, AlertController } from 'ionic-angular';
+import { ProfileComponent } from '../profile/profile';
+import { LoginComponent } from '../auth/login';
+
+declare let Meteor;
+
+@Component({
+  selector: 'chats-options',
+  templateUrl: 'chat-options.html'
+})
+export class ChatsOptionsComponent {
+  constructor(
+    private navCtrl: NavController,
+    private viewCtrl: ViewController,
+    private alertCtrl: AlertController
+  ) {}
+
+  editProfile(): void {
+    this.viewCtrl.dismiss().then(() => {
+      this.navCtrl.push(ProfileComponent);
+    });
+  }
+
+  logout(): void {
+    const alert = this.alertCtrl.create({
+      title: 'Logout',
+      message: 'Are you sure you would like to proceed?',
+      buttons: [
+        {
+          text: 'Cancel',
+          role: 'cancel'
+        },
+        {
+          text: 'Yes',
+          handler: () => {
+            this.handleLogout(alert);
+            return false;
+          }
+        }
+      ]
+    });
+
+    this.viewCtrl.dismiss().then(() => {
+      alert.present();
+    });
+  }
+
+  private handleLogout(alert): void {
+    Meteor.logout((e: Error) => {
+      alert.dismiss().then(() => {
+        if (e) return this.handleError(e);
+
+        this.navCtrl.setRoot(LoginComponent, {}, {
+          animate: true
+        });
+      });
+    });
+  }
+
+  private handleError(e: Error): void {
+    console.error(e);
+
+    const alert = this.alertCtrl.create({
+      title: 'Oops!',
+      message: e.message,
+      buttons: ['OK']
+    });
+
+    alert.present();
+  }
+}
-- 
2.9.3 (Apple Git-75)


From 5f69b43a26cd90ea5ec9b76c7a2bda272687eeea Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 20:05:47 +0200
Subject: [PATCH 087/123] Step 5.28: Add chats-options component view

---
 src/pages/chat-options/chat-options.html | 18 ++++++++++++++++++
 1 file changed, 18 insertions(+)
 create mode 100644 src/pages/chat-options/chat-options.html

diff --git a/src/pages/chat-options/chat-options.html b/src/pages/chat-options/chat-options.html
new file mode 100644
index 0000000..1afa074
--- /dev/null
+++ b/src/pages/chat-options/chat-options.html
@@ -0,0 +1,18 @@
+<ion-content class="chats-options-page-content">
+  <ion-list class="options">
+    <button ion-item class="option option-profile" (click)="editProfile()">
+      <ion-icon name="contact" class="option-icon"></ion-icon>
+      <div class="option-name">Profile</div>
+    </button>
+
+    <button ion-item class="option option-about">
+      <ion-icon name="information-circle" class="option-icon"></ion-icon>
+      <div class="option-name">About</div>
+    </button>
+
+    <button ion-item class="option option-logout" (click)="logout()">
+      <ion-icon name="log-out" class="option-icon"></ion-icon>
+      <div class="option-name">Logout</div>
+    </button>
+  </ion-list>
+</ion-content>
-- 
2.9.3 (Apple Git-75)


From cb5a29bd12fc97dec0e507ac5b629213c46afb9c Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 20:05:56 +0200
Subject: [PATCH 088/123] Step 5.29: Add chats-options component view style

---
 src/pages/chat-options/chat-options.scss | 13 +++++++++++++
 1 file changed, 13 insertions(+)
 create mode 100644 src/pages/chat-options/chat-options.scss

diff --git a/src/pages/chat-options/chat-options.scss b/src/pages/chat-options/chat-options.scss
new file mode 100644
index 0000000..0e4d0ee
--- /dev/null
+++ b/src/pages/chat-options/chat-options.scss
@@ -0,0 +1,13 @@
+.chats-options-page-content {
+  .options {
+    margin: 0;
+  }
+
+  .option-name {
+    float: left;
+  }
+
+  .option-icon {
+    float: right;
+  }
+}
-- 
2.9.3 (Apple Git-75)


From 70eeb37521e020e9dea2341453dfcca0a5f0a19a Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 20:06:09 +0200
Subject: [PATCH 089/123] Step 5.30: Add chats-options component to the module
 definition

---
 src/app/app.module.ts | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/src/app/app.module.ts b/src/app/app.module.ts
index d06c2f7..2780d17 100644
--- a/src/app/app.module.ts
+++ b/src/app/app.module.ts
@@ -8,6 +8,7 @@ import { MessagesPage } from "../pages/messages/messages";
 import { LoginComponent } from "../pages/auth/login";
 import { VerificationComponent } from "../pages/verification/verification";
 import { ProfileComponent } from "../pages/profile/profile";
+import { ChatsOptionsComponent } from "../pages/chat-options/chat-options";
 
 @NgModule({
   declarations: [
@@ -17,7 +18,8 @@ import { ProfileComponent } from "../pages/profile/profile";
     MessagesPage,
     LoginComponent,
     VerificationComponent,
-    ProfileComponent
+    ProfileComponent,
+    ChatsOptionsComponent
   ],
   imports: [
     IonicModule.forRoot(MyApp),
@@ -31,7 +33,8 @@ import { ProfileComponent } from "../pages/profile/profile";
     MessagesPage,
     LoginComponent,
     VerificationComponent,
-    ProfileComponent
+    ProfileComponent,
+    ChatsOptionsComponent
   ],
   providers: []
 })
-- 
2.9.3 (Apple Git-75)


From 55e71369701fb1508c517d3c02b8092b086eb283 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 20:06:24 +0200
Subject: [PATCH 090/123] Step 5.31: Use the popover component

---
 src/pages/chats/chats.ts | 13 +++++++++++--
 1 file changed, 11 insertions(+), 2 deletions(-)

diff --git a/src/pages/chats/chats.ts b/src/pages/chats/chats.ts
index a7bb1dd..382a5e3 100644
--- a/src/pages/chats/chats.ts
+++ b/src/pages/chats/chats.ts
@@ -2,8 +2,9 @@ import { Component, OnInit } from '@angular/core';
 import { Observable } from "rxjs";
 import { Chat } from "api/models/whatsapp-models";
 import { Chats, Messages } from "api/collections/whatsapp-collections";
-import { NavController } from "ionic-angular";
+import { NavController, PopoverController } from "ionic-angular";
 import { MessagesPage } from "../messages/messages";
+import { ChatsOptionsComponent } from "../chat-options/chat-options";
 
 @Component({
   templateUrl: 'chats.html'
@@ -11,7 +12,7 @@ import { MessagesPage } from "../messages/messages";
 export class ChatsPage implements OnInit {
   private chats;
 
-  constructor(private navCtrl: NavController) {
+  constructor(private navCtrl: NavController, private popoverCtrl: PopoverController) {
 
   }
 
@@ -33,6 +34,14 @@ export class ChatsPage implements OnInit {
       ).zone();
   }
 
+  showOptions(): void {
+    const popover = this.popoverCtrl.create(ChatsOptionsComponent, {}, {
+      cssClass: 'options-popover'
+    });
+
+    popover.present();
+  }
+
   showMessages(chat): void {
     this.navCtrl.push(MessagesPage, {chat});
   }
-- 
2.9.3 (Apple Git-75)


From 33e8c140ddad604407b9bd98502618463f8c70fe Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 20:06:33 +0200
Subject: [PATCH 091/123] Step 5.32: Added event handler

---
 src/pages/chats/chats.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/pages/chats/chats.html b/src/pages/chats/chats.html
index d5d8eaf..0ca46ab 100644
--- a/src/pages/chats/chats.html
+++ b/src/pages/chats/chats.html
@@ -7,7 +7,7 @@
       <button ion-button icon-only class="add-chat-button">
         <ion-icon name="person-add"></ion-icon>
       </button>
-      <button ion-button icon-only class="options-button">
+      <button ion-button icon-only class="options-button" (click)="showOptions()">
         <ion-icon name="more"></ion-icon>
       </button>
     </ion-buttons>
-- 
2.9.3 (Apple Git-75)


From 9dfe6e13af30deedfc414a74111694ac209730d7 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 20:06:45 +0200
Subject: [PATCH 092/123] Step 5.33: Add options-popover style to chats
 stylesheet

---
 src/pages/chats/chats.scss | 12 ++++++++++++
 1 file changed, 12 insertions(+)

diff --git a/src/pages/chats/chats.scss b/src/pages/chats/chats.scss
index 7b6878c..2ca3f69 100644
--- a/src/pages/chats/chats.scss
+++ b/src/pages/chats/chats.scss
@@ -18,3 +18,15 @@
     }
   }
 }
+
+.options-popover {
+  $popover-width: 200px;
+  $popover-margin: 5px;
+
+  .popover-content {
+    width: $popover-width;
+    transform-origin: right top 0px !important;
+    left: calc(100% - #{$popover-width} - #{$popover-margin}) !important;
+    top: $popover-margin !important;
+  }
+}
-- 
2.9.3 (Apple Git-75)


From bda1ba6c48091e92731f84f2770c59328b0e52d0 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 20:11:35 +0200
Subject: [PATCH 093/123] Step 5.34: Added updateProfile method

---
 api/server/methods.ts | 14 ++++++++++++++
 1 file changed, 14 insertions(+)

diff --git a/api/server/methods.ts b/api/server/methods.ts
index 974c0e7..8b177b4 100644
--- a/api/server/methods.ts
+++ b/api/server/methods.ts
@@ -1,6 +1,7 @@
 import { Meteor } from 'meteor/meteor';
 import { Chats, Messages } from "../collections/whatsapp-collections";
 import { check, Match } from "meteor/check";
+import { Profile } from "api/models/whatsapp-models";
 
 const nonEmptyString = Match.Where((str) => {
   check(str, String);
@@ -9,6 +10,19 @@ const nonEmptyString = Match.Where((str) => {
 
 export function initMethods() {
   Meteor.methods({
+    updateProfile(profile: Profile): void {
+      if (!this.userId) throw new Meteor.Error('unauthorized',
+        'User must be logged-in to create a new chat');
+
+      check(profile, {
+        name: nonEmptyString,
+        picture: nonEmptyString
+      });
+
+      Meteor.users.update(this.userId, {
+        $set: {profile}
+      });
+    },
     addMessage(chatId: string, content: string) {
       if (!this.userId) throw new Meteor.Error('unauthorized',
         'User must be logged-in to create a new chat');
-- 
2.9.3 (Apple Git-75)


From a4e87d29beba17ac027646b01e6f6c4d19fab879 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 20:21:03 +0200
Subject: [PATCH 094/123] Step 6.1: Add 'addChat' method to ChatsComponent

---
 src/pages/chats/chats.ts | 9 +++++++--
 1 file changed, 7 insertions(+), 2 deletions(-)

diff --git a/src/pages/chats/chats.ts b/src/pages/chats/chats.ts
index 382a5e3..1704092 100644
--- a/src/pages/chats/chats.ts
+++ b/src/pages/chats/chats.ts
@@ -2,7 +2,7 @@ import { Component, OnInit } from '@angular/core';
 import { Observable } from "rxjs";
 import { Chat } from "api/models/whatsapp-models";
 import { Chats, Messages } from "api/collections/whatsapp-collections";
-import { NavController, PopoverController } from "ionic-angular";
+import { NavController, PopoverController, ModalController } from "ionic-angular";
 import { MessagesPage } from "../messages/messages";
 import { ChatsOptionsComponent } from "../chat-options/chat-options";
 
@@ -12,7 +12,7 @@ import { ChatsOptionsComponent } from "../chat-options/chat-options";
 export class ChatsPage implements OnInit {
   private chats;
 
-  constructor(private navCtrl: NavController, private popoverCtrl: PopoverController) {
+  constructor(private navCtrl: NavController, private popoverCtrl: PopoverController, private modalCtrl: ModalController) {
 
   }
 
@@ -34,6 +34,11 @@ export class ChatsPage implements OnInit {
       ).zone();
   }
 
+  addChat(): void {
+    const modal = this.modalCtrl.create(NewChatComponent);
+    modal.present();
+  }
+
   showOptions(): void {
     const popover = this.popoverCtrl.create(ChatsOptionsComponent, {}, {
       cssClass: 'options-popover'
-- 
2.9.3 (Apple Git-75)


From c7a9b541f4ff9ec4c64c269fc0b33e265403e22f Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 20:21:27 +0200
Subject: [PATCH 095/123] Step 6.2: Bind that method

---
 src/pages/chats/chats.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/pages/chats/chats.html b/src/pages/chats/chats.html
index 0ca46ab..c5f878f 100644
--- a/src/pages/chats/chats.html
+++ b/src/pages/chats/chats.html
@@ -4,7 +4,7 @@
       Chats
     </ion-title>
     <ion-buttons end>
-      <button ion-button icon-only class="add-chat-button">
+      <button ion-button icon-only class="add-chat-button" (click)="addChat()">
         <ion-icon name="person-add"></ion-icon>
       </button>
       <button ion-button icon-only class="options-button" (click)="showOptions()">
-- 
2.9.3 (Apple Git-75)


From 6032cd96e62ed77cf4de397cbcea1ac819236f59 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 20:22:14 +0200
Subject: [PATCH 096/123] Step 6.3: Define 'addChat' Method

---
 api/server/methods.ts | 22 ++++++++++++++++++++++
 1 file changed, 22 insertions(+)

diff --git a/api/server/methods.ts b/api/server/methods.ts
index 8b177b4..530042e 100644
--- a/api/server/methods.ts
+++ b/api/server/methods.ts
@@ -10,6 +10,28 @@ const nonEmptyString = Match.Where((str) => {
 
 export function initMethods() {
   Meteor.methods({
+    addChat(receiverId: string): void {
+      if (!this.userId) throw new Meteor.Error('unauthorized',
+        'User must be logged-in to create a new chat');
+
+      check(receiverId, nonEmptyString);
+
+      if (receiverId == this.userId) throw new Meteor.Error('illegal-receiver',
+        'Receiver must be different than the current logged in user');
+
+      const chatExists = !!Chats.collection.find({
+        memberIds: {$all: [this.userId, receiverId]}
+      }).count();
+
+      if (chatExists) throw new Meteor.Error('chat-exists',
+        'Chat already exists');
+
+      const chat = {
+        memberIds: [this.userId, receiverId]
+      };
+
+      Chats.insert(chat);
+    },
     updateProfile(profile: Profile): void {
       if (!this.userId) throw new Meteor.Error('unauthorized',
         'User must be logged-in to create a new chat');
-- 
2.9.3 (Apple Git-75)


From 29e17edc61200d27502e89edce63c9d4d246d158 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 20:22:44 +0200
Subject: [PATCH 097/123] Step 6.4: Add memberIds prop in Chat model

---
 api/models/whatsapp-models.d.ts | 1 +
 1 file changed, 1 insertion(+)

diff --git a/api/models/whatsapp-models.d.ts b/api/models/whatsapp-models.d.ts
index 3cd220e..200ec88 100644
--- a/api/models/whatsapp-models.d.ts
+++ b/api/models/whatsapp-models.d.ts
@@ -9,6 +9,7 @@ declare module 'api/models/whatsapp-models' {
     title?: string;
     picture?: string;
     lastMessage?: Message;
+    memberIds?: string[];
   }
 
   interface Message {
-- 
2.9.3 (Apple Git-75)


From 07168f87197f97512ca70a851152aaea28c10bd5 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 20:22:58 +0200
Subject: [PATCH 098/123] Step 6.5: Create Observable collection from
 Meteor.users

---
 api/collections/whatsapp-collections.ts | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/api/collections/whatsapp-collections.ts b/api/collections/whatsapp-collections.ts
index 64c113e..ea4dd70 100644
--- a/api/collections/whatsapp-collections.ts
+++ b/api/collections/whatsapp-collections.ts
@@ -1,4 +1,7 @@
 import { MongoObservable } from "meteor-rxjs";
 
+let Meteor = Package["meteor"].Meteor;
+
 export const Chats = new MongoObservable.Collection("chats");
 export const Messages = new MongoObservable.Collection("messages");
+export const Users = MongoObservable.fromExisting(Meteor.users);
-- 
2.9.3 (Apple Git-75)


From 9bf00a007f8844b6608416ec4a8b34a9b9620f07 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 20:23:26 +0200
Subject: [PATCH 099/123] Step 6.6: Create a User model

---
 api/models/whatsapp-models.d.ts | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/api/models/whatsapp-models.d.ts b/api/models/whatsapp-models.d.ts
index 200ec88..01dd1b4 100644
--- a/api/models/whatsapp-models.d.ts
+++ b/api/models/whatsapp-models.d.ts
@@ -20,4 +20,8 @@ declare module 'api/models/whatsapp-models' {
     ownership?: string;
     senderId?: string;
   }
+
+  interface User extends Meteor.User {
+    profile?: Profile;
+  }
 }
-- 
2.9.3 (Apple Git-75)


From 7fb1702fd41c7e9252a8695ed9b2fba5e28a77af Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 20:23:40 +0200
Subject: [PATCH 100/123] Step 6.7: Create NewChatComponent

---
 src/pages/new-chat/new-chat.ts | 77 ++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 77 insertions(+)
 create mode 100644 src/pages/new-chat/new-chat.ts

diff --git a/src/pages/new-chat/new-chat.ts b/src/pages/new-chat/new-chat.ts
new file mode 100644
index 0000000..ddfaca1
--- /dev/null
+++ b/src/pages/new-chat/new-chat.ts
@@ -0,0 +1,77 @@
+import { Component, OnInit } from '@angular/core';
+import { MeteorObservable } from 'meteor-rxjs';
+import { NavController, ViewController, AlertController } from 'ionic-angular';
+import { Observable } from 'rxjs/Observable';
+import { Chats, Users } from 'api/collections/whatsapp-collections';
+import { User } from 'api/models/whatsapp-models';
+
+declare let Meteor;
+
+@Component({
+  selector: 'new-chat',
+  templateUrl: 'new-chat.html'
+})
+export class NewChatComponent implements OnInit {
+  users: Observable<User>;
+  private senderId: string;
+
+  constructor(
+    private navCtrl: NavController,
+    private viewCtrl: ViewController,
+    private alertCtrl: AlertController
+  ) {
+    this.senderId = Meteor.userId();
+  }
+
+  ngOnInit() {
+    MeteorObservable.autorun().zone().subscribe(() => {
+      this.users = this.findUsers().zone();
+    });
+  }
+
+  addChat(user): void {
+    MeteorObservable.call('addChat', user._id).subscribe({
+      next: () => {
+        this.viewCtrl.dismiss();
+      },
+      error: (e: Error) => {
+        this.viewCtrl.dismiss().then(() => {
+          this.handleError(e)
+        });
+      }
+    });
+  }
+
+  private findUsers(): Observable<User> {
+    return Chats.find({
+      memberIds: this.senderId
+    }, {
+      fields: {
+        memberIds: 1
+      }
+    })
+      .startWith([]) // empty result
+      .mergeMap((chats) => {
+        const recieverIds = chats
+          .map(({memberIds}) => memberIds)
+          .reduce((result, memberIds) => result.concat(memberIds), [])
+          .concat(this.senderId);
+
+        return Users.find({
+          _id: {$nin: recieverIds}
+        })
+      });
+  }
+
+  private handleError(e: Error): void {
+    console.error(e);
+
+    const alert = this.alertCtrl.create({
+      title: 'Oops!',
+      message: e.message,
+      buttons: ['OK']
+    });
+
+    alert.present();
+  }
+}
-- 
2.9.3 (Apple Git-75)


From c991d7c412624a6234e13e7768a6d0cedef16106 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 20:24:00 +0200
Subject: [PATCH 101/123] Step 6.8: Create NewChatComponent view

---
 src/pages/new-chat/new-chat.html | 18 ++++++++++++++++++
 1 file changed, 18 insertions(+)
 create mode 100644 src/pages/new-chat/new-chat.html

diff --git a/src/pages/new-chat/new-chat.html b/src/pages/new-chat/new-chat.html
new file mode 100644
index 0000000..06679da
--- /dev/null
+++ b/src/pages/new-chat/new-chat.html
@@ -0,0 +1,18 @@
+<ion-header>
+  <ion-toolbar color="whatsapp">
+    <ion-title>New Chat</ion-title>
+
+    <ion-buttons end>
+      <button class="dismiss-button" (click)="viewCtrl.dismiss()"><ion-icon name="close"></ion-icon></button>
+    </ion-buttons>
+  </ion-toolbar>
+</ion-header>
+
+<ion-content class="new-chat">
+  <ion-list class="users">
+    <button ion-item *ngFor="let user of users | async" class="user" (click)="addChat(user)">
+      <img class="user-picture" [src]="user.profile.picture">
+      <h2 class="user-name">{{user.profile.name}}</h2>
+    </button>
+  </ion-list>
+</ion-content>
-- 
2.9.3 (Apple Git-75)


From 841885fca8e9388b23b61d1200743d8003445234 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 20:24:06 +0200
Subject: [PATCH 102/123] Step 6.9: Create NewChatComponent view style

---
 src/pages/new-chat/new-chat.scss | 14 ++++++++++++++
 1 file changed, 14 insertions(+)
 create mode 100644 src/pages/new-chat/new-chat.scss

diff --git a/src/pages/new-chat/new-chat.scss b/src/pages/new-chat/new-chat.scss
new file mode 100644
index 0000000..17056a4
--- /dev/null
+++ b/src/pages/new-chat/new-chat.scss
@@ -0,0 +1,14 @@
+.new-chat {
+  .user-picture {
+    border-radius: 50%;
+    width: 50px;
+    float: left;
+  }
+
+  .user-name {
+    margin-left: 20px;
+    margin-top: 25px;
+    transform: translate(0, -50%);
+    float: left;
+  }
+}
-- 
2.9.3 (Apple Git-75)


From 9060b2eb37a599c06ae602e20065a0e45257bc2f Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 20:25:44 +0200
Subject: [PATCH 103/123] Step 6.10: Register that component

---
 src/app/app.module.ts | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/src/app/app.module.ts b/src/app/app.module.ts
index 2780d17..648b670 100644
--- a/src/app/app.module.ts
+++ b/src/app/app.module.ts
@@ -9,6 +9,7 @@ import { LoginComponent } from "../pages/auth/login";
 import { VerificationComponent } from "../pages/verification/verification";
 import { ProfileComponent } from "../pages/profile/profile";
 import { ChatsOptionsComponent } from "../pages/chat-options/chat-options";
+import { NewChatComponent } from "../pages/new-chat/new-chat";
 
 @NgModule({
   declarations: [
@@ -19,7 +20,8 @@ import { ChatsOptionsComponent } from "../pages/chat-options/chat-options";
     LoginComponent,
     VerificationComponent,
     ProfileComponent,
-    ChatsOptionsComponent
+    ChatsOptionsComponent,
+    NewChatComponent,
   ],
   imports: [
     IonicModule.forRoot(MyApp),
@@ -34,7 +36,8 @@ import { ChatsOptionsComponent } from "../pages/chat-options/chat-options";
     LoginComponent,
     VerificationComponent,
     ProfileComponent,
-    ChatsOptionsComponent
+    ChatsOptionsComponent,
+    NewChatComponent
   ],
   providers: []
 })
-- 
2.9.3 (Apple Git-75)


From f73729bee85817fd92ff619121807e41953624d3 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 20:26:53 +0200
Subject: [PATCH 104/123] Step 6.11: Replace chats fabrication with users
 fabrication

---
 api/server/main.ts | 84 +++++++++++++++++++-----------------------------------
 1 file changed, 30 insertions(+), 54 deletions(-)

diff --git a/api/server/main.ts b/api/server/main.ts
index dcd79c4..209145d 100644
--- a/api/server/main.ts
+++ b/api/server/main.ts
@@ -1,6 +1,5 @@
 import { Meteor } from 'meteor/meteor';
-import { Chats, Messages } from "../collections/whatsapp-collections";
-import * as moment from "moment";
+import { Users } from "../collections/whatsapp-collections";
 import { initMethods } from "./methods";
 import { Accounts } from 'meteor/accounts-base';
 
@@ -14,62 +13,39 @@ Meteor.startup(() => {
     SMS.twilio = Meteor.settings['twilio'];
   }
 
-  if (Chats.find({}).cursor.count() === 0) {
-    let chatId;
+  if (Users.collection.find().count()) return;
 
-    chatId = Chats.collection.insert({
-      title: 'Ethan Gonzalez',
+  [{
+    phone: '+972540000001',
+    profile: {
+      name: 'Ethan Gonzalez',
       picture: 'https://randomuser.me/api/portraits/thumb/men/1.jpg'
-    });
-
-    Messages.collection.insert({
-      chatId: chatId,
-      content: 'You on your way?',
-      createdAt: moment().subtract(1, 'hours').toDate()
-    });
-
-    chatId = Chats.collection.insert({
-      title: 'Bryan Wallace',
+    }
+  }, {
+    phone: '+972540000002',
+    profile: {
+      name: 'Bryan Wallace',
       picture: 'https://randomuser.me/api/portraits/thumb/lego/1.jpg'
-    });
-
-    Messages.collection.insert({
-      chatId: chatId,
-      content: 'Hey, it\'s me',
-      createdAt: moment().subtract(2, 'hours').toDate()
-    });
-
-    chatId = Chats.collection.insert({
-      title: 'Avery Stewart',
+    }
+  }, {
+    phone: '+972540000003',
+    profile: {
+      name: 'Avery Stewart',
       picture: 'https://randomuser.me/api/portraits/thumb/women/1.jpg'
-    });
-
-    Messages.collection.insert({
-      chatId: chatId,
-      content: 'I should buy a boat',
-      createdAt: moment().subtract(1, 'days').toDate()
-    });
-
-    chatId = Chats.collection.insert({
-      title: 'Katie Peterson',
+    }
+  }, {
+    phone: '+972540000004',
+    profile: {
+      name: 'Katie Peterson',
       picture: 'https://randomuser.me/api/portraits/thumb/women/2.jpg'
-    });
-
-    Messages.collection.insert({
-      chatId: chatId,
-      content: 'Look at my mukluks!',
-      createdAt: moment().subtract(4, 'days').toDate()
-    });
-
-    chatId = Chats.collection.insert({
-      title: 'Ray Edwards',
+    }
+  }, {
+    phone: '+972540000005',
+    profile: {
+      name: 'Ray Edwards',
       picture: 'https://randomuser.me/api/portraits/thumb/men/2.jpg'
-    });
-
-    Messages.collection.insert({
-      chatId: chatId,
-      content: 'This is wicked good ice cream.',
-      createdAt: moment().subtract(2, 'weeks').toDate()
-    });
-  }
+    }
+  }].forEach(user => {
+    Accounts.createUserWithPhone(user);
+  });
 });
-- 
2.9.3 (Apple Git-75)


From 63daef6aea6dcb6cdbbbd5f9a74cd2d609450192 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 20:27:54 +0200
Subject: [PATCH 105/123] Step 6.12: Added missing import

---
 src/pages/chats/chats.ts | 1 +
 1 file changed, 1 insertion(+)

diff --git a/src/pages/chats/chats.ts b/src/pages/chats/chats.ts
index 1704092..e0830ab 100644
--- a/src/pages/chats/chats.ts
+++ b/src/pages/chats/chats.ts
@@ -5,6 +5,7 @@ import { Chats, Messages } from "api/collections/whatsapp-collections";
 import { NavController, PopoverController, ModalController } from "ionic-angular";
 import { MessagesPage } from "../messages/messages";
 import { ChatsOptionsComponent } from "../chat-options/chat-options";
+import { NewChatComponent } from "../new-chat/new-chat";
 
 @Component({
   templateUrl: 'chats.html'
-- 
2.9.3 (Apple Git-75)


From 382ed9112eb4ee0cafadf72b4aea512b2b316767 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 20:46:24 +0200
Subject: [PATCH 106/123] Step 6.13: Add title and picture to chat

---
 src/pages/chats/chats.ts | 18 ++++++++++++++++--
 1 file changed, 16 insertions(+), 2 deletions(-)

diff --git a/src/pages/chats/chats.ts b/src/pages/chats/chats.ts
index e0830ab..bf6c5b8 100644
--- a/src/pages/chats/chats.ts
+++ b/src/pages/chats/chats.ts
@@ -1,23 +1,28 @@
 import { Component, OnInit } from '@angular/core';
 import { Observable } from "rxjs";
 import { Chat } from "api/models/whatsapp-models";
-import { Chats, Messages } from "api/collections/whatsapp-collections";
+import { Chats, Messages, Users } from "api/collections/whatsapp-collections";
 import { NavController, PopoverController, ModalController } from "ionic-angular";
 import { MessagesPage } from "../messages/messages";
 import { ChatsOptionsComponent } from "../chat-options/chat-options";
 import { NewChatComponent } from "../new-chat/new-chat";
 
+declare let Meteor;
+
 @Component({
   templateUrl: 'chats.html'
 })
 export class ChatsPage implements OnInit {
   private chats;
+  private senderId: string;
 
   constructor(private navCtrl: NavController, private popoverCtrl: PopoverController, private modalCtrl: ModalController) {
 
   }
 
   ngOnInit() {
+    this.senderId = Meteor.userId();
+
     this.chats = Chats
       .find({})
       .mergeMap((chats: Chat[]) =>
@@ -32,7 +37,16 @@ export class ChatsPage implements OnInit {
               })
           )
         )
-      ).zone();
+      ).map(chats => {
+        chats.forEach(chat => {
+          const receiver = Users.findOne(chat.memberIds.find(memberId => memberId !== this.senderId));
+
+          chat.title = receiver.profile.name;
+          chat.picture = receiver.profile.picture;
+        });
+
+        return chats;
+      }).zone();
   }
 
   addChat(): void {
-- 
2.9.3 (Apple Git-75)


From bd8e47f883da87170e19e4abe31d8901937d8b67 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 20:47:27 +0200
Subject: [PATCH 107/123] Step 7.1: Remove insecure

---
 api/.meteor/packages | 1 -
 api/.meteor/versions | 1 -
 2 files changed, 2 deletions(-)

diff --git a/api/.meteor/packages b/api/.meteor/packages
index 2c9aca3..f8b28ee 100644
--- a/api/.meteor/packages
+++ b/api/.meteor/packages
@@ -19,7 +19,6 @@ ecmascript@0.5.9              # Enable ECMAScript2015+ syntax in app code
 shell-server@0.2.1            # Server-side component of the `meteor shell` command
 
 autopublish@1.0.7             # Publish all data to the clients (for prototyping)
-insecure@1.0.7                # Allow all DB writes from clients (for prototyping)
 barbatus:typescript
 check
 accounts-base
diff --git a/api/.meteor/versions b/api/.meteor/versions
index 769c63e..214c097 100644
--- a/api/.meteor/versions
+++ b/api/.meteor/versions
@@ -36,7 +36,6 @@ html-tools@1.0.11
 htmljs@1.0.11
 http@1.1.8
 id-map@1.0.9
-insecure@1.0.7
 jquery@1.11.10
 launch-screen@1.0.12
 livedata@1.0.18
-- 
2.9.3 (Apple Git-75)


From 9e27a29205ddfe8c0e941cf3af95b9a3d0d5f1f3 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 20:48:11 +0200
Subject: [PATCH 108/123] Step 7.2: Define 'removeChat' Method

---
 api/server/methods.ts | 14 ++++++++++++++
 1 file changed, 14 insertions(+)

diff --git a/api/server/methods.ts b/api/server/methods.ts
index 530042e..d754969 100644
--- a/api/server/methods.ts
+++ b/api/server/methods.ts
@@ -32,6 +32,20 @@ export function initMethods() {
 
       Chats.insert(chat);
     },
+    removeChat(chatId: string): void {
+      if (!this.userId) throw new Meteor.Error('unauthorized',
+        'User must be logged-in to remove chat');
+
+      check(chatId, nonEmptyString);
+
+      const chatExists = !!Chats.collection.find(chatId).count();
+
+      if (!chatExists) throw new Meteor.Error('chat-not-exists',
+        'Chat doesn\'t exist');
+
+      Messages.remove({chatId});
+      Chats.remove(chatId);
+    },
     updateProfile(profile: Profile): void {
       if (!this.userId) throw new Meteor.Error('unauthorized',
         'User must be logged-in to create a new chat');
-- 
2.9.3 (Apple Git-75)


From c70215ea565eef6d3d5f550414cdcea7fc517506 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 20:51:02 +0200
Subject: [PATCH 109/123] Step 7.3: Create MessagesOptionsComponent

---
 src/pages/messages-options/messages-options.ts | 76 ++++++++++++++++++++++++++
 1 file changed, 76 insertions(+)
 create mode 100644 src/pages/messages-options/messages-options.ts

diff --git a/src/pages/messages-options/messages-options.ts b/src/pages/messages-options/messages-options.ts
new file mode 100644
index 0000000..d5e0cbe
--- /dev/null
+++ b/src/pages/messages-options/messages-options.ts
@@ -0,0 +1,76 @@
+import { Component } from '@angular/core';
+import { NavParams, NavController, ViewController, AlertController } from 'ionic-angular';
+import { MeteorObservable } from 'meteor-rxjs';
+import { TabsPage } from "../tabs/tabs";
+
+declare let Meteor;
+
+@Component({
+  selector: 'messages-options',
+  templateUrl: 'messages-options.html'
+})
+export class MessagesOptionsComponent {
+  constructor(
+    private navCtrl: NavController,
+    private viewCtrl: ViewController,
+    private alertCtrl: AlertController,
+    private params: NavParams
+  ) {}
+
+  remove(): void {
+    const alert = this.alertCtrl.create({
+      title: 'Remove',
+      message: 'Are you sure you would like to proceed?',
+      buttons: [
+        {
+          text: 'Cancel',
+          role: 'cancel'
+        },
+        {
+          text: 'Yes',
+          handler: () => {
+            this.handleRemove(alert);
+            return false;
+          }
+        }
+      ]
+    });
+
+    this.viewCtrl.dismiss().then(() => {
+      alert.present();
+    });
+  }
+
+  private handleRemove(alert): void {
+    MeteorObservable.call('removeChat', this.params.get('chat')._id).subscribe({
+      next: () => {
+        alert.dismiss().then(() => {
+          this.navCtrl.setRoot(TabsPage, {}, {
+            animate: true
+          });
+        });
+      },
+      error: (e: Error) => {
+        alert.dismiss().then(() => {
+          if (e) return this.handleError(e);
+
+          this.navCtrl.setRoot(TabsPage, {}, {
+            animate: true
+          });
+        });
+      }
+    });
+  }
+
+  private handleError(e: Error): void {
+    console.error(e);
+
+    const alert = this.alertCtrl.create({
+      title: 'Oops!',
+      message: e.message,
+      buttons: ['OK']
+    });
+
+    alert.present();
+  }
+}
-- 
2.9.3 (Apple Git-75)


From dc3a6110045ffe45af4d56073832492f3287e6a2 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 20:51:32 +0200
Subject: [PATCH 110/123] Step 7.4: Create MessagesOptionsComponent view

---
 src/pages/messages-options/messages-options.html | 8 ++++++++
 1 file changed, 8 insertions(+)
 create mode 100644 src/pages/messages-options/messages-options.html

diff --git a/src/pages/messages-options/messages-options.html b/src/pages/messages-options/messages-options.html
new file mode 100644
index 0000000..3c87eb4
--- /dev/null
+++ b/src/pages/messages-options/messages-options.html
@@ -0,0 +1,8 @@
+<ion-content class="chats-options-page-content">
+  <ion-list class="options">
+    <button ion-item class="option option-remove" (click)="remove()">
+      <ion-icon name="remove" class="option-icon"></ion-icon>
+      <div class="option-name">Remove</div>
+    </button>
+  </ion-list>
+</ion-content>
-- 
2.9.3 (Apple Git-75)


From da547a6e1e24950ad1d8f741de5103041ffd661b Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 20:51:39 +0200
Subject: [PATCH 111/123] Step 7.5: Create MessagesOptionsComponent view style

---
 src/pages/messages-options/messages-options.scss | 13 +++++++++++++
 1 file changed, 13 insertions(+)
 create mode 100644 src/pages/messages-options/messages-options.scss

diff --git a/src/pages/messages-options/messages-options.scss b/src/pages/messages-options/messages-options.scss
new file mode 100644
index 0000000..0e4d0ee
--- /dev/null
+++ b/src/pages/messages-options/messages-options.scss
@@ -0,0 +1,13 @@
+.chats-options-page-content {
+  .options {
+    margin: 0;
+  }
+
+  .option-name {
+    float: left;
+  }
+
+  .option-icon {
+    float: right;
+  }
+}
-- 
2.9.3 (Apple Git-75)


From 5de84c5fabe34ddd76b508338bab3ebd1722c881 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 20:52:07 +0200
Subject: [PATCH 112/123] Step 7.6: Register the component

---
 src/app/app.module.ts | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/src/app/app.module.ts b/src/app/app.module.ts
index 648b670..5e0025e 100644
--- a/src/app/app.module.ts
+++ b/src/app/app.module.ts
@@ -10,6 +10,7 @@ import { VerificationComponent } from "../pages/verification/verification";
 import { ProfileComponent } from "../pages/profile/profile";
 import { ChatsOptionsComponent } from "../pages/chat-options/chat-options";
 import { NewChatComponent } from "../pages/new-chat/new-chat";
+import { MessagesOptionsComponent } from "../pages/messages-options/messages-options";
 
 @NgModule({
   declarations: [
@@ -22,6 +23,7 @@ import { NewChatComponent } from "../pages/new-chat/new-chat";
     ProfileComponent,
     ChatsOptionsComponent,
     NewChatComponent,
+    MessagesOptionsComponent
   ],
   imports: [
     IonicModule.forRoot(MyApp),
@@ -37,7 +39,8 @@ import { NewChatComponent } from "../pages/new-chat/new-chat";
     VerificationComponent,
     ProfileComponent,
     ChatsOptionsComponent,
-    NewChatComponent
+    NewChatComponent,
+    MessagesOptionsComponent
   ],
   providers: []
 })
-- 
2.9.3 (Apple Git-75)


From b8f11e0ddaa55ab353f4424964616172ff3a2f01 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 20:54:09 +0200
Subject: [PATCH 113/123] Step 7.7: Define component's method to open options

---
 src/pages/messages/messages.ts | 18 +++++++++++++++---
 1 file changed, 15 insertions(+), 3 deletions(-)

diff --git a/src/pages/messages/messages.ts b/src/pages/messages/messages.ts
index ec3ea4b..37e25be 100644
--- a/src/pages/messages/messages.ts
+++ b/src/pages/messages/messages.ts
@@ -1,9 +1,12 @@
-import {Component, OnInit, OnDestroy, ElementRef} from "@angular/core";
-import { NavParams } from "ionic-angular";
+import { Component, OnInit, OnDestroy, ElementRef } from "@angular/core";
+import { NavParams, PopoverController } from "ionic-angular";
 import { Chat, Message } from "api/models/whatsapp-models";
 import { Messages } from "api/collections/whatsapp-collections";
 import { Observable, Subscription } from "rxjs";
 import { MeteorObservable } from "meteor-rxjs";
+import { MessagesOptionsComponent } from "../messages-options/messages-options";
+
+declare let Meteor;
 
 @Component({
   selector: "messages-page",
@@ -18,12 +21,21 @@ export class MessagesPage implements OnInit, OnDestroy {
   private autoScroller: Subscription;
   private senderId: string;
 
-  constructor(navParams: NavParams, element: ElementRef) {
+  constructor(navParams: NavParams, element: ElementRef, private popoverCtrl: PopoverController) {
     this.selectedChat = <Chat>navParams.get('chat');
     this.title = this.selectedChat.title;
     this.picture = this.selectedChat.picture;
     this.senderId = Meteor.userId();
+  }
+
+  showOptions(): void {
+    const popover = this.popoverCtrl.create(MessagesOptionsComponent, {
+      chat: this.selectedChat
+    }, {
+      cssClass: 'options-popover'
+    });
 
+    popover.present();
   }
 
   private get messagesPageContent(): Element {
-- 
2.9.3 (Apple Git-75)


From 748c74c45993b4eed2c6fbf7ee1a644f31b1526f Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 20:55:47 +0200
Subject: [PATCH 114/123] Step 7.8: Implement it in the view

---
 src/pages/messages/messages.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/src/pages/messages/messages.html b/src/pages/messages/messages.html
index 7975a18..0d2d120 100644
--- a/src/pages/messages/messages.html
+++ b/src/pages/messages/messages.html
@@ -8,7 +8,7 @@
 
     <ion-buttons end>
       <button ion-button icon-only class="attach-button"><ion-icon name="attach"></ion-icon></button>
-      <button ion-button icon-only class="settings-button"><ion-icon name="more"></ion-icon></button>
+      <button ion-button icon-only class="settings-button" (click)="showOptions()"><ion-icon name="more"></ion-icon></button>
     </ion-buttons>
   </ion-navbar>
 </ion-header>
-- 
2.9.3 (Apple Git-75)


From fa059a262c4ad0df2df879c09e7ad3622a1baaa2 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 20:56:54 +0200
Subject: [PATCH 115/123] Step 7.9: Remove autopublish

---
 api/.meteor/packages | 1 -
 api/.meteor/versions | 1 -
 2 files changed, 2 deletions(-)

diff --git a/api/.meteor/packages b/api/.meteor/packages
index f8b28ee..e1b6fc5 100644
--- a/api/.meteor/packages
+++ b/api/.meteor/packages
@@ -18,7 +18,6 @@ es5-shim@4.6.15                # ECMAScript 5 compatibility for older browsers.
 ecmascript@0.5.9              # Enable ECMAScript2015+ syntax in app code
 shell-server@0.2.1            # Server-side component of the `meteor shell` command
 
-autopublish@1.0.7             # Publish all data to the clients (for prototyping)
 barbatus:typescript
 check
 accounts-base
diff --git a/api/.meteor/versions b/api/.meteor/versions
index 214c097..564f30e 100644
--- a/api/.meteor/versions
+++ b/api/.meteor/versions
@@ -1,6 +1,5 @@
 accounts-base@1.2.14
 allow-deny@1.0.5
-autopublish@1.0.7
 autoupdate@1.2.11
 babel-compiler@6.13.0
 babel-runtime@0.1.13
-- 
2.9.3 (Apple Git-75)


From 791142cf48fda7217826b3ea150cc609081e2df9 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 21:01:34 +0200
Subject: [PATCH 116/123] Step 7.10: Added users publication

---
 api/server/publications.ts | 17 +++++++++++++++++
 1 file changed, 17 insertions(+)
 create mode 100644 api/server/publications.ts

diff --git a/api/server/publications.ts b/api/server/publications.ts
new file mode 100644
index 0000000..fac896b
--- /dev/null
+++ b/api/server/publications.ts
@@ -0,0 +1,17 @@
+import { Meteor } from 'meteor/meteor';
+import { Mongo } from 'meteor/mongo';
+import { Users, Messages, Chats } from '../collections/whatsapp-collections';
+import { User, Message, Chat } from 'api/models/whatsapp-models';
+
+export function initPublications() {
+  Meteor.publish('users', function(): Mongo.Cursor<User> {
+    if (!this.userId) return;
+
+    return Users.collection.find({}, {
+      fields: {
+        profile: 1
+      }
+    });
+  });
+
+}
-- 
2.9.3 (Apple Git-75)


From f43b7a891e381c2bdcc35139224ac5a1f961d2a9 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 21:02:06 +0200
Subject: [PATCH 117/123] Step 7.11: Added messages publication

---
 api/server/publications.ts | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/api/server/publications.ts b/api/server/publications.ts
index fac896b..4daccb1 100644
--- a/api/server/publications.ts
+++ b/api/server/publications.ts
@@ -14,4 +14,11 @@ export function initPublications() {
     });
   });
 
+  Meteor.publish('messages', function(chatId: string): Mongo.Cursor<Message> {
+    if (!this.userId) return;
+    if (!chatId) return;
+
+    return Messages.collection.find({chatId});
+  });
+
 }
-- 
2.9.3 (Apple Git-75)


From 64aa001620161c75dbc9f00f656c4d946e74a009 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 21:04:22 +0200
Subject: [PATCH 118/123] Step 7.12: Added reywood:publish-composite

---
 api/.meteor/packages | 1 +
 api/.meteor/versions | 1 +
 2 files changed, 2 insertions(+)

diff --git a/api/.meteor/packages b/api/.meteor/packages
index e1b6fc5..53eb2ce 100644
--- a/api/.meteor/packages
+++ b/api/.meteor/packages
@@ -23,3 +23,4 @@ check
 accounts-base
 npm-bcrypt
 mys:accounts-phone
+reywood:publish-composite
diff --git a/api/.meteor/versions b/api/.meteor/versions
index 564f30e..af0352d 100644
--- a/api/.meteor/versions
+++ b/api/.meteor/versions
@@ -62,6 +62,7 @@ rate-limit@1.0.6
 reactive-var@1.0.11
 reload@1.1.11
 retry@1.0.9
+reywood:publish-composite@1.4.2
 routepolicy@1.0.12
 service-configuration@1.0.11
 sha@1.0.9
-- 
2.9.3 (Apple Git-75)


From 95faefac65d4abdf663295f3a32386d5dc00e5ee Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 21:02:14 +0200
Subject: [PATCH 119/123] Step 7.13: Added chats publication

---
 api/server/publications.ts | 29 +++++++++++++++++++++++++++++
 1 file changed, 29 insertions(+)

diff --git a/api/server/publications.ts b/api/server/publications.ts
index 4daccb1..f865b4c 100644
--- a/api/server/publications.ts
+++ b/api/server/publications.ts
@@ -21,4 +21,33 @@ export function initPublications() {
     return Messages.collection.find({chatId});
   });
 
+  Meteor.publishComposite('chats', function() {
+    if (!this.userId) return;
+
+    return {
+      find: () => {
+        return Chats.collection.find({memberIds: this.userId});
+      },
+
+      children: [
+        {
+          find: (chat) => {
+            return Messages.collection.find({chatId: chat._id}, {
+              sort: {createdAt: -1},
+              limit: 1
+            });
+          }
+        },
+        {
+          find: (chat) => {
+            return Users.collection.find({
+              _id: {$in: chat.memberIds}
+            }, {
+              fields: {profile: 1}
+            });
+          }
+        }
+      ]
+    };
+  });
 }
-- 
2.9.3 (Apple Git-75)


From 06a78e64f7f848fcdf239ce3023bcd70edef5af7 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 21:02:36 +0200
Subject: [PATCH 120/123] Step 7.14: Init publication on server start

---
 api/server/main.ts | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/api/server/main.ts b/api/server/main.ts
index 209145d..bba4876 100644
--- a/api/server/main.ts
+++ b/api/server/main.ts
@@ -2,11 +2,13 @@ import { Meteor } from 'meteor/meteor';
 import { Users } from "../collections/whatsapp-collections";
 import { initMethods } from "./methods";
 import { Accounts } from 'meteor/accounts-base';
+import { initPublications } from "./publications";
 
 declare let SMS, Object;
 
 Meteor.startup(() => {
   initMethods();
+  initPublications();
 
   if (Meteor.settings) {
     Object.assign(Accounts._options, Meteor.settings['accounts-phone']);
-- 
2.9.3 (Apple Git-75)


From c5f7de55ad99fcf909f82e13def1daafe0e550b9 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 21:07:03 +0200
Subject: [PATCH 121/123] Step 7.15: Subscribe to 'chats'

---
 src/pages/chats/chats.ts | 54 ++++++++++++++++++++++++++++--------------------
 1 file changed, 32 insertions(+), 22 deletions(-)

diff --git a/src/pages/chats/chats.ts b/src/pages/chats/chats.ts
index bf6c5b8..45522a0 100644
--- a/src/pages/chats/chats.ts
+++ b/src/pages/chats/chats.ts
@@ -6,6 +6,7 @@ import { NavController, PopoverController, ModalController } from "ionic-angular
 import { MessagesPage } from "../messages/messages";
 import { ChatsOptionsComponent } from "../chat-options/chat-options";
 import { NewChatComponent } from "../new-chat/new-chat";
+import { MeteorObservable } from 'meteor-rxjs';
 
 declare let Meteor;
 
@@ -23,30 +24,39 @@ export class ChatsPage implements OnInit {
   ngOnInit() {
     this.senderId = Meteor.userId();
 
-    this.chats = Chats
-      .find({})
-      .mergeMap((chats: Chat[]) =>
-        Observable.combineLatest(
-          ...chats.map((chat: Chat) =>
-            Messages
-              .find({chatId: chat._id})
-              .startWith(null)
-              .map(messages => {
-                if (messages) chat.lastMessage = messages[0];
-                return chat;
-              })
-          )
-        )
-      ).map(chats => {
-        chats.forEach(chat => {
-          const receiver = Users.findOne(chat.memberIds.find(memberId => memberId !== this.senderId));
+    MeteorObservable.subscribe('chats').subscribe(() => {
+      MeteorObservable.autorun().subscribe(() => {
+        if (this.chats) {
+          this.chats.unsubscribe();
+          this.chats = undefined;
+        }
 
-          chat.title = receiver.profile.name;
-          chat.picture = receiver.profile.picture;
-        });
+        this.chats = Chats
+          .find({})
+          .mergeMap((chats: Chat[]) =>
+            Observable.combineLatest(
+              ...chats.map((chat: Chat) =>
+                Messages
+                  .find({chatId: chat._id})
+                  .startWith(null)
+                  .map(messages => {
+                    if (messages) chat.lastMessage = messages[0];
+                    return chat;
+                  })
+              )
+            )
+          ).map(chats => {
+            chats.forEach(chat => {
+              const receiver = Users.findOne(chat.memberIds.find(memberId => memberId !== this.senderId));
 
-        return chats;
-      }).zone();
+              chat.title = receiver.profile.name;
+              chat.picture = receiver.profile.picture;
+            });
+
+            return chats;
+          }).zone();
+      });
+    });
   }
 
   addChat(): void {
-- 
2.9.3 (Apple Git-75)


From b66b2d9f16e6f2a37437179407475d52c06d4292 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 21:07:34 +0200
Subject: [PATCH 122/123] Step 7.16: Subscribe to 'users'

---
 src/pages/new-chat/new-chat.ts | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/src/pages/new-chat/new-chat.ts b/src/pages/new-chat/new-chat.ts
index ddfaca1..4526258 100644
--- a/src/pages/new-chat/new-chat.ts
+++ b/src/pages/new-chat/new-chat.ts
@@ -24,8 +24,10 @@ export class NewChatComponent implements OnInit {
   }
 
   ngOnInit() {
-    MeteorObservable.autorun().zone().subscribe(() => {
-      this.users = this.findUsers().zone();
+    MeteorObservable.subscribe('users').subscribe(() => {
+      MeteorObservable.autorun().subscribe(() => {
+        this.users = this.findUsers().zone();
+      });
     });
   }
 
-- 
2.9.3 (Apple Git-75)


From c303fc8b32a726418eb44ef5fe09fc82b4cd2a8e Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 21:08:36 +0200
Subject: [PATCH 123/123] Step 7.17: Subscribe to 'messages'

---
 src/pages/messages/messages.ts | 20 ++++++++++++--------
 1 file changed, 12 insertions(+), 8 deletions(-)

diff --git a/src/pages/messages/messages.ts b/src/pages/messages/messages.ts
index 37e25be..6d2a516 100644
--- a/src/pages/messages/messages.ts
+++ b/src/pages/messages/messages.ts
@@ -66,15 +66,19 @@ export class MessagesPage implements OnInit, OnDestroy {
   }
 
   ngOnInit() {
-    this.messages = Messages.find(
-      {chatId: this.selectedChat._id},
-      {sort: {createdAt: 1}}
-    ).map((messages: Message[]) => {
-      messages.forEach((message: Message) => {
-        message.ownership = this.senderId == message.senderId ? 'mine' : 'other';
+    MeteorObservable.subscribe('messages', this.selectedChat._id).subscribe(() => {
+      MeteorObservable.autorun().subscribe(() => {
+        this.messages = Messages.find(
+          {chatId: this.selectedChat._id},
+          {sort: {createdAt: 1}}
+        ).map((messages: Message[]) => {
+          messages.forEach((message: Message) => {
+            message.ownership = this.senderId == message.senderId ? 'mine' : 'other';
+          });
+
+          return messages;
+        });
       });
-
-      return messages;
     });
 
     this.autoScroller = MeteorObservable.autorun().subscribe(() => {
-- 
2.9.3 (Apple Git-75)


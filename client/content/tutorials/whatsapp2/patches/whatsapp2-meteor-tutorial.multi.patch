From 90823826b467b80d9b9be6c8c9f8028cda910b35 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 4 Oct 2016 21:15:03 +0300
Subject: [PATCH 001/128] Step 1.1: Remove boilerplate example files

---
 both/collections/demo-collection.ts               |  4 -
 both/models/demo-data-object.ts                   |  4 -
 client/imports/app/app.component.html             |  1 -
 client/imports/app/app.component.scss             |  5 --
 client/imports/app/app.module.ts                  |  9 +--
 client/imports/app/demo/demo-data.service.test.ts | 19 -----
 client/imports/app/demo/demo-data.service.ts      | 18 -----
 client/imports/app/demo/demo.component.html       |  8 --
 client/imports/app/demo/demo.component.scss       |  3 -
 client/imports/app/demo/demo.component.test.ts    | 95 -----------------------
 client/imports/app/demo/demo.component.ts         | 25 ------
 client/imports/app/index.ts                       |  2 -
 client/init.test.ts                               | 12 ---
 client/main.ts                                    |  2 +-
 server/imports/server-main/main.test.ts           | 40 ----------
 server/imports/server-main/main.ts                | 22 ------
 16 files changed, 3 insertions(+), 266 deletions(-)
 delete mode 100644 both/collections/demo-collection.ts
 delete mode 100644 both/models/demo-data-object.ts
 delete mode 100644 client/imports/app/demo/demo-data.service.test.ts
 delete mode 100644 client/imports/app/demo/demo-data.service.ts
 delete mode 100644 client/imports/app/demo/demo.component.html
 delete mode 100644 client/imports/app/demo/demo.component.scss
 delete mode 100644 client/imports/app/demo/demo.component.test.ts
 delete mode 100644 client/imports/app/demo/demo.component.ts
 delete mode 100644 client/imports/app/index.ts
 delete mode 100644 client/init.test.ts
 delete mode 100644 server/imports/server-main/main.test.ts

diff --git a/both/collections/demo-collection.ts b/both/collections/demo-collection.ts
deleted file mode 100644
index 371b609..0000000
--- a/both/collections/demo-collection.ts
+++ /dev/null
@@ -1,4 +0,0 @@
-import { MongoObservable } from 'meteor-rxjs';
-import { DemoDataObject } from '../models/demo-data-object';
-
-export const DemoCollection = new MongoObservable.Collection<DemoDataObject>('demo-collection');
\ No newline at end of file
diff --git a/both/models/demo-data-object.ts b/both/models/demo-data-object.ts
deleted file mode 100644
index 64846d7..0000000
--- a/both/models/demo-data-object.ts
+++ /dev/null
@@ -1,4 +0,0 @@
-export interface DemoDataObject {
-  name: string;
-  age: number;
-}
\ No newline at end of file
diff --git a/client/imports/app/app.component.html b/client/imports/app/app.component.html
index 1d40faa..3c4adac 100644
--- a/client/imports/app/app.component.html
+++ b/client/imports/app/app.component.html
@@ -1,4 +1,3 @@
 <div>
     <h1>Hello Angular2-Meteor!</h1>
-    <demo></demo>
 </div>
diff --git a/client/imports/app/app.component.scss b/client/imports/app/app.component.scss
index 4c02b72..e69de29 100644
--- a/client/imports/app/app.component.scss
+++ b/client/imports/app/app.component.scss
@@ -1,5 +0,0 @@
-body {
-
-}
-
-@import "./imports/demo/demo.component";
diff --git a/client/imports/app/app.module.ts b/client/imports/app/app.module.ts
index 81baa33..40a3119 100644
--- a/client/imports/app/app.module.ts
+++ b/client/imports/app/app.module.ts
@@ -1,16 +1,11 @@
 import { NgModule } from '@angular/core';
 import { BrowserModule } from '@angular/platform-browser';
-import { METEOR_PROVIDERS } from 'angular2-meteor';
-
 import { AppComponent } from './app.component';
-import { DemoComponent } from './demo/demo.component';
-import { DemoDataService } from './demo/demo-data.service';
 
 @NgModule({
   // Components, Pipes, Directive
   declarations: [
-    AppComponent,
-    DemoComponent
+    AppComponent
   ],
   // Entry Components
   entryComponents: [
@@ -18,7 +13,7 @@ import { DemoDataService } from './demo/demo-data.service';
   ],
   // Providers
   providers: [
-    DemoDataService
+
   ],
   // Modules
   imports: [
diff --git a/client/imports/app/demo/demo-data.service.test.ts b/client/imports/app/demo/demo-data.service.test.ts
deleted file mode 100644
index 4320d63..0000000
--- a/client/imports/app/demo/demo-data.service.test.ts
+++ /dev/null
@@ -1,19 +0,0 @@
-// chai uses as asset library
-import { assert } from 'chai';
-import { Mongo } from 'meteor/mongo';
-
-// Project imports
-import { DemoDataService } from './demo-data.service';
-
-describe('DemoDataService', () => {
-  let demoDataService:DemoDataService;
-
-  beforeEach(() => {
-    // Create the service instance
-    demoDataService = new DemoDataService();
-  });
-
-  it('Should return MongoDB Cursor when requesting the data', () => {
-    assert.isTrue(demoDataService.getData() instanceof Mongo.Cursor);
-  });
-});
diff --git a/client/imports/app/demo/demo-data.service.ts b/client/imports/app/demo/demo-data.service.ts
deleted file mode 100644
index 357aaf7..0000000
--- a/client/imports/app/demo/demo-data.service.ts
+++ /dev/null
@@ -1,18 +0,0 @@
-import { Injectable } from '@angular/core';
-import { ObservableCursor } from 'meteor-rxjs';
-
-import { DemoDataObject } from '../../../../both/models/demo-data-object';
-import { DemoCollection } from '../../../../both/collections/demo-collection';
-
-@Injectable()
-export class DemoDataService {
-  private data : ObservableCursor<DemoDataObject>;
-
-  constructor() {
-    this.data = DemoCollection.find({});
-  }
-
-  public getData() : ObservableCursor<DemoDataObject> {
-    return this.data;
-  }
-}
diff --git a/client/imports/app/demo/demo.component.html b/client/imports/app/demo/demo.component.html
deleted file mode 100644
index 38180c6..0000000
--- a/client/imports/app/demo/demo.component.html
+++ /dev/null
@@ -1,8 +0,0 @@
-<h2>{{greeting}}</h2>
-
-This is the available data:
-<ul>
-    <li *ngFor="let item of data | async">
-        {{item.name}} ({{item.age}})
-    </li>
-</ul>
diff --git a/client/imports/app/demo/demo.component.scss b/client/imports/app/demo/demo.component.scss
deleted file mode 100644
index 9e27489..0000000
--- a/client/imports/app/demo/demo.component.scss
+++ /dev/null
@@ -1,3 +0,0 @@
-demo {
-
-}
diff --git a/client/imports/app/demo/demo.component.test.ts b/client/imports/app/demo/demo.component.test.ts
deleted file mode 100644
index 39221cd..0000000
--- a/client/imports/app/demo/demo.component.test.ts
+++ /dev/null
@@ -1,95 +0,0 @@
-// chai uses as asset library
-import { assert } from 'chai';
-
-// Angular 2 tests imports
-import { inject } from '@angular/core';
-import { provide } from '@angular/core';
-import { TestComponentBuilder } from '@angular/compiler';
-
-// Project imports
-import { DemoComponent } from './demo.component';
-import { DemoDataService } from './demo-data.service';
-import { DemoDataObject } from '../../../../both/models/demo-data-object';
-
-describe('DemoComponent', () => {
-  let demoComponentInstance:DemoComponent;
-  let demoComponentElement;
-  let componentFixture;
-
-  let mockDataArray = [
-    <DemoDataObject>{
-      name: 'Test',
-      age: 10
-    }
-  ];
-
-  let mockDataService = {
-    getData: () => mockDataArray
-  };
-
-  beforeEach(inject([TestComponentBuilder], (tcb:TestComponentBuilder) => {
-    // We inject TestComponentBuilder that provides use the ability to control the injections of the component
-    // Then we will request to get DemoComponent with a mock service instead of the real DemoDataService
-    // The fixture created contain the element and the instance of the Component class
-    // Finally, we need to save 'detectChanges' and call it to flush the changes into the view.
-    return tcb.overrideProviders(DemoComponent, [
-      provide(DemoDataService, {useValue: mockDataService})
-    ]).createAsync(DemoComponent).then((fixture) => {
-      componentFixture = fixture;
-
-      demoComponentInstance = componentFixture.componentInstance;
-      demoComponentElement = componentFixture.nativeElement;
-
-      componentFixture.detectChanges();
-    });
-  }));
-
-  describe('@Component instance', () => {
-    it('Should have a greeting string on the component', () => {
-      assert.typeOf(demoComponentInstance.greeting, 'string', 'Greeting should be a string!');
-    });
-
-    it('Should say hello to the component on the greeting string', () => {
-      assert.equal(demoComponentInstance.greeting, 'Hello Demo Component!');
-    });
-
-    it('Should have an array (from the mock) of the instance', () => {
-      assert.typeOf(demoComponentInstance.getData(), 'array');
-    });
-
-    it('Should have an items in the array', () => {
-      assert.typeOf(demoComponentInstance.getData(), 'array');
-      assert.equal((<Array>demoComponentInstance.getData()).length, 1);
-    });
-  });
-
-  describe('@Component view', () => {
-    it('Should print the greeting to the screen', () => {
-      assert.include(demoComponentElement.innerHTML, 'Hello Demo Component');
-    });
-
-    it('Should change the greeting when it changes', () => {
-      assert.include(demoComponentElement.innerHTML, 'Hello Demo Component');
-      demoComponentInstance.greeting = 'New Test Greeting';
-      componentFixture.detectChanges();
-      assert.include(demoComponentElement.innerHTML, 'New Test Greeting');
-    });
-
-    it('Should display a list of items in the screen', () => {
-      assert.isNotNull(demoComponentElement.querySelector('ul'));
-    });
-
-    it('Should add item to the list when modifying the data in the service', () => {
-      assert.equal(demoComponentElement.querySelectorAll('li').length, 1);
-
-      mockDataArray.push({
-        name: 'Dotan',
-        age: 20
-      });
-
-      componentFixture.detectChanges();
-
-      assert.equal(demoComponentElement.querySelectorAll('li').length, 2);
-    });
-  });
-});
diff --git a/client/imports/app/demo/demo.component.ts b/client/imports/app/demo/demo.component.ts
deleted file mode 100644
index 9a4df43..0000000
--- a/client/imports/app/demo/demo.component.ts
+++ /dev/null
@@ -1,25 +0,0 @@
-import { Component, OnInit } from '@angular/core';
-import { ObservableCursor } from 'meteor-rxjs';
-import { Observable } from 'rxjs/Observable';
-
-import { DemoDataService } from './demo-data.service';
-import { DemoDataObject } from '../../../../both/models/demo-data-object';
-
-import template from './demo.component.html';
-
-@Component({
-  selector: 'demo',
-  template
-})
-export class DemoComponent implements OnInit {
-  greeting: string;
-  data: Observable<DemoDataObject[]>;
-
-  constructor(private demoDataService: DemoDataService) {
-    this.greeting = 'Hello Demo Component!';
-  }
-
-  ngOnInit() {
-    this.data = this.demoDataService.getData().zone();
-  }
-}
diff --git a/client/imports/app/index.ts b/client/imports/app/index.ts
deleted file mode 100644
index 875bdb2..0000000
--- a/client/imports/app/index.ts
+++ /dev/null
@@ -1,2 +0,0 @@
-export * from './app.component';
-export * from './app.module';
diff --git a/client/init.test.ts b/client/init.test.ts
deleted file mode 100644
index cd07c0b..0000000
--- a/client/init.test.ts
+++ /dev/null
@@ -1,12 +0,0 @@
-// angular2-meteor polyfills required for testing
-import 'angular2-meteor-tests-polyfills';
-
-// Angular 2 tests imports
-import { platformBrowserDynamicTesting, BrowserDynamicTestingModule } from '@angular/platform-browser-dynamic';
-import { TestBed } from '@angular/core';
-
-// Init the test framework
-TestBed.initTestEnvironment(
-  BrowserDynamicTestingModule,
-  platformBrowserDynamicTesting()
-);
diff --git a/client/main.ts b/client/main.ts
index 8f35a92..2b50651 100644
--- a/client/main.ts
+++ b/client/main.ts
@@ -3,7 +3,7 @@ import 'angular2-meteor-polyfills';
 import { platformBrowserDynamic } from '@angular/platform-browser-dynamic';
 import { enableProdMode } from '@angular/core';
 import { Meteor } from "meteor/meteor";
-import { AppModule } from './imports/app';
+import { AppModule } from './imports/app/app.module';
 
 enableProdMode();
 
diff --git a/server/imports/server-main/main.test.ts b/server/imports/server-main/main.test.ts
deleted file mode 100644
index e050427..0000000
--- a/server/imports/server-main/main.test.ts
+++ /dev/null
@@ -1,40 +0,0 @@
-// chai uses as asset library
-import * as chai from 'chai';
-import * as spies from 'chai-spies';
-import StubCollections from 'meteor/hwillson:stub-collections';
-
-import { DemoCollection } from '../../../both/collections/demo-collection';
-import { Main } from './main';
-
-chai.use(spies);
-
-describe('Server Main', () => {
-  let mainInstance : Main;
-
-  beforeEach(() => {
-    // Creating database mock
-    StubCollections.stub(DemoCollection);
-
-    // Create instance of main class
-    mainInstance = new Main();
-  });
-
-  afterEach(() => {
-    // Restore database
-    StubCollections.restore();
-  });
-
-  it('Should call initFakeData on startup', () => {
-    mainInstance.initFakeData = chai.spy();
-    mainInstance.start();
-
-    chai.expect(mainInstance.initFakeData).to.have.been.called();
-  });
-
-  it('Should call insert 3 times when init fake data', () => {
-    DemoCollection.insert = chai.spy();
-    mainInstance.initFakeData();
-
-    chai.expect(DemoCollection.insert).to.have.been.called.exactly(3);
-  });
-});
diff --git a/server/imports/server-main/main.ts b/server/imports/server-main/main.ts
index d4b1cda..ca6ff2f 100644
--- a/server/imports/server-main/main.ts
+++ b/server/imports/server-main/main.ts
@@ -1,27 +1,5 @@
-import { DemoCollection } from '../../../both/collections/demo-collection';
-import { DemoDataObject } from '../../../both/models/demo-data-object';
-
 export class Main {
   start(): void {
-    this.initFakeData();
-  }
 
-  initFakeData(): void {
-    if (DemoCollection.find({}).cursor.count() === 0) {
-      const data: DemoDataObject[] = [{
-        name: 'Dotan',
-        age: 25
-      }, {
-        name: 'Liran',
-        age: 26
-      }, {
-        name: 'Uri',
-        age: 30
-      }];
-      
-      data.forEach((obj: DemoDataObject) => {
-        DemoCollection.insert(obj);
-      });
-    }
   }
 }
-- 
2.9.3 (Apple Git-75)


From 22875b8323f1c910c1c46e1302c5215e7d01fb80 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 4 Oct 2016 21:15:33 +0300
Subject: [PATCH 002/128] Step 1.2: Added Ionic 2 and it's dependencies

---
 package.json | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/package.json b/package.json
index aabacb5..d858ee2 100644
--- a/package.json
+++ b/package.json
@@ -30,12 +30,16 @@
     "@angular/compiler": "2.0.1",
     "@angular/core": "2.0.1",
     "@angular/forms": "2.0.1",
+    "@angular/http": "^2.0.1",
     "@angular/platform-browser": "2.0.1",
     "@angular/platform-browser-dynamic": "2.0.1",
+    "@angular/platform-server": "^2.0.1",
     "@angular/router": "3.0.1",
     "angular2-meteor": "0.7.0",
     "angular2-meteor-polyfills": "0.1.1",
     "angular2-meteor-tests-polyfills": "0.0.2",
+    "ionic-angular": "^2.0.0-rc.0",
+    "ionicons": "^3.0.0",
     "meteor-node-stubs": "0.2.3",
     "meteor-rxjs": "0.2.3",
     "reflect-metadata": "0.1.8",
-- 
2.9.3 (Apple Git-75)


From 4fa89f2d2eef04e052226202370e7d523a75a5f8 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 4 Oct 2016 21:25:51 +0300
Subject: [PATCH 003/128] Step 1.3: Updated the NgModule to use Ionic 2

---
 client/imports/app/app.module.ts | 6 +++---
 1 file changed, 3 insertions(+), 3 deletions(-)

diff --git a/client/imports/app/app.module.ts b/client/imports/app/app.module.ts
index 40a3119..a96f8e9 100644
--- a/client/imports/app/app.module.ts
+++ b/client/imports/app/app.module.ts
@@ -1,6 +1,6 @@
 import { NgModule } from '@angular/core';
-import { BrowserModule } from '@angular/platform-browser';
 import { AppComponent } from './app.component';
+import { IonicApp, IonicModule } from "ionic-angular";
 
 @NgModule({
   // Components, Pipes, Directive
@@ -17,9 +17,9 @@ import { AppComponent } from './app.component';
   ],
   // Modules
   imports: [
-    BrowserModule
+    IonicModule.forRoot(AppComponent)
   ],
   // Main Component
-  bootstrap: [ AppComponent ]
+  bootstrap: [ IonicApp ]
 })
 export class AppModule {}
-- 
2.9.3 (Apple Git-75)


From 92f2eeee4792e61ee27f2ef865d10040c2ebe26b Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 4 Oct 2016 21:26:12 +0300
Subject: [PATCH 004/128] Step 1.4: Changed the root Component tag

---
 client/index.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/index.html b/client/index.html
index d3675e5..2e01ea4 100644
--- a/client/index.html
+++ b/client/index.html
@@ -2,5 +2,5 @@
     <base href="/">
 </head>
 <body>
-  <app>Loading...</app>
+  <ion-app>Loading...</ion-app>
 </body>
-- 
2.9.3 (Apple Git-75)


From a7699eeb4b3fd7608ffd7a318eb4bb1fdafd396e Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 4 Oct 2016 21:31:16 +0300
Subject: [PATCH 005/128] Step 1.5: Added import for Ionic 2 stylesheet

---
 client/styles/ionic.scss | 280 +++++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 280 insertions(+)
 create mode 100644 client/styles/ionic.scss

diff --git a/client/styles/ionic.scss b/client/styles/ionic.scss
new file mode 100644
index 0000000..186f82b
--- /dev/null
+++ b/client/styles/ionic.scss
@@ -0,0 +1,280 @@
+@charset "UTF-8";
+
+@import "{}/node_modules/ionicons/dist/scss/ionicons.scss";
+
+// Shared Variables
+// --------------------------------------------------
+// To customize the look and feel of this app, you can override
+// the Sass variables found in Ionic's source scss files.
+// To view all the possible Ionic variables, see:
+// http://ionicframework.com/docs/v2/theming/overriding-ionic-variables/
+
+$text-color:        #000;
+$background-color:  #fff;
+
+
+// Named Color Variables
+// --------------------------------------------------
+// Named colors makes it easy to reuse colors on various components.
+// It's highly recommended to change the default colors
+// to match your app's branding. Ionic uses a Sass map of
+// colors so you can add, rename and remove colors as needed.
+// The "primary" color is the only required color in the map.
+
+$colors: (
+        primary:    #387ef5,
+        secondary:  #32db64,
+        danger:     #f53d3d,
+        light:      #f4f4f4,
+        dark:       #222,
+        favorite:   #69BB7B
+);
+
+// Components
+// --------------------------------------------------
+
+@import
+"{}/node_modules/ionic-angular/components/action-sheet/action-sheet",
+"{}/node_modules/ionic-angular/components/action-sheet/action-sheet.ios",
+"{}/node_modules/ionic-angular/components/action-sheet/action-sheet.md",
+"{}/node_modules/ionic-angular/components/action-sheet/action-sheet.wp";
+
+@import
+"{}/node_modules/ionic-angular/components/alert/alert",
+"{}/node_modules/ionic-angular/components/alert/alert.ios",
+"{}/node_modules/ionic-angular/components/alert/alert.md",
+"{}/node_modules/ionic-angular/components/alert/alert.wp";
+
+@import
+"{}/node_modules/ionic-angular/components/app/app",
+"{}/node_modules/ionic-angular/components/app/app.ios",
+"{}/node_modules/ionic-angular/components/app/app.md",
+"{}/node_modules/ionic-angular/components/app/app.wp";
+
+@import
+"{}/node_modules/ionic-angular/components/backdrop/backdrop";
+
+@import
+"{}/node_modules/ionic-angular/components/badge/badge",
+"{}/node_modules/ionic-angular/components/badge/badge.ios",
+"{}/node_modules/ionic-angular/components/badge/badge.md",
+"{}/node_modules/ionic-angular/components/badge/badge.wp";
+
+@import
+"{}/node_modules/ionic-angular/components/button/button",
+"{}/node_modules/ionic-angular/components/button/button-icon",
+"{}/node_modules/ionic-angular/components/button/button.ios",
+"{}/node_modules/ionic-angular/components/button/button.md",
+"{}/node_modules/ionic-angular/components/button/button.wp";
+
+@import
+"{}/node_modules/ionic-angular/components/card/card",
+"{}/node_modules/ionic-angular/components/card/card.ios",
+"{}/node_modules/ionic-angular/components/card/card.md",
+"{}/node_modules/ionic-angular/components/card/card.wp";
+
+@import
+"{}/node_modules/ionic-angular/components/checkbox/checkbox.ios",
+"{}/node_modules/ionic-angular/components/checkbox/checkbox.md",
+"{}/node_modules/ionic-angular/components/checkbox/checkbox.wp";
+
+@import
+"{}/node_modules/ionic-angular/components/chip/chip",
+"{}/node_modules/ionic-angular/components/chip/chip.ios",
+"{}/node_modules/ionic-angular/components/chip/chip.md",
+"{}/node_modules/ionic-angular/components/chip/chip.wp";
+
+@import
+"{}/node_modules/ionic-angular/components/content/content",
+"{}/node_modules/ionic-angular/components/content/content.ios",
+"{}/node_modules/ionic-angular/components/content/content.md",
+"{}/node_modules/ionic-angular/components/content/content.wp";
+
+@import
+"{}/node_modules/ionic-angular/components/datetime/datetime",
+"{}/node_modules/ionic-angular/components/datetime/datetime.ios",
+"{}/node_modules/ionic-angular/components/datetime/datetime.md",
+"{}/node_modules/ionic-angular/components/datetime/datetime.wp";
+
+@import
+"{}/node_modules/ionic-angular/components/fab/fab",
+"{}/node_modules/ionic-angular/components/fab/fab.ios",
+"{}/node_modules/ionic-angular/components/fab/fab.md",
+"{}/node_modules/ionic-angular/components/fab/fab.wp";
+
+@import
+"{}/node_modules/ionic-angular/components/grid/grid";
+
+@import
+"{}/node_modules/ionic-angular/components/icon/icon",
+"{}/node_modules/ionic-angular/components/icon/icon.ios",
+"{}/node_modules/ionic-angular/components/icon/icon.md",
+"{}/node_modules/ionic-angular/components/icon/icon.wp";
+
+@import
+"{}/node_modules/ionic-angular/components/img/img";
+
+@import
+"{}/node_modules/ionic-angular/components/infinite-scroll/infinite-scroll";
+
+@import
+"{}/node_modules/ionic-angular/components/input/input",
+"{}/node_modules/ionic-angular/components/input/input.ios",
+"{}/node_modules/ionic-angular/components/input/input.md",
+"{}/node_modules/ionic-angular/components/input/input.wp";
+
+@import
+"{}/node_modules/ionic-angular/components/item/item",
+"{}/node_modules/ionic-angular/components/item/item-media",
+"{}/node_modules/ionic-angular/components/item/item-reorder",
+"{}/node_modules/ionic-angular/components/item/item-sliding",
+"{}/node_modules/ionic-angular/components/item/item.ios",
+"{}/node_modules/ionic-angular/components/item/item.md",
+"{}/node_modules/ionic-angular/components/item/item.wp";
+
+@import
+"{}/node_modules/ionic-angular/components/label/label",
+"{}/node_modules/ionic-angular/components/label/label.ios",
+"{}/node_modules/ionic-angular/components/label/label.md",
+"{}/node_modules/ionic-angular/components/label/label.wp";
+
+@import
+"{}/node_modules/ionic-angular/components/list/list",
+"{}/node_modules/ionic-angular/components/list/list.ios",
+"{}/node_modules/ionic-angular/components/list/list.md",
+"{}/node_modules/ionic-angular/components/list/list.wp";
+
+@import
+"{}/node_modules/ionic-angular/components/loading/loading",
+"{}/node_modules/ionic-angular/components/loading/loading.ios",
+"{}/node_modules/ionic-angular/components/loading/loading.md",
+"{}/node_modules/ionic-angular/components/loading/loading.wp";
+
+@import
+"{}/node_modules/ionic-angular/components/menu/menu",
+"{}/node_modules/ionic-angular/components/menu/menu.ios",
+"{}/node_modules/ionic-angular/components/menu/menu.md",
+"{}/node_modules/ionic-angular/components/menu/menu.wp";
+
+@import
+"{}/node_modules/ionic-angular/components/modal/modal",
+"{}/node_modules/ionic-angular/components/modal/modal.ios",
+"{}/node_modules/ionic-angular/components/modal/modal.md",
+"{}/node_modules/ionic-angular/components/modal/modal.wp";
+
+@import
+"{}/node_modules/ionic-angular/components/picker/picker",
+"{}/node_modules/ionic-angular/components/picker/picker.ios",
+"{}/node_modules/ionic-angular/components/picker/picker.md",
+"{}/node_modules/ionic-angular/components/picker/picker.wp";
+
+@import
+"{}/node_modules/ionic-angular/components/popover/popover",
+"{}/node_modules/ionic-angular/components/popover/popover.ios",
+"{}/node_modules/ionic-angular/components/popover/popover.md",
+"{}/node_modules/ionic-angular/components/popover/popover.wp";
+
+@import
+"{}/node_modules/ionic-angular/components/radio/radio.ios",
+"{}/node_modules/ionic-angular/components/radio/radio.md",
+"{}/node_modules/ionic-angular/components/radio/radio.wp";
+
+@import
+"{}/node_modules/ionic-angular/components/range/range",
+"{}/node_modules/ionic-angular/components/range/range.ios",
+"{}/node_modules/ionic-angular/components/range/range.md",
+"{}/node_modules/ionic-angular/components/range/range.wp";
+
+@import
+"{}/node_modules/ionic-angular/components/refresher/refresher";
+
+@import
+"{}/node_modules/ionic-angular/components/scroll/scroll";
+
+@import
+"{}/node_modules/ionic-angular/components/searchbar/searchbar",
+"{}/node_modules/ionic-angular/components/searchbar/searchbar.ios",
+"{}/node_modules/ionic-angular/components/searchbar/searchbar.md",
+"{}/node_modules/ionic-angular/components/searchbar/searchbar.wp";
+
+@import
+"{}/node_modules/ionic-angular/components/segment/segment",
+"{}/node_modules/ionic-angular/components/segment/segment.ios",
+"{}/node_modules/ionic-angular/components/segment/segment.md",
+"{}/node_modules/ionic-angular/components/segment/segment.wp";
+
+@import
+"{}/node_modules/ionic-angular/components/select/select",
+"{}/node_modules/ionic-angular/components/select/select.ios",
+"{}/node_modules/ionic-angular/components/select/select.md",
+"{}/node_modules/ionic-angular/components/select/select.wp";
+
+@import
+"{}/node_modules/ionic-angular/components/show-hide-when/show-hide-when";
+
+@import
+"{}/node_modules/ionic-angular/components/slides/slides";
+
+@import
+"{}/node_modules/ionic-angular/components/spinner/spinner",
+"{}/node_modules/ionic-angular/components/spinner/spinner.ios",
+"{}/node_modules/ionic-angular/components/spinner/spinner.md",
+"{}/node_modules/ionic-angular/components/spinner/spinner.wp";
+
+@import
+"{}/node_modules/ionic-angular/components/tabs/tabs",
+"{}/node_modules/ionic-angular/components/tabs/tabs.ios",
+"{}/node_modules/ionic-angular/components/tabs/tabs.md",
+"{}/node_modules/ionic-angular/components/tabs/tabs.wp";
+
+@import
+"{}/node_modules/ionic-angular/components/toast/toast",
+"{}/node_modules/ionic-angular/components/toast/toast.ios",
+"{}/node_modules/ionic-angular/components/toast/toast.md",
+"{}/node_modules/ionic-angular/components/toast/toast.wp";
+
+@import
+"{}/node_modules/ionic-angular/components/toggle/toggle.ios",
+"{}/node_modules/ionic-angular/components/toggle/toggle.md",
+"{}/node_modules/ionic-angular/components/toggle/toggle.wp";
+
+@import
+"{}/node_modules/ionic-angular/components/toolbar/toolbar",
+"{}/node_modules/ionic-angular/components/toolbar/toolbar-button",
+"{}/node_modules/ionic-angular/components/toolbar/toolbar.ios",
+"{}/node_modules/ionic-angular/components/toolbar/toolbar.md",
+"{}/node_modules/ionic-angular/components/toolbar/toolbar.wp";
+
+@import
+"{}/node_modules/ionic-angular/components/typography/typography",
+"{}/node_modules/ionic-angular/components/typography/typography.ios",
+"{}/node_modules/ionic-angular/components/typography/typography.md",
+"{}/node_modules/ionic-angular/components/typography/typography.wp";
+
+@import
+"{}/node_modules/ionic-angular/components/virtual-scroll/virtual-scroll";
+
+
+// Platforms
+// --------------------------------------------------
+@import
+"{}/node_modules/ionic-angular/platform/cordova",
+"{}/node_modules/ionic-angular/platform/cordova.ios",
+"{}/node_modules/ionic-angular/platform/cordova.md",
+"{}/node_modules/ionic-angular/platform/cordova.wp";
+
+
+// Ionic Variables and Theming. For more info, please see:
+// http://ionicframework.com/docs/v2/theming/
+@import "{}/node_modules/ionic-angular/themes/ionic.globals.scss";
+
+
+// App Theme
+// --------------------------------------------------
+// Ionic apps can have different themes applied, which can
+// then be future customized. This import comes last
+// so that the above variables are used and Ionic's
+// default are overridden.
+
+@import "{}/node_modules/ionic-angular/themes/ionic.theme.default.scss";
+
-- 
2.9.3 (Apple Git-75)


From ae85cfdbb331cc8bf5422c8dde34c417bc85923c Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 4 Oct 2016 21:34:44 +0300
Subject: [PATCH 006/128] Step 1.6: Added mys:fonts

---
 .meteor/packages | 1 +
 .meteor/versions | 1 +
 2 files changed, 2 insertions(+)

diff --git a/.meteor/packages b/.meteor/packages
index cd12a6f..d4f74d0 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -23,3 +23,4 @@ xolvio:cleaner
 hwillson:stub-collections
 dispatch:mocha-phantomjs
 shell-server
+mys:fonts
diff --git a/.meteor/versions b/.meteor/versions
index 9886afc..7e1c968 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -55,6 +55,7 @@ modules@0.7.6
 modules-runtime@0.7.6
 mongo@1.1.12
 mongo-id@1.0.5
+mys:fonts@0.0.2
 npm-mongo@1.5.49
 observe-sequence@1.0.12
 ordered-dict@1.0.8
-- 
2.9.3 (Apple Git-75)


From ab32d2fb580f58f271f7d378b8b44c66ede2b5f2 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 4 Oct 2016 21:37:46 +0300
Subject: [PATCH 007/128] Step 1.7: Added fonts file declaration

---
 fonts.json | 11 +++++++++++
 1 file changed, 11 insertions(+)
 create mode 100644 fonts.json

diff --git a/fonts.json b/fonts.json
new file mode 100644
index 0000000..f444c35
--- /dev/null
+++ b/fonts.json
@@ -0,0 +1,11 @@
+{
+  "map": {
+    "node_modules/ionic-angular/fonts/roboto-medium.ttf": "fonts/roboto-medium.ttf",
+    "node_modules/ionic-angular/fonts/roboto-regular.ttf": "fonts/roboto-regular.ttf",
+    "node_modules/ionic-angular/fonts/roboto-medium.woff": "fonts/roboto-medium.woff",
+    "node_modules/ionic-angular/fonts/roboto-regular.woff": "fonts/roboto-regular.woff",
+    "node_modules/ionicons/dist/fonts/ionicons.woff": "fonts/ionicons.woff",
+    "node_modules/ionicons/dist/fonts/ionicons.woff2": "fonts/ionicons.woff2",
+    "node_modules/ionicons/dist/fonts/ionicons.ttf": "fonts/ionicons.ttf"
+  }
+}
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From e96518d8282b358b04e348db0b0cc12753fac964 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 4 Oct 2016 21:42:15 +0300
Subject: [PATCH 008/128] Step 1.8: Added ionic-native package

---
 package.json | 1 +
 1 file changed, 1 insertion(+)

diff --git a/package.json b/package.json
index d858ee2..3929642 100644
--- a/package.json
+++ b/package.json
@@ -40,6 +40,7 @@
     "angular2-meteor-tests-polyfills": "0.0.2",
     "ionic-angular": "^2.0.0-rc.0",
     "ionicons": "^3.0.0",
+    "ionic-native": "^2.0.3",
     "meteor-node-stubs": "0.2.3",
     "meteor-rxjs": "0.2.3",
     "reflect-metadata": "0.1.8",
-- 
2.9.3 (Apple Git-75)


From 881d5d759b5348d48193918c14cd6edef5024682 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 4 Oct 2016 21:42:32 +0300
Subject: [PATCH 009/128] Step 1.9: Basic native functionality added

---
 client/imports/app/app.component.ts | 10 ++++++++--
 1 file changed, 8 insertions(+), 2 deletions(-)

diff --git a/client/imports/app/app.component.ts b/client/imports/app/app.component.ts
index ca2fb29..5869be0 100644
--- a/client/imports/app/app.component.ts
+++ b/client/imports/app/app.component.ts
@@ -1,5 +1,6 @@
 import { Component } from '@angular/core';
-
+import { Platform } from "ionic-angular";
+import { StatusBar } from "ionic-native";
 import template from './app.component.html';
 
 @Component({
@@ -7,6 +8,11 @@ import template from './app.component.html';
   template
 })
 export class AppComponent {
-  constructor() {
+  constructor(platform: Platform) {
+    platform.ready().then(() => {
+      // Okay, so the platform is ready and our plugins are available.
+      // Here you can do any higher level native things you might need.
+      StatusBar.styleDefault();
+    });
   }
 }
-- 
2.9.3 (Apple Git-75)


From 74cbdc737f4ce8816e609df1f5c58d5f83c7c786 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 4 Oct 2016 21:57:08 +0300
Subject: [PATCH 010/128] Step 1.10: Added iOS platform

---
 .meteor/platforms | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/.meteor/platforms b/.meteor/platforms
index efeba1b..81ae701 100644
--- a/.meteor/platforms
+++ b/.meteor/platforms
@@ -1,2 +1,3 @@
-server
 browser
+ios
+server
-- 
2.9.3 (Apple Git-75)


From 9d3a604ae94e7180468b67c1e0e04376a537b58c Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 4 Oct 2016 21:57:22 +0300
Subject: [PATCH 011/128] Step 1.11: Added missing Ionic 2 meta tags

---
 client/index.html | 8 ++++++--
 1 file changed, 6 insertions(+), 2 deletions(-)

diff --git a/client/index.html b/client/index.html
index 2e01ea4..1f9d258 100644
--- a/client/index.html
+++ b/client/index.html
@@ -1,6 +1,10 @@
 <head>
-    <base href="/">
+  <base href="/">
+  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
+  <meta name="format-detection" content="telephone=no">
+  <meta name="msapplication-tap-highlight" content="no">
+  <meta name="theme-color" content="#4e8ef7">
 </head>
 <body>
-  <ion-app>Loading...</ion-app>
+<ion-app>Loading...</ion-app>
 </body>
-- 
2.9.3 (Apple Git-75)


From 57ce8431746ae964104426d42816edb10977d375 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 3 Nov 2016 11:16:35 +0200
Subject: [PATCH 012/128] Step 1.12: Removed mobile-experience and added
 mobile-status-bar, launch-screen

---
 .meteor/packages | 3 ++-
 .meteor/versions | 2 --
 2 files changed, 2 insertions(+), 3 deletions(-)

diff --git a/.meteor/packages b/.meteor/packages
index d4f74d0..c67b676 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -5,7 +5,6 @@
 # but you can also edit it by hand.
 
 meteor-base@1.0.4             # Packages every Meteor app needs to have
-mobile-experience@1.0.4       # Packages for a great mobile UX
 mongo@1.1.12                   # The database Meteor supports right now
 reactive-var@1.0.10            # Reactive variable for tracker
 jquery@1.11.9                  # Helpful client-side library
@@ -24,3 +23,5 @@ hwillson:stub-collections
 dispatch:mocha-phantomjs
 shell-server
 mys:fonts
+mobile-status-bar
+launch-screen
diff --git a/.meteor/versions b/.meteor/versions
index 7e1c968..563029a 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -31,7 +31,6 @@ ecmascript@0.5.8
 ecmascript-runtime@0.3.14
 ejson@1.0.12
 es5-shim@4.6.14
-fastclick@1.0.12
 geojson-utils@1.0.9
 hot-code-push@1.0.4
 html-tools@1.0.11
@@ -49,7 +48,6 @@ meteor-base@1.0.4
 minifier-css@1.2.14
 minifier-js@1.2.14
 minimongo@1.0.17
-mobile-experience@1.0.4
 mobile-status-bar@1.0.12
 modules@0.7.6
 modules-runtime@0.7.6
-- 
2.9.3 (Apple Git-75)


From 3ae247fdaa52e30c14566ddceaa01def553b976c Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 14 Oct 2016 09:44:01 +0200
Subject: [PATCH 013/128] Step 1: Initial setup

---
 steps/step1.md | 0
 1 file changed, 0 insertions(+), 0 deletions(-)
 create mode 100644 steps/step1.md

diff --git a/steps/step1.md b/steps/step1.md
new file mode 100644
index 0000000..e69de29
-- 
2.9.3 (Apple Git-75)


From 59f22c00f42d83b60f4f663c44dc6652ba78cb98 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 4 Oct 2016 21:57:37 +0300
Subject: [PATCH 014/128] Step 2.1: Added tabs container component

---
 .../pages/tabs-container/tabs-container.component.ts    | 17 +++++++++++++++++
 1 file changed, 17 insertions(+)
 create mode 100644 client/imports/pages/tabs-container/tabs-container.component.ts

diff --git a/client/imports/pages/tabs-container/tabs-container.component.ts b/client/imports/pages/tabs-container/tabs-container.component.ts
new file mode 100644
index 0000000..1c13731
--- /dev/null
+++ b/client/imports/pages/tabs-container/tabs-container.component.ts
@@ -0,0 +1,17 @@
+import {Component} from "@angular/core";
+
+@Component({
+  selector: "tabs-container",
+  template: `
+  <ion-tabs>
+    <ion-tab tabTitle="Chats" tabIcon="chatboxes"></ion-tab>
+    <ion-tab tabTitle="Contacts" tabIcon="contacts"></ion-tab>
+    <ion-tab tabTitle="Favorites" tabIcon="star"></ion-tab>
+  </ion-tabs>
+  `
+})
+export class TabsContainerComponent {
+  constructor() {
+
+  }
+}
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From 1f742806dc71484419dc3de34d4c5555a688e5ed Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 4 Oct 2016 21:57:56 +0300
Subject: [PATCH 015/128] Step 2.2: Added the Component to the NgModule

---
 client/imports/app/app.module.ts | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/client/imports/app/app.module.ts b/client/imports/app/app.module.ts
index a96f8e9..e2721dd 100644
--- a/client/imports/app/app.module.ts
+++ b/client/imports/app/app.module.ts
@@ -1,15 +1,18 @@
 import { NgModule } from '@angular/core';
 import { AppComponent } from './app.component';
 import { IonicApp, IonicModule } from "ionic-angular";
+import {TabsContainerComponent} from "../pages/tabs-container/tabs-container.component";
 
 @NgModule({
   // Components, Pipes, Directive
   declarations: [
-    AppComponent
+    AppComponent,
+    TabsContainerComponent
   ],
   // Entry Components
   entryComponents: [
-    AppComponent
+    AppComponent,
+    TabsContainerComponent
   ],
   // Providers
   providers: [
-- 
2.9.3 (Apple Git-75)


From aeed0bbc4f857be0189f0e5f0c6f502ad5488e31 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 4 Oct 2016 21:58:19 +0300
Subject: [PATCH 016/128] Step 2.3: Updated the main component to use Ionic
 navigation

---
 client/imports/app/app.component.html | 4 +---
 1 file changed, 1 insertion(+), 3 deletions(-)

diff --git a/client/imports/app/app.component.html b/client/imports/app/app.component.html
index 3c4adac..202644e 100644
--- a/client/imports/app/app.component.html
+++ b/client/imports/app/app.component.html
@@ -1,3 +1 @@
-<div>
-    <h1>Hello Angular2-Meteor!</h1>
-</div>
+<ion-nav [root]="rootPage"></ion-nav>
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From e75bc8adce86029cf24d0650d12e79dec8c14207 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Tue, 4 Oct 2016 21:58:36 +0300
Subject: [PATCH 017/128] Step 2.4: Added missing rootPage variable

---
 client/imports/app/app.component.ts | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/client/imports/app/app.component.ts b/client/imports/app/app.component.ts
index 5869be0..772cc90 100644
--- a/client/imports/app/app.component.ts
+++ b/client/imports/app/app.component.ts
@@ -2,12 +2,15 @@ import { Component } from '@angular/core';
 import { Platform } from "ionic-angular";
 import { StatusBar } from "ionic-native";
 import template from './app.component.html';
+import {TabsContainerComponent} from "../pages/tabs-container/tabs-container.component";
 
 @Component({
   selector: 'app',
   template
 })
 export class AppComponent {
+  rootPage = TabsContainerComponent;
+
   constructor(platform: Platform) {
     platform.ready().then(() => {
       // Okay, so the platform is ready and our plugins are available.
-- 
2.9.3 (Apple Git-75)


From f3fcbe8eb78da7ae9a1df1e5a1364c3d969928b4 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Wed, 5 Oct 2016 14:09:59 +0300
Subject: [PATCH 018/128] Step 2.5: Added the chats page template

---
 client/imports/pages/chats/chats.component.html | 9 +++++++++
 1 file changed, 9 insertions(+)
 create mode 100644 client/imports/pages/chats/chats.component.html

diff --git a/client/imports/pages/chats/chats.component.html b/client/imports/pages/chats/chats.component.html
new file mode 100644
index 0000000..0c55ce6
--- /dev/null
+++ b/client/imports/pages/chats/chats.component.html
@@ -0,0 +1,9 @@
+<ion-header>
+  <ion-navbar>
+    <ion-title>Chats</ion-title>
+  </ion-navbar>
+</ion-header>
+
+<ion-content padding>
+  <h2>Welcome!</h2>
+</ion-content>
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From 47eb504e3edf611c083ddb2062a94e376fc7b886 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Wed, 5 Oct 2016 14:10:10 +0300
Subject: [PATCH 019/128] Step 2.6: Added the chats page component

---
 client/imports/pages/chats/chats.component.ts | 12 ++++++++++++
 1 file changed, 12 insertions(+)
 create mode 100644 client/imports/pages/chats/chats.component.ts

diff --git a/client/imports/pages/chats/chats.component.ts b/client/imports/pages/chats/chats.component.ts
new file mode 100644
index 0000000..b79d011
--- /dev/null
+++ b/client/imports/pages/chats/chats.component.ts
@@ -0,0 +1,12 @@
+import {Component} from "@angular/core";
+import template from "./chats.component.html"
+
+@Component({
+  selector: "chats",
+  template
+})
+export class ChatsComponent {
+  constructor() {
+
+  }
+}
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From fc17f71616b1a7f6f27812d85f32470387a06f6f Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Wed, 5 Oct 2016 14:10:32 +0300
Subject: [PATCH 020/128] Step 2.7: Added the chats page to the NgModule

---
 client/imports/app/app.module.ts | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/client/imports/app/app.module.ts b/client/imports/app/app.module.ts
index e2721dd..91af1b1 100644
--- a/client/imports/app/app.module.ts
+++ b/client/imports/app/app.module.ts
@@ -2,17 +2,20 @@ import { NgModule } from '@angular/core';
 import { AppComponent } from './app.component';
 import { IonicApp, IonicModule } from "ionic-angular";
 import {TabsContainerComponent} from "../pages/tabs-container/tabs-container.component";
+import {ChatsComponent} from "../pages/chats/chats.component";
 
 @NgModule({
   // Components, Pipes, Directive
   declarations: [
     AppComponent,
-    TabsContainerComponent
+    TabsContainerComponent,
+    ChatsComponent
   ],
   // Entry Components
   entryComponents: [
     AppComponent,
-    TabsContainerComponent
+    TabsContainerComponent,
+    ChatsComponent
   ],
   // Providers
   providers: [
-- 
2.9.3 (Apple Git-75)


From 1e963a38b4ddd24f2fb5544d591399be70a50073 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Wed, 5 Oct 2016 14:11:22 +0300
Subject: [PATCH 021/128] Step 2.8: Use the chats page component in ion-tabs

---
 client/imports/pages/tabs-container/tabs-container.component.ts | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/client/imports/pages/tabs-container/tabs-container.component.ts b/client/imports/pages/tabs-container/tabs-container.component.ts
index 1c13731..4a7160d 100644
--- a/client/imports/pages/tabs-container/tabs-container.component.ts
+++ b/client/imports/pages/tabs-container/tabs-container.component.ts
@@ -1,16 +1,19 @@
 import {Component} from "@angular/core";
+import {ChatsComponent} from "../chats/chats.component";
 
 @Component({
   selector: "tabs-container",
   template: `
   <ion-tabs>
-    <ion-tab tabTitle="Chats" tabIcon="chatboxes"></ion-tab>
+    <ion-tab [root]="chatsRoot" tabTitle="Chats" tabIcon="chatboxes"></ion-tab>
     <ion-tab tabTitle="Contacts" tabIcon="contacts"></ion-tab>
     <ion-tab tabTitle="Favorites" tabIcon="star"></ion-tab>
   </ion-tabs>
   `
 })
 export class TabsContainerComponent {
+  chatsRoot = ChatsComponent;
+
   constructor() {
 
   }
-- 
2.9.3 (Apple Git-75)


From da3b06ad03902fc052eee8554009118316e24ba4 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Wed, 5 Oct 2016 14:53:01 +0300
Subject: [PATCH 022/128] Step 2.9: Add whatsapp theme variable

---
 client/styles/ionic.scss | 3 ++-
 1 file changed, 2 insertions(+), 1 deletion(-)

diff --git a/client/styles/ionic.scss b/client/styles/ionic.scss
index 186f82b..4022576 100644
--- a/client/styles/ionic.scss
+++ b/client/styles/ionic.scss
@@ -27,7 +27,8 @@ $colors: (
         danger:     #f53d3d,
         light:      #f4f4f4,
         dark:       #222,
-        favorite:   #69BB7B
+        favorite:   #69BB7B,
+        whatsapp:   #075E54
 );
 
 // Components
-- 
2.9.3 (Apple Git-75)


From 3ba096c8601d7c362b770598790954bfccfec30f Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Wed, 5 Oct 2016 14:53:26 +0300
Subject: [PATCH 023/128] Step 2.10: Added theme usage for tabs component

---
 client/imports/pages/tabs-container/tabs-container.component.ts | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/imports/pages/tabs-container/tabs-container.component.ts b/client/imports/pages/tabs-container/tabs-container.component.ts
index 4a7160d..bcaed58 100644
--- a/client/imports/pages/tabs-container/tabs-container.component.ts
+++ b/client/imports/pages/tabs-container/tabs-container.component.ts
@@ -4,7 +4,7 @@ import {ChatsComponent} from "../chats/chats.component";
 @Component({
   selector: "tabs-container",
   template: `
-  <ion-tabs>
+  <ion-tabs color="whatsapp">
     <ion-tab [root]="chatsRoot" tabTitle="Chats" tabIcon="chatboxes"></ion-tab>
     <ion-tab tabTitle="Contacts" tabIcon="contacts"></ion-tab>
     <ion-tab tabTitle="Favorites" tabIcon="star"></ion-tab>
-- 
2.9.3 (Apple Git-75)


From 58fd3d1a382ca279afbbb9c88342dead3304a235 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Wed, 5 Oct 2016 14:59:36 +0300
Subject: [PATCH 024/128] Step 2.11: Added message model

---
 both/models/message.model.ts | 5 +++++
 1 file changed, 5 insertions(+)
 create mode 100644 both/models/message.model.ts

diff --git a/both/models/message.model.ts b/both/models/message.model.ts
new file mode 100644
index 0000000..1165f7f
--- /dev/null
+++ b/both/models/message.model.ts
@@ -0,0 +1,5 @@
+export interface Message {
+  _id?: string;
+  content?: string;
+  createdAt?: Date;
+}
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From 795f4d0eae1e42bedb8ffd1e40a14078f6b62999 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Wed, 5 Oct 2016 14:59:51 +0300
Subject: [PATCH 025/128] Step 2.12: Added chat model

---
 both/models/chat.model.ts | 8 ++++++++
 1 file changed, 8 insertions(+)
 create mode 100644 both/models/chat.model.ts

diff --git a/both/models/chat.model.ts b/both/models/chat.model.ts
new file mode 100644
index 0000000..36e42ca
--- /dev/null
+++ b/both/models/chat.model.ts
@@ -0,0 +1,8 @@
+import {Message} from "./message.model";
+
+export interface Chat {
+  _id?: string;
+  title?: string;
+  picture?: string;
+  lastMessage?: Message;
+}
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From 56a08584824cc37fcfdc235ab7a0d7e74414e330 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Wed, 5 Oct 2016 15:01:22 +0300
Subject: [PATCH 026/128] Step 2.13: Added moment

---
 package.json | 3 ++-
 typings.json | 3 ++-
 2 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/package.json b/package.json
index 3929642..9bb4313 100644
--- a/package.json
+++ b/package.json
@@ -39,10 +39,11 @@
     "angular2-meteor-polyfills": "0.1.1",
     "angular2-meteor-tests-polyfills": "0.0.2",
     "ionic-angular": "^2.0.0-rc.0",
-    "ionicons": "^3.0.0",
     "ionic-native": "^2.0.3",
+    "ionicons": "^3.0.0",
     "meteor-node-stubs": "0.2.3",
     "meteor-rxjs": "0.2.3",
+    "moment": "^2.15.1",
     "reflect-metadata": "0.1.8",
     "rxjs": "5.0.0-beta.12",
     "zone.js": "0.6.21"
diff --git a/typings.json b/typings.json
index 4a62321..d1f10e1 100644
--- a/typings.json
+++ b/typings.json
@@ -5,6 +5,7 @@
     "chai-spies": "registry:npm/chai-spies#0.7.1+20160614064916"
   },
   "globalDependencies": {
-    "meteor": "github:meteor-typings/meteor/1.3#955b89a4e2af892d1736bc570b490a97e860d5b7"
+    "meteor": "github:meteor-typings/meteor/1.3#955b89a4e2af892d1736bc570b490a97e860d5b7",
+    "moment": "registry:dt/moment#2.11.1+20160829143156"
   }
 }
-- 
2.9.3 (Apple Git-75)


From 1ed70fec78fd6da66ba68ff2dca43c51dd7febf5 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Wed, 5 Oct 2016 15:15:02 +0300
Subject: [PATCH 027/128] Step 2.14: Added list of stub chats

---
 client/imports/pages/chats/chats.component.ts | 53 ++++++++++++++++++++++++++-
 1 file changed, 52 insertions(+), 1 deletion(-)

diff --git a/client/imports/pages/chats/chats.component.ts b/client/imports/pages/chats/chats.component.ts
index b79d011..1d524c5 100644
--- a/client/imports/pages/chats/chats.component.ts
+++ b/client/imports/pages/chats/chats.component.ts
@@ -1,12 +1,63 @@
 import {Component} from "@angular/core";
 import template from "./chats.component.html"
+import {Observable} from "rxjs";
+import {Chat} from "../../../../both/models/chat.model";
+import * as moment from "moment";
 
 @Component({
   selector: "chats",
   template
 })
 export class ChatsComponent {
-  constructor() {
+  chats: Observable<Chat[]>;
 
+  constructor() {
+    this.chats = Observable.of([
+      {
+        _id: '0',
+        title: 'Ethan Gonzalez',
+        picture: 'https://randomuser.me/api/portraits/thumb/men/1.jpg',
+        lastMessage: {
+          content: 'You on your way?',
+          createdAt: moment().subtract(1, 'hours').toDate()
+        }
+      },
+      {
+        _id: '1',
+        title: 'Bryan Wallace',
+        picture: 'https://randomuser.me/api/portraits/thumb/lego/1.jpg',
+        lastMessage: {
+          content: 'Hey, it\'s me',
+          createdAt: moment().subtract(2, 'hours').toDate()
+        }
+      },
+      {
+        _id: '2',
+        title: 'Avery Stewart',
+        picture: 'https://randomuser.me/api/portraits/thumb/women/1.jpg',
+        lastMessage: {
+          content: 'I should buy a boat',
+          createdAt: moment().subtract(1, 'days').toDate()
+        }
+      },
+      {
+        _id: '3',
+        title: 'Katie Peterson',
+        picture: 'https://randomuser.me/api/portraits/thumb/women/2.jpg',
+        lastMessage: {
+          content: 'Look at my mukluks!',
+          createdAt: moment().subtract(4, 'days').toDate()
+        }
+      },
+      {
+        _id: '4',
+        title: 'Ray Edwards',
+        picture: 'https://randomuser.me/api/portraits/thumb/men/2.jpg',
+        lastMessage: {
+          content: 'This is wicked good ice cream.',
+          createdAt: moment().subtract(2, 'weeks').toDate()
+        }
+      }
+    ])
   }
 }
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From 4e75048e529c994448fd9e04ac8990c339f1d620 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Wed, 5 Oct 2016 15:18:22 +0300
Subject: [PATCH 028/128] Step 2.15: Added chats view layout

---
 client/imports/pages/chats/chats.component.html | 26 +++++++++++++++++++++----
 1 file changed, 22 insertions(+), 4 deletions(-)

diff --git a/client/imports/pages/chats/chats.component.html b/client/imports/pages/chats/chats.component.html
index 0c55ce6..54c523c 100644
--- a/client/imports/pages/chats/chats.component.html
+++ b/client/imports/pages/chats/chats.component.html
@@ -1,9 +1,27 @@
 <ion-header>
-  <ion-navbar>
+  <ion-navbar color="whatsapp">
     <ion-title>Chats</ion-title>
+
+    <ion-buttons end>
+      <button ion-button icon-only class="add-chat-button"><ion-icon name="person-add"></ion-icon></button>
+      <button ion-button icon-only class="options-button"><ion-icon name="more"></ion-icon></button>
+    </ion-buttons>
   </ion-navbar>
 </ion-header>
 
-<ion-content padding>
-  <h2>Welcome!</h2>
-</ion-content>
\ No newline at end of file
+<ion-content class="chats-page-content">
+  <ion-list class="chats">
+    <button ion-item *ngFor="let chat of chats | async" class="chat">
+      <img class="chat-picture" [src]="chat.picture">
+
+      <div class="chat-info">
+        <h2 class="chat-title">{{chat.title}}</h2>
+
+        <span *ngIf="chat.lastMessage" class="last-message">
+          <p class="last-message-content">{{chat.lastMessage.content}}</p>
+          <span class="last-message-timestamp">{{chat.lastMessage.createdAt}}</span>
+        </span>
+      </div>
+    </button>
+  </ion-list>
+</ion-content>
-- 
2.9.3 (Apple Git-75)


From cae2126bfa0ce04997a20fbfbe46fa71a3e782b6 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Wed, 5 Oct 2016 15:18:38 +0300
Subject: [PATCH 029/128] Step 2.16: Added some css styles to the chats list

---
 client/imports/pages/chats/chats.component.scss | 20 ++++++++++++++++++++
 1 file changed, 20 insertions(+)
 create mode 100644 client/imports/pages/chats/chats.component.scss

diff --git a/client/imports/pages/chats/chats.component.scss b/client/imports/pages/chats/chats.component.scss
new file mode 100644
index 0000000..6470e09
--- /dev/null
+++ b/client/imports/pages/chats/chats.component.scss
@@ -0,0 +1,20 @@
+.chats-page-content {
+  .chat-picture {
+    border-radius: 50%;
+    width: 50px;
+    float: left;
+  }
+
+  .chat-info {
+    float: left;
+    margin: 10px 0 0 20px;
+
+    .last-message-timestamp {
+      position: absolute;
+      top: 10px;
+      right: 10px;
+      font-size: 14px;
+      color: #9A9898;
+    }
+  }
+}
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From 025cb0e624ca47314a8342106c9f2906720b4889 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Wed, 5 Oct 2016 15:18:56 +0300
Subject: [PATCH 030/128] Step 2.17: Import the new styles into the Component

---
 client/imports/pages/chats/chats.component.ts | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/client/imports/pages/chats/chats.component.ts b/client/imports/pages/chats/chats.component.ts
index 1d524c5..815d4b6 100644
--- a/client/imports/pages/chats/chats.component.ts
+++ b/client/imports/pages/chats/chats.component.ts
@@ -3,10 +3,15 @@ import template from "./chats.component.html"
 import {Observable} from "rxjs";
 import {Chat} from "../../../../both/models/chat.model";
 import * as moment from "moment";
+import * as style from "./chats.component.scss";
+
 
 @Component({
   selector: "chats",
-  template
+  template,
+  styles: [
+    style.innerHTML
+  ]
 })
 export class ChatsComponent {
   chats: Observable<Chat[]>;
-- 
2.9.3 (Apple Git-75)


From 29b8e811704e5774052a81a2659614961322fcc4 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Wed, 5 Oct 2016 15:20:11 +0300
Subject: [PATCH 031/128] Step 2.18: Added angular moment package

---
 package.json | 1 +
 1 file changed, 1 insertion(+)

diff --git a/package.json b/package.json
index 9bb4313..3b77adf 100644
--- a/package.json
+++ b/package.json
@@ -38,6 +38,7 @@
     "angular2-meteor": "0.7.0",
     "angular2-meteor-polyfills": "0.1.1",
     "angular2-meteor-tests-polyfills": "0.0.2",
+    "angular2-moment": "^1.0.0-beta.3",
     "ionic-angular": "^2.0.0-rc.0",
     "ionic-native": "^2.0.3",
     "ionicons": "^3.0.0",
-- 
2.9.3 (Apple Git-75)


From a29f64263eb9debd9d593f72650e0e9c771bbd0a Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Wed, 5 Oct 2016 15:20:34 +0300
Subject: [PATCH 032/128] Step 2.19: Added MomentModule to the NgModule

---
 client/imports/app/app.module.ts | 4 +++-
 1 file changed, 3 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/app.module.ts b/client/imports/app/app.module.ts
index 91af1b1..b915e99 100644
--- a/client/imports/app/app.module.ts
+++ b/client/imports/app/app.module.ts
@@ -3,6 +3,7 @@ import { AppComponent } from './app.component';
 import { IonicApp, IonicModule } from "ionic-angular";
 import {TabsContainerComponent} from "../pages/tabs-container/tabs-container.component";
 import {ChatsComponent} from "../pages/chats/chats.component";
+import {MomentModule} from "angular2-moment";
 
 @NgModule({
   // Components, Pipes, Directive
@@ -23,7 +24,8 @@ import {ChatsComponent} from "../pages/chats/chats.component";
   ],
   // Modules
   imports: [
-    IonicModule.forRoot(AppComponent)
+    IonicModule.forRoot(AppComponent),
+    MomentModule
   ],
   // Main Component
   bootstrap: [ IonicApp ]
-- 
2.9.3 (Apple Git-75)


From a42691cf9f469815ba2161ef59193544a4e029e1 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Wed, 5 Oct 2016 15:21:04 +0300
Subject: [PATCH 033/128] Step 2.20: Use angular2-moment pipe

---
 client/imports/pages/chats/chats.component.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/imports/pages/chats/chats.component.html b/client/imports/pages/chats/chats.component.html
index 54c523c..a2878fb 100644
--- a/client/imports/pages/chats/chats.component.html
+++ b/client/imports/pages/chats/chats.component.html
@@ -19,7 +19,7 @@
 
         <span *ngIf="chat.lastMessage" class="last-message">
           <p class="last-message-content">{{chat.lastMessage.content}}</p>
-          <span class="last-message-timestamp">{{chat.lastMessage.createdAt}}</span>
+          <span class="last-message-timestamp">{{chat.lastMessage.createdAt | amCalendar}}</span>
         </span>
       </div>
     </button>
-- 
2.9.3 (Apple Git-75)


From f96f9e445a4ea116bc8f36e08fb956c837402958 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 20:50:52 +0200
Subject: [PATCH 034/128] Step 2.21: Add declaration for .scss files

---
 typings.d.ts | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/typings.d.ts b/typings.d.ts
index 1684801..b7c82f2 100644
--- a/typings.d.ts
+++ b/typings.d.ts
@@ -1,4 +1,8 @@
 declare module '*.html' {
   const template: string;
   export default template;
-}
\ No newline at end of file
+}
+
+declare module '*.scss' {
+  export const innerHTML: string;
+}
-- 
2.9.3 (Apple Git-75)


From 2653adcb3e638cc7115d9804730b4210aaf57118 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 14 Oct 2016 09:48:57 +0200
Subject: [PATCH 035/128] Step 2: Chats page

---
 steps/step2.md | 0
 1 file changed, 0 insertions(+), 0 deletions(-)
 create mode 100644 steps/step2.md

diff --git a/steps/step2.md b/steps/step2.md
new file mode 100644
index 0000000..e69de29
-- 
2.9.3 (Apple Git-75)


From 2a389c7ce5bf91335160c66594655cfac9f176e8 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Wed, 5 Oct 2016 15:23:19 +0300
Subject: [PATCH 036/128] Step 3.1: Add the Chats collection

---
 both/collections/chats.collection.ts | 4 ++++
 1 file changed, 4 insertions(+)
 create mode 100644 both/collections/chats.collection.ts

diff --git a/both/collections/chats.collection.ts b/both/collections/chats.collection.ts
new file mode 100644
index 0000000..0f46dc2
--- /dev/null
+++ b/both/collections/chats.collection.ts
@@ -0,0 +1,4 @@
+import {Chat} from "../models/chat.model";
+import {MongoObservable} from "meteor-rxjs";
+
+export const Chats = new MongoObservable.Collection<Chat>('chats');
-- 
2.9.3 (Apple Git-75)


From e22bbef02221adeb9b488cdf1319627d5afb13ef Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Wed, 5 Oct 2016 15:23:32 +0300
Subject: [PATCH 037/128] Step 3.2: Add the Messages collection

---
 both/collections/messages.collection.ts | 4 ++++
 1 file changed, 4 insertions(+)
 create mode 100644 both/collections/messages.collection.ts

diff --git a/both/collections/messages.collection.ts b/both/collections/messages.collection.ts
new file mode 100644
index 0000000..28e2eb6
--- /dev/null
+++ b/both/collections/messages.collection.ts
@@ -0,0 +1,4 @@
+import {MongoObservable} from "meteor-rxjs";
+import {Message} from "../models/message.model";
+
+export const Messages = new MongoObservable.Collection<Message>('messages');
-- 
2.9.3 (Apple Git-75)


From 88533aa86a57da635115fbc29f3277ddd9c414ac Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 6 Oct 2016 12:13:08 +0300
Subject: [PATCH 038/128] Step 3.3: Added the stub data to the server

---
 server/imports/server-main/main.ts | 61 ++++++++++++++++++++++++++++++++++++++
 1 file changed, 61 insertions(+)

diff --git a/server/imports/server-main/main.ts b/server/imports/server-main/main.ts
index ca6ff2f..e84b373 100644
--- a/server/imports/server-main/main.ts
+++ b/server/imports/server-main/main.ts
@@ -1,5 +1,66 @@
+import {Chats} from "../../../both/collections/chats.collection";
+import {Messages} from "../../../both/collections/messages.collection";
+import * as moment from "moment";
+
 export class Main {
   start(): void {
+    if (Chats.collection.find().count()) return;
+
+    let chatId;
+
+    chatId = Chats.collection.insert({
+      title: 'Ethan Gonzalez',
+      picture: 'https://randomuser.me/api/portraits/thumb/men/1.jpg'
+    });
+
+    Messages.collection.insert({
+      chatId: chatId,
+      content: 'You on your way?',
+      createdAt: moment().subtract(1, 'hours').toDate()
+    });
+
+    chatId = Chats.collection.insert({
+      title: 'Bryan Wallace',
+      picture: 'https://randomuser.me/api/portraits/thumb/lego/1.jpg'
+    });
+
+    Messages.collection.insert({
+      chatId: chatId,
+      content: 'Hey, it\'s me',
+      createdAt: moment().subtract(2, 'hours').toDate()
+    });
+
+    chatId = Chats.collection.insert({
+      title: 'Avery Stewart',
+      picture: 'https://randomuser.me/api/portraits/thumb/women/1.jpg'
+    });
+
+    Messages.collection.insert({
+      chatId: chatId,
+      content: 'I should buy a boat',
+      createdAt: moment().subtract(1, 'days').toDate()
+    });
+
+    chatId = Chats.collection.insert({
+      title: 'Katie Peterson',
+      picture: 'https://randomuser.me/api/portraits/thumb/women/2.jpg'
+    });
+
+    Messages.collection.insert({
+      chatId: chatId,
+      content: 'Look at my mukluks!',
+      createdAt: moment().subtract(4, 'days').toDate()
+    });
+
+    chatId = Chats.collection.insert({
+      title: 'Ray Edwards',
+      picture: 'https://randomuser.me/api/portraits/thumb/men/2.jpg'
+    });
 
+    Messages.collection.insert({
+      chatId: chatId,
+      content: 'This is wicked good ice cream.',
+      createdAt: moment().subtract(2, 'weeks').toDate()
+    });
   }
 }
-- 
2.9.3 (Apple Git-75)


From 542e43bd12e6cedd0bba6382c268fd0b006f069a Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 6 Oct 2016 12:13:24 +0300
Subject: [PATCH 039/128] Step 3.4: Add 'chatId' property to message model

---
 both/models/message.model.ts | 1 +
 1 file changed, 1 insertion(+)

diff --git a/both/models/message.model.ts b/both/models/message.model.ts
index 1165f7f..c30bc6f 100644
--- a/both/models/message.model.ts
+++ b/both/models/message.model.ts
@@ -1,5 +1,6 @@
 export interface Message {
   _id?: string;
+  chatId?: string;
   content?: string;
   createdAt?: Date;
 }
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From 997a937c901305824384a17e3b6f6300be9eeded Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 6 Oct 2016 14:07:34 +0300
Subject: [PATCH 040/128] Step 3.5: Added the chats with the last message using
 RxJS operators

---
 client/imports/pages/chats/chats.component.ts | 78 +++++++++------------------
 1 file changed, 26 insertions(+), 52 deletions(-)

diff --git a/client/imports/pages/chats/chats.component.ts b/client/imports/pages/chats/chats.component.ts
index 815d4b6..1ce9032 100644
--- a/client/imports/pages/chats/chats.component.ts
+++ b/client/imports/pages/chats/chats.component.ts
@@ -1,10 +1,11 @@
-import {Component} from "@angular/core";
+import {Component, OnInit} from "@angular/core";
 import template from "./chats.component.html"
 import {Observable} from "rxjs";
 import {Chat} from "../../../../both/models/chat.model";
-import * as moment from "moment";
 import * as style from "./chats.component.scss";
-
+import {Chats} from "../../../../both/collections/chats.collection";
+import {Message} from "../../../../both/models/message.model";
+import {Messages} from "../../../../both/collections/messages.collection";
 
 @Component({
   selector: "chats",
@@ -13,56 +14,29 @@ import * as style from "./chats.component.scss";
     style.innerHTML
   ]
 })
-export class ChatsComponent {
+export class ChatsComponent implements OnInit {
   chats: Observable<Chat[]>;
 
   constructor() {
-    this.chats = Observable.of([
-      {
-        _id: '0',
-        title: 'Ethan Gonzalez',
-        picture: 'https://randomuser.me/api/portraits/thumb/men/1.jpg',
-        lastMessage: {
-          content: 'You on your way?',
-          createdAt: moment().subtract(1, 'hours').toDate()
-        }
-      },
-      {
-        _id: '1',
-        title: 'Bryan Wallace',
-        picture: 'https://randomuser.me/api/portraits/thumb/lego/1.jpg',
-        lastMessage: {
-          content: 'Hey, it\'s me',
-          createdAt: moment().subtract(2, 'hours').toDate()
-        }
-      },
-      {
-        _id: '2',
-        title: 'Avery Stewart',
-        picture: 'https://randomuser.me/api/portraits/thumb/women/1.jpg',
-        lastMessage: {
-          content: 'I should buy a boat',
-          createdAt: moment().subtract(1, 'days').toDate()
-        }
-      },
-      {
-        _id: '3',
-        title: 'Katie Peterson',
-        picture: 'https://randomuser.me/api/portraits/thumb/women/2.jpg',
-        lastMessage: {
-          content: 'Look at my mukluks!',
-          createdAt: moment().subtract(4, 'days').toDate()
-        }
-      },
-      {
-        _id: '4',
-        title: 'Ray Edwards',
-        picture: 'https://randomuser.me/api/portraits/thumb/men/2.jpg',
-        lastMessage: {
-          content: 'This is wicked good ice cream.',
-          createdAt: moment().subtract(2, 'weeks').toDate()
-        }
-      }
-    ])
+
+  }
+
+  ngOnInit() {
+    this.chats = Chats
+      .find({})
+      .mergeMap<Chat[]>(chats =>
+        Observable.combineLatest(
+          ...chats.map(chat =>
+           
+            Messages.find({ chatId: chat._id }, { sort: { createdAt: -1 }, limit: 1 })
+              .startWith(null)
+              .map(messages => {
+                if (messages) chat.lastMessage = messages[0];
+                return chat;
+              })
+ 
+          )
+        )
+      ).zone();
   }
-}
\ No newline at end of file
+}
-- 
2.9.3 (Apple Git-75)


From 3c7bbe784586478ccb7acd285195e62c022400a1 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 14 Oct 2016 09:50:50 +0200
Subject: [PATCH 041/128] Step 3: Realtime Meteor server

---
 steps/step3.md | 0
 1 file changed, 0 insertions(+), 0 deletions(-)
 create mode 100644 steps/step3.md

diff --git a/steps/step3.md b/steps/step3.md
new file mode 100644
index 0000000..e69de29
-- 
2.9.3 (Apple Git-75)


From 0d70625fda585cf54e40b4cf779d5721c5c09a4d Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 6 Oct 2016 14:10:33 +0300
Subject: [PATCH 042/128] Step 4.1: Added showMessage method

---
 client/imports/pages/chats/chats.component.ts | 7 ++++++-
 1 file changed, 6 insertions(+), 1 deletion(-)

diff --git a/client/imports/pages/chats/chats.component.ts b/client/imports/pages/chats/chats.component.ts
index 1ce9032..984e9dc 100644
--- a/client/imports/pages/chats/chats.component.ts
+++ b/client/imports/pages/chats/chats.component.ts
@@ -6,6 +6,7 @@ import * as style from "./chats.component.scss";
 import {Chats} from "../../../../both/collections/chats.collection";
 import {Message} from "../../../../both/models/message.model";
 import {Messages} from "../../../../both/collections/messages.collection";
+import {NavController} from "ionic-angular";
 
 @Component({
   selector: "chats",
@@ -17,7 +18,7 @@ import {Messages} from "../../../../both/collections/messages.collection";
 export class ChatsComponent implements OnInit {
   chats: Observable<Chat[]>;
 
-  constructor() {
+  constructor(private navCtrl: NavController) {
 
   }
 
@@ -39,4 +40,8 @@ export class ChatsComponent implements OnInit {
         )
       ).zone();
   }
+
+  showMessages(chat): void {
+    this.navCtrl.push(MessagesPage, {chat});
+  }
 }
-- 
2.9.3 (Apple Git-75)


From bc321d44fe7da30ef0db03b491ac522bad0806e4 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 6 Oct 2016 14:10:54 +0300
Subject: [PATCH 043/128] Step 4.2: Added the action to the button

---
 client/imports/pages/chats/chats.component.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/imports/pages/chats/chats.component.html b/client/imports/pages/chats/chats.component.html
index a2878fb..e4df49a 100644
--- a/client/imports/pages/chats/chats.component.html
+++ b/client/imports/pages/chats/chats.component.html
@@ -11,7 +11,7 @@
 
 <ion-content class="chats-page-content">
   <ion-list class="chats">
-    <button ion-item *ngFor="let chat of chats | async" class="chat">
+    <button ion-item *ngFor="let chat of chats | async" class="chat" (click)="showMessages(chat)">
       <img class="chat-picture" [src]="chat.picture">
 
       <div class="chat-info">
-- 
2.9.3 (Apple Git-75)


From da4877472524512e74010f4b2ce3e6b8391f2202 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 6 Oct 2016 14:38:38 +0300
Subject: [PATCH 044/128] Step 4.3: Create a stub for the component

---
 .../imports/pages/chat/messages-page.component.ts   | 21 +++++++++++++++++++++
 1 file changed, 21 insertions(+)
 create mode 100644 client/imports/pages/chat/messages-page.component.ts

diff --git a/client/imports/pages/chat/messages-page.component.ts b/client/imports/pages/chat/messages-page.component.ts
new file mode 100644
index 0000000..5829e6f
--- /dev/null
+++ b/client/imports/pages/chat/messages-page.component.ts
@@ -0,0 +1,21 @@
+import {Component, OnInit} from "@angular/core";
+import {NavParams} from "ionic-angular";
+import {Chat} from "../../../../both/models/chat.model";
+
+@Component({
+  selector: "messages-page",
+  template: `Messages Page`
+})
+export class MessagesPage implements OnInit {
+  private selectedChat: Chat;
+
+  constructor(navParams: NavParams) {
+    this.selectedChat = <Chat>navParams.get('chat');
+
+    console.log("Selected chat is: ", this.selectedChat);
+  }
+
+  ngOnInit() {
+
+  }
+}
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From 506a7172e6b6ff20078343858a11824aa92fa393 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 6 Oct 2016 14:38:51 +0300
Subject: [PATCH 045/128] Step 4.4: Added the Component to the NgModule

---
 client/imports/app/app.module.ts | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/client/imports/app/app.module.ts b/client/imports/app/app.module.ts
index b915e99..2b2abe3 100644
--- a/client/imports/app/app.module.ts
+++ b/client/imports/app/app.module.ts
@@ -4,19 +4,22 @@ import { IonicApp, IonicModule } from "ionic-angular";
 import {TabsContainerComponent} from "../pages/tabs-container/tabs-container.component";
 import {ChatsComponent} from "../pages/chats/chats.component";
 import {MomentModule} from "angular2-moment";
+import {MessagesPage} from "../pages/chat/messages-page.component";
 
 @NgModule({
   // Components, Pipes, Directive
   declarations: [
     AppComponent,
     TabsContainerComponent,
-    ChatsComponent
+    ChatsComponent,
+    MessagesPage
   ],
   // Entry Components
   entryComponents: [
     AppComponent,
     TabsContainerComponent,
-    ChatsComponent
+    ChatsComponent,
+    MessagesPage
   ],
   // Providers
   providers: [
-- 
2.9.3 (Apple Git-75)


From 792d7238190a11609679d45ce1fabb4d1e1eb01a Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 6 Oct 2016 14:39:02 +0300
Subject: [PATCH 046/128] Step 4.5: Added the correct import

---
 client/imports/pages/chats/chats.component.ts | 1 +
 1 file changed, 1 insertion(+)

diff --git a/client/imports/pages/chats/chats.component.ts b/client/imports/pages/chats/chats.component.ts
index 984e9dc..7f538c0 100644
--- a/client/imports/pages/chats/chats.component.ts
+++ b/client/imports/pages/chats/chats.component.ts
@@ -7,6 +7,7 @@ import {Chats} from "../../../../both/collections/chats.collection";
 import {Message} from "../../../../both/models/message.model";
 import {Messages} from "../../../../both/collections/messages.collection";
 import {NavController} from "ionic-angular";
+import {MessagesPage} from "../chat/messages-page.component";
 
 @Component({
   selector: "chats",
-- 
2.9.3 (Apple Git-75)


From 7b9e1ec847cbbec034de7e7fa907527eab785f17 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 6 Oct 2016 14:49:46 +0300
Subject: [PATCH 047/128] Step 4.6: Add basic messages component

---
 .../imports/pages/chat/messages-page.component.ts  | 25 +++++++++++++++++++---
 1 file changed, 22 insertions(+), 3 deletions(-)

diff --git a/client/imports/pages/chat/messages-page.component.ts b/client/imports/pages/chat/messages-page.component.ts
index 5829e6f..1da077c 100644
--- a/client/imports/pages/chat/messages-page.component.ts
+++ b/client/imports/pages/chat/messages-page.component.ts
@@ -1,21 +1,40 @@
 import {Component, OnInit} from "@angular/core";
 import {NavParams} from "ionic-angular";
 import {Chat} from "../../../../both/models/chat.model";
+import {Messages} from "../../../../both/collections/messages.collection";
+import {Observable} from "rxjs";
+import {Message} from "../../../../both/models/message.model";
+import template from "./messages-page.component.html";
 
 @Component({
   selector: "messages-page",
-  template: `Messages Page`
+  template
 })
 export class MessagesPage implements OnInit {
   private selectedChat: Chat;
+  private title: string;
+  private picture: string;
+  private messages: Observable<Message[]>;
 
   constructor(navParams: NavParams) {
     this.selectedChat = <Chat>navParams.get('chat');
-
-    console.log("Selected chat is: ", this.selectedChat);
+    this.title = this.selectedChat.title;
+    this.picture = this.selectedChat.picture;
   }
 
   ngOnInit() {
+    let isEven = false;
+
+    this.messages = Messages.find(
+      {chatId: this.selectedChat._id},
+      {sort: {createdAt: 1}}
+    ).map((messages: Message[]) => {
+      messages.forEach((message: Message) => {
+        message.ownership = isEven ? 'mine' : 'other';
+        isEven = !isEven;
+      });
 
+      return messages;
+    });
   }
 }
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From a2edbc25843724bc0a4ccb22b03507e25c4c4629 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 6 Oct 2016 14:49:58 +0300
Subject: [PATCH 048/128] Step 4.7: Add 'ownership' property to message model

---
 both/models/message.model.ts | 1 +
 1 file changed, 1 insertion(+)

diff --git a/both/models/message.model.ts b/both/models/message.model.ts
index c30bc6f..d4b4f99 100644
--- a/both/models/message.model.ts
+++ b/both/models/message.model.ts
@@ -2,5 +2,6 @@ export interface Message {
   _id?: string;
   chatId?: string;
   content?: string;
+  ownership?: string;
   createdAt?: Date;
 }
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From f7a473611735435cc8daa2b7501a40d14ebf2614 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 6 Oct 2016 14:50:10 +0300
Subject: [PATCH 049/128] Step 4.8: Add basic messages view template

---
 .../pages/chat/messages-page.component.html        | 25 ++++++++++++++++++++++
 1 file changed, 25 insertions(+)
 create mode 100644 client/imports/pages/chat/messages-page.component.html

diff --git a/client/imports/pages/chat/messages-page.component.html b/client/imports/pages/chat/messages-page.component.html
new file mode 100644
index 0000000..0ecb9a5
--- /dev/null
+++ b/client/imports/pages/chat/messages-page.component.html
@@ -0,0 +1,25 @@
+<ion-header>
+  <ion-navbar color="whatsapp" class="messages-page-navbar">
+    <ion-buttons>
+      <img class="chat-picture" [src]="picture">
+    </ion-buttons>
+
+    <ion-title class="chat-title">{{title}}</ion-title>
+
+    <ion-buttons end>
+      <button ion-button icon-only class="attach-button"><ion-icon name="attach"></ion-icon></button>
+      <button ion-button icon-only class="settings-button"><ion-icon name="more"></ion-icon></button>
+    </ion-buttons>
+  </ion-navbar>
+</ion-header>
+
+<ion-content padding class="messages-page-content">
+  <ion-scroll scrollY="true" class="messages">
+    <div *ngFor="let message of messages | async" class="message-wrapper">
+      <div [class]="'message message-' + message.ownership">
+        <div class="message-content">{{message.content}}</div>
+        <span class="message-timestamp">{{message.createdAt}}</span>
+      </div>
+    </div>
+  </ion-scroll>
+</ion-content>
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From 82eae7bc99e42b69444146a3a6c3383ce80b6e65 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 6 Oct 2016 14:51:08 +0300
Subject: [PATCH 050/128] Step 4.9: Add basic messages stylesheet

---
 .../pages/chat/messages-page.component.scss        | 93 ++++++++++++++++++++++
 1 file changed, 93 insertions(+)
 create mode 100644 client/imports/pages/chat/messages-page.component.scss

diff --git a/client/imports/pages/chat/messages-page.component.scss b/client/imports/pages/chat/messages-page.component.scss
new file mode 100644
index 0000000..c30e573
--- /dev/null
+++ b/client/imports/pages/chat/messages-page.component.scss
@@ -0,0 +1,93 @@
+.messages-page-navbar {
+  .chat-picture {
+    width: 50px;
+    border-radius: 50%;
+    float: left;
+  }
+
+  .chat-title {
+    line-height: 50px;
+    float: left;
+  }
+}
+
+.messages-page-content {
+  > .scroll-content {
+    margin: 42px -15px 53px !important;
+  }
+
+  .messages {
+    height: 100%;
+    background-image: url(/assets/chat-background.jpg);
+    background-color: #E0DAD6;
+    background-repeat: no-repeat;
+    background-size: cover;
+  }
+
+  .message-wrapper {
+    margin-bottom: 9px;
+
+    &::after {
+      content: "";
+      display: table;
+      clear: both;
+    }
+  }
+
+  .message {
+    display: inline-block;
+    position: relative;
+    max-width: 236px;
+    border-radius: 7px;
+    box-shadow: 0 1px 2px rgba(0, 0, 0, .15);
+
+    &.message-mine {
+      float: right;
+      background-color: #DCF8C6;
+
+      &::before {
+        right: -11px;
+        background-image: url(/assets/message-mine.png)
+      }
+    }
+
+    &.message-other {
+      float: left;
+      background-color: #FFF;
+
+      &::before {
+        left: -11px;
+        background-image: url(/assets/message-other.png)
+      }
+    }
+
+    &.message-other::before, &.message-mine::before {
+      content: "";
+      position: absolute;
+      bottom: 3px;
+      width: 12px;
+      height: 19px;
+      background-position: 50% 50%;
+      background-repeat: no-repeat;
+      background-size: contain;
+    }
+
+    .message-content {
+      padding: 5px 7px;
+      word-wrap: break-word;
+
+      &::after {
+        content: " \00a0\00a0\00a0\00a0\00a0\00a0\00a0\00a0\00a0\00a0\00a0\00a0\00a0\00a0\00a0\00a0\00a0\00a0\00a0";
+        display: inline;
+      }
+    }
+
+    .message-timestamp {
+      position: absolute;
+      bottom: 2px;
+      right: 7px;
+      font-size: 12px;
+      color: gray;
+    }
+  }
+}
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From 81f5d84fcc195ddb2f32157461b762b4be26817c Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 6 Oct 2016 14:51:19 +0300
Subject: [PATCH 051/128] Step 4.10: Load the stylesheet into the Component

---
 client/imports/pages/chat/messages-page.component.ts | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/client/imports/pages/chat/messages-page.component.ts b/client/imports/pages/chat/messages-page.component.ts
index 1da077c..14fcf7e 100644
--- a/client/imports/pages/chat/messages-page.component.ts
+++ b/client/imports/pages/chat/messages-page.component.ts
@@ -5,10 +5,14 @@ import {Messages} from "../../../../both/collections/messages.collection";
 import {Observable} from "rxjs";
 import {Message} from "../../../../both/models/message.model";
 import template from "./messages-page.component.html";
+import * as style from "./messages-page.component.scss";
 
 @Component({
   selector: "messages-page",
-  template
+  template,
+  styles: [
+    style.innerHTML
+  ]
 })
 export class MessagesPage implements OnInit {
   private selectedChat: Chat;
-- 
2.9.3 (Apple Git-75)


From afc2faf5dc8c75f268b6feb1410f9c51ca317feb Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 6 Oct 2016 14:55:26 +0300
Subject: [PATCH 052/128] Step 4.11: Added missing assets

---
 public/assets/chat-background.jpg | Bin 0 -> 29275 bytes
 public/assets/message-mine.png    | Bin 0 -> 564 bytes
 public/assets/message-other.png   | Bin 0 -> 500 bytes
 3 files changed, 0 insertions(+), 0 deletions(-)
 create mode 100644 public/assets/chat-background.jpg
 create mode 100644 public/assets/message-mine.png
 create mode 100644 public/assets/message-other.png

diff --git a/public/assets/chat-background.jpg b/public/assets/chat-background.jpg
new file mode 100644
index 0000000000000000000000000000000000000000..12cf45ccbab1e100d50efcd26272036456dc90fe
GIT binary patch
literal 29275
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

literal 0
HcmV?d00001

diff --git a/public/assets/message-mine.png b/public/assets/message-mine.png
new file mode 100644
index 0000000000000000000000000000000000000000..a5503eb98d97eaef8d3d24fc6fcc43e6c52d4aff
GIT binary patch
literal 564
zcmV-40?Yl0P)<h;3K|Lk000e1NJLTq000;O001Tk1^@s6-UnMH0005|Nkl<ZcmciD
zPe{{Y9LMqZwzM=e45aBH2s}u18P&yOMMsaFIx0kTi>T<ZLj*x5E9j7@wM#S_(I2Ym
zHq%^gK3n0$_D?4?ESVddL`2x1pCI3Z$k6sYe&Ka}-hB8?WPT<7H(ORKKno^rM*?$Y
z_0wozO-F~b)q-vk=(%|Aum#;DaJsvz9k8MIc5uPXzH3K}F7Un`I%702Hv94d;4l_Y
zx!@h3&R8H>m{dT6vA|p<zUsbp<&XuPB(Nql^P(59>tC>Lb}1YH>Wu~FDzV>QfB$j7
zraK@KU&p<`E&~Bs@h703o|F|D10r3FrusbYW(&327!ZkX6GMRA!~!v$A9G7Yb3h~(
z-(Q!A=79LTH2GjKG`PpYHf<#!A3pXeKk5Q(+82mQ{8zddxvLi5wOQDLZ3RTO9Q%=4
zj^0l!PMnZMIu>jmQ#0w3x;m_e_gmPg)_};Aq7lHMdx6MS)OVoSNFY<1`tmCLxCdy`
z7RZ!TQRPAppZNQ`ola*fuotk`6i5{!xvBY)0pF<SZ0E7gHeer6U-d7&%1?1MS@@7r
zx!|LbnD4y%_NAl10ibEKN2>;=^W(4M3&DYK^34su^7VS2-#g{%a<v03@*p_=>wiRY
zIg$Ym0u8`!piUmsae<G|E(492y7iCcz~D7v@csc+7*{a0)2RCZ0000<MNUMnLSTY$
Cwg*`N

literal 0
HcmV?d00001

diff --git a/public/assets/message-other.png b/public/assets/message-other.png
new file mode 100644
index 0000000000000000000000000000000000000000..a9477becb1931badfe6fdf6e409f9cc60dbae35d
GIT binary patch
literal 500
zcmV<Q0So?#P)<h;3K|Lk000e1NJLTq000;O001Tk1^@s6-UnMH0000PbVXQnQ*UN;
zcVTj606}DLVr3vnZDD6+Qe|Oed2z{QJOBUzmPtfGRCwC7m%mEGP!xxIV@Whx&?STT
zXAlH+EDk<^E|ST)kU?<B>gp!=2o4T{3T_#E2p>R*!7kcC9HroprfH79Kq4{5rcLho
z;E)h<?{|}PbMJ{DqDG1kq9F@PI#wFYum~`Cja2}2Zb6G%FyI#O<{$`yc~*g<C~Mq;
zP3|0QXFrOckVO<l&y*ltfPPjegY;K~(I4iGQl9{V$LteG6`+q@${|&N(Lb;W(Efl5
zkRm|a7UGpffOZ0LPyZl8a6x0JB|w{VDxs19_s$}2Xac4dBy;_VCS+nkvc_B@LYjh7
z0j}?jMx!eneX2mA0Ow2S^bALjY9fkCM_hA%Z5lQBBS@;UFGQ22bcAH!`~EQ&t`Au|
zP*IYFX_~s{d1k-gze7GgtLC6=7R5<vT9&og?RJkKyAH$fP3knw%Mf#p<81YMy%Pv;
zQDnW0`!+<4ACNeIGqJSO>9lOy-Z2bgL)Z0nP1BZDRb9pTzRVp>q(X$+Znt&h?wzGB
qN*NA^r>p|kbr%HJPhiTo00RK`eVB$<^o=V30000<MNUMnLSTZ-*wiHe

literal 0
HcmV?d00001

-- 
2.9.3 (Apple Git-75)


From e0f39749f9d7879dc8304f49fb9f6582306d0287 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 6 Oct 2016 14:59:51 +0300
Subject: [PATCH 053/128] Step 4.12: Apply date format pipe to messages view
 template

---
 client/imports/pages/chat/messages-page.component.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/imports/pages/chat/messages-page.component.html b/client/imports/pages/chat/messages-page.component.html
index 0ecb9a5..0c435de 100644
--- a/client/imports/pages/chat/messages-page.component.html
+++ b/client/imports/pages/chat/messages-page.component.html
@@ -18,7 +18,7 @@
     <div *ngFor="let message of messages | async" class="message-wrapper">
       <div [class]="'message message-' + message.ownership">
         <div class="message-content">{{message.content}}</div>
-        <span class="message-timestamp">{{message.createdAt}}</span>
+        <span class="message-timestamp">{{message.createdAt | amDateFormat: 'HH:MM'}}</span>
       </div>
     </div>
   </ion-scroll>
-- 
2.9.3 (Apple Git-75)


From 611bd1e597ed6aca5db3b14a72fad440037cdbf6 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 6 Oct 2016 15:07:05 +0300
Subject: [PATCH 054/128] Step 4.13: Add message editor to messages view
 template

---
 client/imports/pages/chat/messages-page.component.html | 18 +++++++++++++++++-
 1 file changed, 17 insertions(+), 1 deletion(-)

diff --git a/client/imports/pages/chat/messages-page.component.html b/client/imports/pages/chat/messages-page.component.html
index 0c435de..9e6483e 100644
--- a/client/imports/pages/chat/messages-page.component.html
+++ b/client/imports/pages/chat/messages-page.component.html
@@ -22,4 +22,20 @@
       </div>
     </div>
   </ion-scroll>
-</ion-content>
\ No newline at end of file
+</ion-content>
+
+<ion-footer>
+  <ion-toolbar whatsapp class="messages-page-footer" position="bottom">
+    <ion-input [(ngModel)]="message" (keypress)="onInputKeypress($event)" class="message-editor" placeholder="Type a message"></ion-input>
+
+    <ion-buttons end>
+      <button ion-button icon-only *ngIf="message" class="message-editor-button" (click)="sendMessage()">
+        <ion-icon name="send"></ion-icon>
+      </button>
+
+      <button ion-button icon-only *ngIf="!message" class="message-editor-button">
+        <ion-icon name="mic"></ion-icon>
+      </button>
+    </ion-buttons>
+  </ion-toolbar>
+</ion-footer>
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From 7558f9001814c53c14ce5141c1a97534f7668d19 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 6 Oct 2016 15:07:20 +0300
Subject: [PATCH 055/128] Step 4.14: Add message-editor style to messages
 stylesheet

---
 .../imports/pages/chat/messages-page.component.scss   | 19 +++++++++++++++++++
 1 file changed, 19 insertions(+)

diff --git a/client/imports/pages/chat/messages-page.component.scss b/client/imports/pages/chat/messages-page.component.scss
index c30e573..cf66263 100644
--- a/client/imports/pages/chat/messages-page.component.scss
+++ b/client/imports/pages/chat/messages-page.component.scss
@@ -90,4 +90,23 @@
       color: gray;
     }
   }
+}
+
+.messages-page-footer {
+  padding-right: 0;
+
+  .message-editor {
+    margin-left: 2px;
+    padding-left: 5px;
+    background: white;
+    border-radius: 3px;
+  }
+
+  .message-editor-button {
+    box-shadow: none;
+    width: 50px;
+    height: 50px;
+    font-size: 17px;
+    margin: auto;
+  }
 }
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From 8917448d60fec0e2c3878c3c1a2f7b37e9ebc7f9 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 6 Oct 2016 15:07:42 +0300
Subject: [PATCH 056/128] Step 4.15: Add 'sendMessage()' handler to messages
 component

---
 client/imports/pages/chat/messages-page.component.ts | 14 ++++++++++++++
 1 file changed, 14 insertions(+)

diff --git a/client/imports/pages/chat/messages-page.component.ts b/client/imports/pages/chat/messages-page.component.ts
index 14fcf7e..f4fb96e 100644
--- a/client/imports/pages/chat/messages-page.component.ts
+++ b/client/imports/pages/chat/messages-page.component.ts
@@ -6,6 +6,7 @@ import {Observable} from "rxjs";
 import {Message} from "../../../../both/models/message.model";
 import template from "./messages-page.component.html";
 import * as style from "./messages-page.component.scss";
+import {MeteorObservable} from "meteor-rxjs";
 
 @Component({
   selector: "messages-page",
@@ -19,6 +20,7 @@ export class MessagesPage implements OnInit {
   private title: string;
   private picture: string;
   private messages: Observable<Message[]>;
+  private message = "";
 
   constructor(navParams: NavParams) {
     this.selectedChat = <Chat>navParams.get('chat');
@@ -41,4 +43,16 @@ export class MessagesPage implements OnInit {
       return messages;
     });
   }
+
+  onInputKeypress({keyCode}: KeyboardEvent): void {
+    if (keyCode == 13) {
+      this.sendMessage();
+    }
+  }
+
+  sendMessage(): void {
+    MeteorObservable.call('addMessage', this.selectedChat._id, this.message).zone().subscribe(() => {
+      this.message = '';
+    });
+  }
 }
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From 6723b70b69e335ae132d20b8be99f529364ebb0a Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 6 Oct 2016 15:09:18 +0300
Subject: [PATCH 057/128] Step 4.16: Add 'addMessage()' method to api

---
 server/imports/methods/methods.ts | 18 ++++++++++++++++++
 1 file changed, 18 insertions(+)
 create mode 100644 server/imports/methods/methods.ts

diff --git a/server/imports/methods/methods.ts b/server/imports/methods/methods.ts
new file mode 100644
index 0000000..0fce545
--- /dev/null
+++ b/server/imports/methods/methods.ts
@@ -0,0 +1,18 @@
+import {Meteor} from 'meteor/meteor';
+import {Chats} from "../../../both/collections/chats.collection";
+import {Messages} from "../../../both/collections/messages.collection";
+
+Meteor.methods({
+  addMessage(chatId: string, content: string): void {
+    const chatExists = !!Chats.collection.find(chatId).count();
+
+    if (!chatExists) throw new Meteor.Error('chat-not-exists',
+      'Chat doesn\'t exist');
+
+    Messages.collection.insert({
+      chatId: chatId,
+      content: content,
+      createdAt: new Date()
+    });
+  }
+});
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From 0b123194b5c1d512ba97a7860c0c8eed064c14f7 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 6 Oct 2016 15:09:45 +0300
Subject: [PATCH 058/128] Step 4.17: Added import for the methods file

---
 server/main.ts | 1 +
 1 file changed, 1 insertion(+)

diff --git a/server/main.ts b/server/main.ts
index de5d825..ea027c1 100644
--- a/server/main.ts
+++ b/server/main.ts
@@ -1,4 +1,5 @@
 import { Main } from './imports/server-main/main';
+import './imports/methods/methods';
 
 const mainInstance = new Main();
 mainInstance.start();
-- 
2.9.3 (Apple Git-75)


From c4c5a6edb3d71437200218f3db1c7078d796b24b Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 6 Oct 2016 15:10:47 +0300
Subject: [PATCH 059/128] Step 4.18: Add check

---
 .meteor/packages | 1 +
 1 file changed, 1 insertion(+)

diff --git a/.meteor/packages b/.meteor/packages
index c67b676..cc2a450 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -25,3 +25,4 @@ shell-server
 mys:fonts
 mobile-status-bar
 launch-screen
+check
-- 
2.9.3 (Apple Git-75)


From 47fb94d799e2a6bb65c0cf0ead359e6933427b65 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 6 Oct 2016 15:11:14 +0300
Subject: [PATCH 060/128] Step 4.19: Add validations to 'addMessage()' method
 in api

---
 server/imports/methods/methods.ts | 9 +++++++++
 1 file changed, 9 insertions(+)

diff --git a/server/imports/methods/methods.ts b/server/imports/methods/methods.ts
index 0fce545..89c378b 100644
--- a/server/imports/methods/methods.ts
+++ b/server/imports/methods/methods.ts
@@ -1,9 +1,18 @@
 import {Meteor} from 'meteor/meteor';
 import {Chats} from "../../../both/collections/chats.collection";
 import {Messages} from "../../../both/collections/messages.collection";
+import {check, Match} from 'meteor/check';
+
+const nonEmptyString = Match.Where((str) => {
+  check(str, String);
+  return str.length > 0;
+});
 
 Meteor.methods({
   addMessage(chatId: string, content: string): void {
+    check(chatId, nonEmptyString);
+    check(content, nonEmptyString);
+
     const chatExists = !!Chats.collection.find(chatId).count();
 
     if (!chatExists) throw new Meteor.Error('chat-not-exists',
-- 
2.9.3 (Apple Git-75)


From 4b3943454de4896079d6f7f948fc51ff2f9413a0 Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Thu, 6 Oct 2016 15:27:11 +0300
Subject: [PATCH 061/128] Step 4.20: Add an auto scroller to messages component

---
 .../imports/pages/chat/messages-page.component.ts  | 39 ++++++++++++++++++++--
 1 file changed, 36 insertions(+), 3 deletions(-)

diff --git a/client/imports/pages/chat/messages-page.component.ts b/client/imports/pages/chat/messages-page.component.ts
index f4fb96e..8afa0b3 100644
--- a/client/imports/pages/chat/messages-page.component.ts
+++ b/client/imports/pages/chat/messages-page.component.ts
@@ -1,8 +1,8 @@
-import {Component, OnInit} from "@angular/core";
+import {Component, OnInit, OnDestroy} from "@angular/core";
 import {NavParams} from "ionic-angular";
 import {Chat} from "../../../../both/models/chat.model";
 import {Messages} from "../../../../both/collections/messages.collection";
-import {Observable} from "rxjs";
+import {Observable, Subscription} from "rxjs";
 import {Message} from "../../../../both/models/message.model";
 import template from "./messages-page.component.html";
 import * as style from "./messages-page.component.scss";
@@ -15,12 +15,13 @@ import {MeteorObservable} from "meteor-rxjs";
     style.innerHTML
   ]
 })
-export class MessagesPage implements OnInit {
+export class MessagesPage implements OnInit, OnDestroy {
   private selectedChat: Chat;
   private title: string;
   private picture: string;
   private messages: Observable<Message[]>;
   private message = "";
+  private autoScroller: Subscription;
 
   constructor(navParams: NavParams) {
     this.selectedChat = <Chat>navParams.get('chat');
@@ -42,6 +43,38 @@ export class MessagesPage implements OnInit {
 
       return messages;
     });
+
+    this.autoScroller = MeteorObservable.autorun().subscribe(() => {
+      this.scroller.scrollTop = this.scroller.scrollHeight;
+      this.messageEditor.focus();
+    });
+  }
+
+  private get messagesPageContent(): Element {
+    return document.querySelector('.messages-page-content');
+  }
+
+  private get messagesPageFooter(): Element {
+    return document.querySelector('.messages-page-footer');
+  }
+
+  private get messagesList(): Element {
+    return this.messagesPageContent.querySelector('.messages');
+  }
+
+  private get messageEditor(): HTMLInputElement {
+    return <HTMLInputElement>this.messagesPageFooter.querySelector('.message-editor');
+  }
+
+  private get scroller(): Element {
+    return this.messagesList.querySelector('.scroll-content');
+  }
+
+  ngOnDestroy() {
+    if (this.autoScroller) {
+      this.autoScroller.unsubscribe();
+      this.autoScroller = undefined;
+    }
   }
 
   onInputKeypress({keyCode}: KeyboardEvent): void {
-- 
2.9.3 (Apple Git-75)


From 441500ef1239da88fdb79158e3c58634d32db94c Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 14 Oct 2016 09:53:34 +0200
Subject: [PATCH 062/128] Step 4: Messages page

---
 steps/step4.md | 0
 1 file changed, 0 insertions(+), 0 deletions(-)
 create mode 100644 steps/step4.md

diff --git a/steps/step4.md b/steps/step4.md
new file mode 100644
index 0000000..e69de29
-- 
2.9.3 (Apple Git-75)


From 0420a3f5f1b23055f03133f7001797148c49f65d Mon Sep 17 00:00:00 2001
From: Dotan Simha <dotansimha@gmail.com>
Date: Sat, 8 Oct 2016 11:23:08 +0200
Subject: [PATCH 063/128] Step 5.1: Added accounts packages

---
 .meteor/packages | 2 ++
 .meteor/versions | 7 +++++++
 2 files changed, 9 insertions(+)

diff --git a/.meteor/packages b/.meteor/packages
index cc2a450..75bf691 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -26,3 +26,5 @@ mys:fonts
 mobile-status-bar
 launch-screen
 check
+accounts-base
+mys:accounts-phone
diff --git a/.meteor/versions b/.meteor/versions
index 563029a..7042bef 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -1,3 +1,4 @@
+accounts-base@1.2.11
 allow-deny@1.0.5
 angular2-compilers@0.6.1
 autopublish@1.0.7
@@ -22,6 +23,7 @@ coffeescript@1.1.4
 ddp@1.2.5
 ddp-client@1.2.9
 ddp-common@1.2.6
+ddp-rate-limiter@1.0.5
 ddp-server@1.2.10
 deps@1.0.12
 diff-sequence@1.0.6
@@ -42,6 +44,7 @@ insecure@1.0.7
 jquery@1.11.9
 launch-screen@1.0.12
 livedata@1.0.18
+localstorage@1.0.11
 logging@1.1.15
 meteor@1.2.17
 meteor-base@1.0.4
@@ -64,10 +67,12 @@ practicalmeteor:mocha-core@1.0.1
 practicalmeteor:sinon@1.14.1_2
 promise@0.8.7
 random@1.0.10
+rate-limit@1.0.5
 reactive-var@1.0.10
 reload@1.1.10
 retry@1.0.8
 routepolicy@1.0.11
+service-configuration@1.0.10
 shell-server@0.2.1
 spacebars@1.0.13
 spacebars-compiler@1.0.13
@@ -84,3 +89,5 @@ url@1.0.10
 webapp@1.3.11
 webapp-hashing@1.0.9
 xolvio:cleaner@0.3.1
+mys:accounts-phone@0.0.21
+npm-bcrypt@0.9.1
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From 52feacb7a01f3fca8e33869ed416b7beab636d15 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Sun, 9 Oct 2016 13:13:10 +0200
Subject: [PATCH 064/128] Step 5.2: Add declarations

---
 typings.json | 1 +
 1 file changed, 1 insertion(+)

diff --git a/typings.json b/typings.json
index d1f10e1..d2599c3 100644
--- a/typings.json
+++ b/typings.json
@@ -6,6 +6,7 @@
   },
   "globalDependencies": {
     "meteor": "github:meteor-typings/meteor/1.3#955b89a4e2af892d1736bc570b490a97e860d5b7",
+    "meteor-accounts-phone": "registry:dt/meteor-accounts-phone#0.0.21+20160724055843",
     "moment": "registry:dt/moment#2.11.1+20160829143156"
   }
 }
-- 
2.9.3 (Apple Git-75)


From 78fd16a5363307cc8a7198afd784d05936d1c9cc Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Sun, 9 Oct 2016 13:17:57 +0200
Subject: [PATCH 065/128] Step 5.3: Add authentication settings

---
 private/settings.json | 8 ++++++++
 1 file changed, 8 insertions(+)
 create mode 100644 private/settings.json

diff --git a/private/settings.json b/private/settings.json
new file mode 100644
index 0000000..fde02be
--- /dev/null
+++ b/private/settings.json
@@ -0,0 +1,8 @@
+{
+  "accounts-phone": {
+    "verificationWaitTime": 0,
+    "verificationRetriesWaitTime": 0,
+    "adminPhoneNumbers": ["+9721234567", "+97212345678", "+97212345679"],
+    "phoneVerificationMasterCode": "1234"
+  }
+}
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From 9ec1e88ab575ae1095aa66db9f384467fffe13ef Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Sun, 9 Oct 2016 13:19:06 +0200
Subject: [PATCH 066/128] Step 5.4: Run the App with settings

---
 package.json | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/package.json b/package.json
index 3b77adf..87fb415 100644
--- a/package.json
+++ b/package.json
@@ -2,7 +2,7 @@
   "name": "angular2-meteor-base",
   "private": true,
   "scripts": {
-    "start": "meteor run",
+    "start": "meteor run --settings private/settings.json",
     "test": "meteor test --driver-package practicalmeteor:mocha",
     "test:ci": "meteor test --once --driver-package dispatch:mocha-phantomjs",
     "postinstall": "typings i",
-- 
2.9.3 (Apple Git-75)


From 7fe5124c547271d62c6d7c46139b83a0d5ec1402 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 11:48:35 +0200
Subject: [PATCH 067/128] Step 5.5: Define SMS settings

---
 server/imports/api/sms.ts | 8 ++++++++
 1 file changed, 8 insertions(+)
 create mode 100644 server/imports/api/sms.ts

diff --git a/server/imports/api/sms.ts b/server/imports/api/sms.ts
new file mode 100644
index 0000000..7885dd4
--- /dev/null
+++ b/server/imports/api/sms.ts
@@ -0,0 +1,8 @@
+import { Meteor } from 'meteor/meteor';
+import { Accounts } from 'meteor/accounts-base';
+ 
+ 
+if (Meteor.settings) {
+  Object.assign(Accounts._options, Meteor.settings['accounts-phone']);
+  SMS.twilio = Meteor.settings['twilio'];
+}
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From cfd135c5cea74c30823639a12e34c5b448f4454d Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 11:48:52 +0200
Subject: [PATCH 068/128] Step 5.6: Import those settings

---
 server/main.ts | 1 +
 1 file changed, 1 insertion(+)

diff --git a/server/main.ts b/server/main.ts
index ea027c1..33fe19a 100644
--- a/server/main.ts
+++ b/server/main.ts
@@ -1,5 +1,6 @@
 import { Main } from './imports/server-main/main';
 import './imports/methods/methods';
+import './imports/api/sms';
 
 const mainInstance = new Main();
 mainInstance.start();
-- 
2.9.3 (Apple Git-75)


From 4b75a42d004a106cf830b8b293d81a119c11d12f Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 13:05:03 +0200
Subject: [PATCH 069/128] Step 5.7: Wait for user if logging in

---
 client/main.ts | 11 ++++++++++-
 1 file changed, 10 insertions(+), 1 deletion(-)

diff --git a/client/main.ts b/client/main.ts
index 2b50651..abdadfa 100644
--- a/client/main.ts
+++ b/client/main.ts
@@ -3,10 +3,19 @@ import 'angular2-meteor-polyfills';
 import { platformBrowserDynamic } from '@angular/platform-browser-dynamic';
 import { enableProdMode } from '@angular/core';
 import { Meteor } from "meteor/meteor";
+import { MeteorObservable } from 'meteor-rxjs';
 import { AppModule } from './imports/app/app.module';
 
 enableProdMode();
 
 Meteor.startup(() => {
-   platformBrowserDynamic().bootstrapModule(AppModule);
+  const sub = MeteorObservable.autorun().subscribe(() => {
+    if (Meteor.loggingIn()) return;
+    
+    setTimeout(() => {
+      sub.unsubscribe();
+    });
+    
+    platformBrowserDynamic().bootstrapModule(AppModule);
+  });
 });
-- 
2.9.3 (Apple Git-75)


From f142146bc9cf029eaba4b236ba605f228de885af Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 13:05:50 +0200
Subject: [PATCH 070/128] Step 5.8: Use LoginComponent if user is not logged in

---
 client/imports/app/app.component.ts | 5 ++++-
 1 file changed, 4 insertions(+), 1 deletion(-)

diff --git a/client/imports/app/app.component.ts b/client/imports/app/app.component.ts
index 772cc90..21bea68 100644
--- a/client/imports/app/app.component.ts
+++ b/client/imports/app/app.component.ts
@@ -1,17 +1,20 @@
 import { Component } from '@angular/core';
 import { Platform } from "ionic-angular";
 import { StatusBar } from "ionic-native";
+import { Meteor } from 'meteor/meteor';
 import template from './app.component.html';
 import {TabsContainerComponent} from "../pages/tabs-container/tabs-container.component";
+import {LoginComponent} from '../pages/auth/login.component';
 
 @Component({
   selector: 'app',
   template
 })
 export class AppComponent {
-  rootPage = TabsContainerComponent;
+  rootPage: any;
 
   constructor(platform: Platform) {
+    this.rootPage = Meteor.user() ? TabsContainerComponent : LoginComponent;
     platform.ready().then(() => {
       // Okay, so the platform is ready and our plugins are available.
       // Here you can do any higher level native things you might need.
-- 
2.9.3 (Apple Git-75)


From ca9b0c4e2a61d43c09fba5eb72db5bcf63b55cde Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 13:06:19 +0200
Subject: [PATCH 071/128] Step 5.9: Create LoginComponent

---
 client/imports/pages/auth/login.component.ts | 74 ++++++++++++++++++++++++++++
 1 file changed, 74 insertions(+)
 create mode 100644 client/imports/pages/auth/login.component.ts

diff --git a/client/imports/pages/auth/login.component.ts b/client/imports/pages/auth/login.component.ts
new file mode 100644
index 0000000..20f0bf1
--- /dev/null
+++ b/client/imports/pages/auth/login.component.ts
@@ -0,0 +1,74 @@
+import { Component } from '@angular/core';
+import { NavController, AlertController } from 'ionic-angular';
+import { Accounts } from 'meteor/accounts-base';
+import { VerificationComponent } from './verification.component';
+import template from './login.component.html';
+import * as style from "./login.component.scss";
+ 
+@Component({
+  selector: 'login',
+  template,
+  styles: [
+    style.innerHTML
+  ]
+})
+export class LoginComponent {
+  phone = '';
+ 
+  constructor(
+    private navCtrl: NavController,
+    private alertCtrl: AlertController
+    ) {}
+ 
+  onInputKeypress({keyCode}: KeyboardEvent): void {
+    if (keyCode == 13) {
+      this.login();
+    }
+  }
+ 
+  login(): void {
+    const alert = this.alertCtrl.create({
+      title: 'Confirm',
+      message: `Would you like to proceed with the phone number ${this.phone}?`,
+      buttons: [
+        {
+          text: 'Cancel',
+          role: 'cancel'
+        },
+        {
+          text: 'Yes',
+          handler: () => {
+            this.handleLogin(alert);
+            return false;
+          }
+        }
+      ]
+    });
+ 
+    alert.present();
+  }
+ 
+  private handleLogin(alert): void {
+    Accounts.requestPhoneVerification(this.phone, (e: Error) => {
+      alert.dismiss().then(() => {
+        if (e) return this.handleError(e);
+ 
+        this.navCtrl.push(VerificationComponent, {
+          phone: this.phone
+        });
+      });
+    });
+  }
+ 
+  private handleError(e: Error): void {
+    console.error(e);
+ 
+    const alert = this.alertCtrl.create({
+      title: 'Oops!',
+      message: e.message,
+      buttons: ['OK']
+    });
+ 
+    alert.present();
+  }
+}
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From ecceb217e80e726f3f3f6d526f4378ba91d9aceb Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 13:06:39 +0200
Subject: [PATCH 072/128] Step 5.10: Add a template

---
 client/imports/pages/auth/login.component.html | 25 +++++++++++++++++++++++++
 1 file changed, 25 insertions(+)
 create mode 100644 client/imports/pages/auth/login.component.html

diff --git a/client/imports/pages/auth/login.component.html b/client/imports/pages/auth/login.component.html
new file mode 100644
index 0000000..f5b7823
--- /dev/null
+++ b/client/imports/pages/auth/login.component.html
@@ -0,0 +1,25 @@
+<ion-header>
+  <ion-navbar whatsapp>
+    <ion-title>Login</ion-title>
+ 
+    <ion-buttons end>
+      <button class="done-button" (click)="login()">Done</button>
+    </ion-buttons>
+  </ion-navbar>
+</ion-header>
+ 
+<ion-content padding class="login-page-content">
+  <div class="instructions">
+    <div>
+      Please enter your phone number including its country code.
+    </div>
+    <br>
+    <div>
+      The messenger will send a one time SMS message to verify your phone number. Carrier SMS charges may apply.
+    </div>
+  </div>
+ 
+  <ion-item>
+    <ion-input [(ngModel)]="phone" (keypress)="onInputKeypress($event)" type="tel" placeholder="Your phone number"></ion-input>
+  </ion-item>
+</ion-content>
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From 49c426f62fbdb527b611db41a097475c7ac0d29f Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 13:07:08 +0200
Subject: [PATCH 073/128] Step 5.11: Define styles

---
 client/imports/pages/auth/login.component.scss | 11 +++++++++++
 1 file changed, 11 insertions(+)
 create mode 100644 client/imports/pages/auth/login.component.scss

diff --git a/client/imports/pages/auth/login.component.scss b/client/imports/pages/auth/login.component.scss
new file mode 100644
index 0000000..ce2b50d
--- /dev/null
+++ b/client/imports/pages/auth/login.component.scss
@@ -0,0 +1,11 @@
+.login-page-content {
+  .instructions {
+    text-align: center;
+    font-size: medium;
+    margin: 50px;
+  }
+ 
+  .text-input {
+    text-align: center;
+  }
+}
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From 896e27412d89056b03d218791a1f4a5307241791 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 13:08:01 +0200
Subject: [PATCH 074/128] Step 5.12: Register LoginComponent in the AppModule

---
 client/imports/app/app.module.ts | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/client/imports/app/app.module.ts b/client/imports/app/app.module.ts
index 2b2abe3..977ace8 100644
--- a/client/imports/app/app.module.ts
+++ b/client/imports/app/app.module.ts
@@ -5,6 +5,7 @@ import {TabsContainerComponent} from "../pages/tabs-container/tabs-container.com
 import {ChatsComponent} from "../pages/chats/chats.component";
 import {MomentModule} from "angular2-moment";
 import {MessagesPage} from "../pages/chat/messages-page.component";
+import {LoginComponent} from '../pages/auth/login.component';
 
 @NgModule({
   // Components, Pipes, Directive
@@ -12,14 +13,16 @@ import {MessagesPage} from "../pages/chat/messages-page.component";
     AppComponent,
     TabsContainerComponent,
     ChatsComponent,
-    MessagesPage
+    MessagesPage,
+    LoginComponent
   ],
   // Entry Components
   entryComponents: [
     AppComponent,
     TabsContainerComponent,
     ChatsComponent,
-    MessagesPage
+    MessagesPage,
+    LoginComponent
   ],
   // Providers
   providers: [
-- 
2.9.3 (Apple Git-75)


From a926da986137f9828d20525eb96586b12dfd1532 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 13:08:28 +0200
Subject: [PATCH 075/128] Step 5.13: Add VerificationComponent

---
 .../imports/pages/auth/verification.component.ts   | 59 ++++++++++++++++++++++
 1 file changed, 59 insertions(+)
 create mode 100644 client/imports/pages/auth/verification.component.ts

diff --git a/client/imports/pages/auth/verification.component.ts b/client/imports/pages/auth/verification.component.ts
new file mode 100644
index 0000000..07455b8
--- /dev/null
+++ b/client/imports/pages/auth/verification.component.ts
@@ -0,0 +1,59 @@
+import {Component, OnInit, NgZone} from '@angular/core';
+import {NavController, NavParams, AlertController} from 'ionic-angular';
+import {Accounts} from 'meteor/accounts-base';
+import {ProfileComponent} from './profile.component';
+import template from './verification.component.html';
+import * as style from './verification.component.scss';
+ 
+ 
+@Component({
+  selector: 'verification',
+  template,
+  styles: [
+    style.innerHTML
+  ]
+})
+export class VerificationComponent implements OnInit {
+  code: string = '';
+  phone: string;
+ 
+  constructor(
+    private navCtrl: NavController,
+    private alertCtrl: AlertController, 
+    private zone: NgZone, 
+    private navParams: NavParams) {}
+  
+  ngOnInit() {
+    this.phone = this.navParams.get('phone');
+  }
+ 
+  onInputKeypress({keyCode}: KeyboardEvent): void {
+    if (keyCode == 13) {
+      this.verify();
+    }
+  }
+ 
+  verify(): void {
+    Accounts.verifyPhone(this.phone, this.code, (e: Error) => {
+      this.zone.run(() => {
+        if (e) return this.handleError(e);
+ 
+        this.navCtrl.setRoot(ProfileComponent, {}, {
+          animate: true
+        });
+      });
+    });
+  }
+ 
+  private handleError(e: Error): void {
+    console.error(e);
+ 
+    const alert = this.alertCtrl.create({
+      title: 'Oops!',
+      message: e.message,
+      buttons: ['OK']
+    });
+ 
+    alert.present();
+  }
+}
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From 87dc091dd8da489b414d1cb895c8f03589349dc9 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 13:08:47 +0200
Subject: [PATCH 076/128] Step 5.14: Create a template

---
 .../imports/pages/auth/verification.component.html | 25 ++++++++++++++++++++++
 1 file changed, 25 insertions(+)
 create mode 100644 client/imports/pages/auth/verification.component.html

diff --git a/client/imports/pages/auth/verification.component.html b/client/imports/pages/auth/verification.component.html
new file mode 100644
index 0000000..099ce79
--- /dev/null
+++ b/client/imports/pages/auth/verification.component.html
@@ -0,0 +1,25 @@
+<ion-header>
+  <ion-navbar whatsapp>
+    <ion-title>Verification</ion-title>
+ 
+    <ion-buttons end>
+      <button class="verify-button" (click)="verify()">Verify</button>
+    </ion-buttons>
+  </ion-navbar>
+</ion-header>
+ 
+<ion-content padding class="verification-page-content">
+  <div class="instructions">
+    <div>
+      An SMS message with the verification code has been sent to {{phone}}.
+    </div>
+    <br>
+    <div>
+      To proceed, please enter the 4-digit verification code below.
+    </div>
+  </div>
+ 
+  <ion-item>
+    <ion-input [(ngModel)]="code" (keypress)="onInputKeypress($event)" type="tel" placeholder="Your verification code"></ion-input>
+  </ion-item>
+</ion-content>
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From ade6c8f6dde5c04c90fe5e69f69330aa5293d6b7 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 13:09:04 +0200
Subject: [PATCH 077/128] Step 5.15: Define styles

---
 client/imports/pages/auth/verification.component.scss | 11 +++++++++++
 1 file changed, 11 insertions(+)
 create mode 100644 client/imports/pages/auth/verification.component.scss

diff --git a/client/imports/pages/auth/verification.component.scss b/client/imports/pages/auth/verification.component.scss
new file mode 100644
index 0000000..ea09ad1
--- /dev/null
+++ b/client/imports/pages/auth/verification.component.scss
@@ -0,0 +1,11 @@
+.verification-page-content {
+  .instructions {
+    text-align: center;
+    font-size: medium;
+    margin: 50px;
+  }
+ 
+  .text-input {
+    text-align: center;
+  }
+}
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From baf5dbd0069b070e8237a114bea20413f17643df Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 13:15:36 +0200
Subject: [PATCH 078/128] Step 5.16: Register VerificationComponent

---
 client/imports/app/app.module.ts | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/client/imports/app/app.module.ts b/client/imports/app/app.module.ts
index 977ace8..fda49c9 100644
--- a/client/imports/app/app.module.ts
+++ b/client/imports/app/app.module.ts
@@ -6,6 +6,7 @@ import {ChatsComponent} from "../pages/chats/chats.component";
 import {MomentModule} from "angular2-moment";
 import {MessagesPage} from "../pages/chat/messages-page.component";
 import {LoginComponent} from '../pages/auth/login.component';
+import {VerificationComponent} from '../pages/auth/verification.component';
 
 @NgModule({
   // Components, Pipes, Directive
@@ -14,7 +15,8 @@ import {LoginComponent} from '../pages/auth/login.component';
     TabsContainerComponent,
     ChatsComponent,
     MessagesPage,
-    LoginComponent
+    LoginComponent,
+    VerificationComponent
   ],
   // Entry Components
   entryComponents: [
@@ -22,7 +24,8 @@ import {LoginComponent} from '../pages/auth/login.component';
     TabsContainerComponent,
     ChatsComponent,
     MessagesPage,
-    LoginComponent
+    LoginComponent,
+    VerificationComponent
   ],
   // Providers
   providers: [
-- 
2.9.3 (Apple Git-75)


From 0806a5dfc27d13be41a95efcdb27bf7aed51e9f7 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 13:09:34 +0200
Subject: [PATCH 079/128] Step 5.17: Add 'updateProfile' method

---
 server/imports/methods/methods.ts | 14 ++++++++++++++
 1 file changed, 14 insertions(+)

diff --git a/server/imports/methods/methods.ts b/server/imports/methods/methods.ts
index 89c378b..3f6d2c2 100644
--- a/server/imports/methods/methods.ts
+++ b/server/imports/methods/methods.ts
@@ -2,6 +2,7 @@ import {Meteor} from 'meteor/meteor';
 import {Chats} from "../../../both/collections/chats.collection";
 import {Messages} from "../../../both/collections/messages.collection";
 import {check, Match} from 'meteor/check';
+import {Profile} from '../../../both/models/profile.model';
 
 const nonEmptyString = Match.Where((str) => {
   check(str, String);
@@ -9,6 +10,19 @@ const nonEmptyString = Match.Where((str) => {
 });
 
 Meteor.methods({
+  updateProfile(profile: Profile): void {
+    if (!this.userId) throw new Meteor.Error('unauthorized',
+      'User must be logged-in to create a new chat');
+ 
+    check(profile, {
+      name: nonEmptyString,
+      picture: nonEmptyString
+    });
+ 
+    Meteor.users.update(this.userId, {
+      $set: {profile}
+    });
+  },
   addMessage(chatId: string, content: string): void {
     check(chatId, nonEmptyString);
     check(content, nonEmptyString);
-- 
2.9.3 (Apple Git-75)


From b2f28e00dfc26cfaf8dd56e0eff3ed912b781726 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 13:09:54 +0200
Subject: [PATCH 080/128] Step 5.18: Define Profile model

---
 both/models/profile.model.ts | 4 ++++
 1 file changed, 4 insertions(+)
 create mode 100644 both/models/profile.model.ts

diff --git a/both/models/profile.model.ts b/both/models/profile.model.ts
new file mode 100644
index 0000000..dde3134
--- /dev/null
+++ b/both/models/profile.model.ts
@@ -0,0 +1,4 @@
+export interface Profile {
+  name?: string;
+  picture?: string;
+}
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From a133fcb57abcc1650285d7d7ba8ad7158d52c67c Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 13:10:19 +0200
Subject: [PATCH 081/128] Step 5.19: Create ProfileComponent

---
 client/imports/pages/auth/profile.component.ts | 55 ++++++++++++++++++++++++++
 1 file changed, 55 insertions(+)
 create mode 100644 client/imports/pages/auth/profile.component.ts

diff --git a/client/imports/pages/auth/profile.component.ts b/client/imports/pages/auth/profile.component.ts
new file mode 100644
index 0000000..ac09630
--- /dev/null
+++ b/client/imports/pages/auth/profile.component.ts
@@ -0,0 +1,55 @@
+import {Component, OnInit} from '@angular/core';
+import {NavController, AlertController} from 'ionic-angular';
+import {Meteor} from 'meteor/meteor';
+import {MeteorObservable} from 'meteor-rxjs';
+import {Profile} from '../../../../both/models/profile.model';
+import {TabsContainerComponent} from '../tabs-container/tabs-container.component';
+
+import template from './profile.component.html';
+import * as style from './profile.component.scss';
+ 
+@Component({
+  selector: 'profile',
+  template,
+  styles: [
+    style.innerHTML
+  ]
+})
+export class ProfileComponent implements OnInit {
+  profile: Profile;
+ 
+  constructor(
+    private navCtrl: NavController,
+    private alertCtrl: AlertController
+  ) {}
+
+  ngOnInit(): void {
+    this.profile = Meteor.user().profile || {
+      name: '',
+      picture: '/ionicons/svg/ios-contact.svg'
+    };
+  }
+ 
+  done(): void {
+    MeteorObservable.call('updateProfile', this.profile).subscribe({
+      next: () => {
+        this.navCtrl.push(TabsContainerComponent);
+      },
+      error(e: Error) {
+        this.handleError(e);
+      }
+    });
+  }
+ 
+  private handleError(e: Error): void {
+    console.error(e);
+ 
+    const alert = this.alertCtrl.create({
+      title: 'Oops!',
+      message: e.message,
+      buttons: ['OK']
+    });
+ 
+    alert.present();
+  }
+}
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From a8a758faa1dcf7eee5b3ed5c0d20271d17084f6e Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 13:10:54 +0200
Subject: [PATCH 082/128] Step 5.20: Create a template for ProfileComponent

---
 client/imports/pages/auth/profile.component.html | 21 +++++++++++++++++++++
 1 file changed, 21 insertions(+)
 create mode 100644 client/imports/pages/auth/profile.component.html

diff --git a/client/imports/pages/auth/profile.component.html b/client/imports/pages/auth/profile.component.html
new file mode 100644
index 0000000..013edbc
--- /dev/null
+++ b/client/imports/pages/auth/profile.component.html
@@ -0,0 +1,21 @@
+<ion-header>
+  <ion-navbar whatsapp>
+    <ion-title>Profile</ion-title>
+ 
+    <ion-buttons end>
+      <button class="done-button" (click)="done()">Done</button>
+    </ion-buttons>
+  </ion-navbar>
+</ion-header>
+ 
+<ion-content class="profile-page-content">
+  <div class="profile-picture">
+    <img [src]="profile.picture">
+    <ion-icon name="create"></ion-icon>
+  </div>
+ 
+  <ion-item class="profile-name">
+    <ion-label stacked>Name</ion-label>
+    <ion-input [(ngModel)]="profile.name" placeholder="Your name"></ion-input>
+  </ion-item>
+</ion-content>
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From 6f9e0d0f210a103d064e10d265fb2811e1f85f05 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 13:11:26 +0200
Subject: [PATCH 083/128] Step 5.21: Also the styles

---
 client/imports/pages/auth/profile.component.scss | 20 ++++++++++++++++++++
 1 file changed, 20 insertions(+)
 create mode 100644 client/imports/pages/auth/profile.component.scss

diff --git a/client/imports/pages/auth/profile.component.scss b/client/imports/pages/auth/profile.component.scss
new file mode 100644
index 0000000..e055000
--- /dev/null
+++ b/client/imports/pages/auth/profile.component.scss
@@ -0,0 +1,20 @@
+.profile-page-content {
+  .profile-picture {
+    max-width: 300px;
+    display: block;
+    margin: auto;
+ 
+    img {
+      margin-bottom: -33px;
+      width: 100%;
+    }
+ 
+    ion-icon {
+      float: right;
+      font-size: 30px;
+      opacity: 0.5;
+      border-left: black solid 1px;
+      padding-left: 5px;
+    }
+  }
+}
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From 680ab9689707451b24838805cd71582fae1f272d Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 13:18:00 +0200
Subject: [PATCH 084/128] Step 5.22: Register ProfileComponent

---
 client/imports/app/app.module.ts | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/client/imports/app/app.module.ts b/client/imports/app/app.module.ts
index fda49c9..6261397 100644
--- a/client/imports/app/app.module.ts
+++ b/client/imports/app/app.module.ts
@@ -7,6 +7,7 @@ import {MomentModule} from "angular2-moment";
 import {MessagesPage} from "../pages/chat/messages-page.component";
 import {LoginComponent} from '../pages/auth/login.component';
 import {VerificationComponent} from '../pages/auth/verification.component';
+import {ProfileComponent} from '../pages/auth/profile.component';
 
 @NgModule({
   // Components, Pipes, Directive
@@ -16,7 +17,8 @@ import {VerificationComponent} from '../pages/auth/verification.component';
     ChatsComponent,
     MessagesPage,
     LoginComponent,
-    VerificationComponent
+    VerificationComponent,
+    ProfileComponent
   ],
   // Entry Components
   entryComponents: [
@@ -25,7 +27,8 @@ import {VerificationComponent} from '../pages/auth/verification.component';
     ChatsComponent,
     MessagesPage,
     LoginComponent,
-    VerificationComponent
+    VerificationComponent,
+    ProfileComponent
   ],
   // Providers
   providers: [
-- 
2.9.3 (Apple Git-75)


From 68af028dba1f566880103e0f3311d6720c4d5146 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 13:20:00 +0200
Subject: [PATCH 085/128] Step 5.23: Add senderId property to addMessage method

---
 server/imports/methods/methods.ts | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/server/imports/methods/methods.ts b/server/imports/methods/methods.ts
index 3f6d2c2..1a75878 100644
--- a/server/imports/methods/methods.ts
+++ b/server/imports/methods/methods.ts
@@ -24,6 +24,9 @@ Meteor.methods({
     });
   },
   addMessage(chatId: string, content: string): void {
+    if (!this.userId) throw new Meteor.Error('unauthorized',
+      'User must be logged-in to create a new chat');
+
     check(chatId, nonEmptyString);
     check(content, nonEmptyString);
 
@@ -34,6 +37,7 @@ Meteor.methods({
 
     Messages.collection.insert({
       chatId: chatId,
+      senderId: this.userId,
       content: content,
       createdAt: new Date()
     });
-- 
2.9.3 (Apple Git-75)


From 2cc4ef51a9c3ee30e914f70c2378caba0cd007ba Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 13:20:31 +0200
Subject: [PATCH 086/128] Step 5.24: Add it also to the model

---
 both/models/message.model.ts | 1 +
 1 file changed, 1 insertion(+)

diff --git a/both/models/message.model.ts b/both/models/message.model.ts
index d4b4f99..fe99e76 100644
--- a/both/models/message.model.ts
+++ b/both/models/message.model.ts
@@ -1,6 +1,7 @@
 export interface Message {
   _id?: string;
   chatId?: string;
+  senderId?: string;
   content?: string;
   ownership?: string;
   createdAt?: Date;
-- 
2.9.3 (Apple Git-75)


From b67867added0eb4ad8fea9005db3d9466a78363f Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 13:26:21 +0200
Subject: [PATCH 087/128] Step 5.25: Determine message ownership based on
 sender id

---
 client/imports/pages/chat/messages-page.component.ts | 8 ++++----
 1 file changed, 4 insertions(+), 4 deletions(-)

diff --git a/client/imports/pages/chat/messages-page.component.ts b/client/imports/pages/chat/messages-page.component.ts
index 8afa0b3..062034a 100644
--- a/client/imports/pages/chat/messages-page.component.ts
+++ b/client/imports/pages/chat/messages-page.component.ts
@@ -1,5 +1,6 @@
 import {Component, OnInit, OnDestroy} from "@angular/core";
 import {NavParams} from "ionic-angular";
+import {Meteor} from 'meteor/meteor';
 import {Chat} from "../../../../both/models/chat.model";
 import {Messages} from "../../../../both/collections/messages.collection";
 import {Observable, Subscription} from "rxjs";
@@ -20,6 +21,7 @@ export class MessagesPage implements OnInit, OnDestroy {
   private title: string;
   private picture: string;
   private messages: Observable<Message[]>;
+  private senderId: string;
   private message = "";
   private autoScroller: Subscription;
 
@@ -27,18 +29,16 @@ export class MessagesPage implements OnInit, OnDestroy {
     this.selectedChat = <Chat>navParams.get('chat');
     this.title = this.selectedChat.title;
     this.picture = this.selectedChat.picture;
+    this.senderId = Meteor.userId();
   }
 
   ngOnInit() {
-    let isEven = false;
-
     this.messages = Messages.find(
       {chatId: this.selectedChat._id},
       {sort: {createdAt: 1}}
     ).map((messages: Message[]) => {
       messages.forEach((message: Message) => {
-        message.ownership = isEven ? 'mine' : 'other';
-        isEven = !isEven;
+        message.ownership = this.senderId == message.senderId ? 'mine' : 'other';
       });
 
       return messages;
-- 
2.9.3 (Apple Git-75)


From 5c0ef6aba02a4ef8b4837a43f66b3c12e2635f60 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 13:53:02 +0200
Subject: [PATCH 088/128] Step 5.26: Add options-popover to ChatsComponent

---
 client/imports/pages/chats/chats.component.ts | 18 ++++++++++++++----
 1 file changed, 14 insertions(+), 4 deletions(-)

diff --git a/client/imports/pages/chats/chats.component.ts b/client/imports/pages/chats/chats.component.ts
index 7f538c0..c6c6235 100644
--- a/client/imports/pages/chats/chats.component.ts
+++ b/client/imports/pages/chats/chats.component.ts
@@ -6,8 +6,9 @@ import * as style from "./chats.component.scss";
 import {Chats} from "../../../../both/collections/chats.collection";
 import {Message} from "../../../../both/models/message.model";
 import {Messages} from "../../../../both/collections/messages.collection";
-import {NavController} from "ionic-angular";
+import {NavController, PopoverController} from "ionic-angular";
 import {MessagesPage} from "../chat/messages-page.component";
+import {ChatsOptionsComponent} from '../chats/chats-options.component';
 
 @Component({
   selector: "chats",
@@ -19,9 +20,10 @@ import {MessagesPage} from "../chat/messages-page.component";
 export class ChatsComponent implements OnInit {
   chats: Observable<Chat[]>;
 
-  constructor(private navCtrl: NavController) {
-
-  }
+  constructor(
+    private navCtrl: NavController,
+    private popoverCtrl: PopoverController
+    ) {}
 
   ngOnInit() {
     this.chats = Chats
@@ -42,6 +44,14 @@ export class ChatsComponent implements OnInit {
       ).zone();
   }
 
+  showOptions(): void {
+    const popover = this.popoverCtrl.create(ChatsOptionsComponent, {}, {
+      cssClass: 'options-popover'
+    });
+ 
+    popover.present();
+  }
+
   showMessages(chat): void {
     this.navCtrl.push(MessagesPage, {chat});
   }
-- 
2.9.3 (Apple Git-75)


From 63a8cd0c7077776b3fa9b7c187309233676e8881 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 13:53:29 +0200
Subject: [PATCH 089/128] Step 5.27: Bind showOptions

---
 client/imports/pages/chats/chats.component.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/imports/pages/chats/chats.component.html b/client/imports/pages/chats/chats.component.html
index e4df49a..6b77651 100644
--- a/client/imports/pages/chats/chats.component.html
+++ b/client/imports/pages/chats/chats.component.html
@@ -4,7 +4,7 @@
 
     <ion-buttons end>
       <button ion-button icon-only class="add-chat-button"><ion-icon name="person-add"></ion-icon></button>
-      <button ion-button icon-only class="options-button"><ion-icon name="more"></ion-icon></button>
+      <button ion-button icon-only class="options-button" (click)="showOptions()"><ion-icon name="more"></ion-icon></button>
     </ion-buttons>
   </ion-navbar>
 </ion-header>
-- 
2.9.3 (Apple Git-75)


From c1b77f3da13100bc68c37f238b18959051d25817 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 13:53:59 +0200
Subject: [PATCH 090/128] Step 5.28: Add ChatsOptionsComponent

---
 .../imports/pages/chats/chats-options.component.ts | 76 ++++++++++++++++++++++
 1 file changed, 76 insertions(+)
 create mode 100644 client/imports/pages/chats/chats-options.component.ts

diff --git a/client/imports/pages/chats/chats-options.component.ts b/client/imports/pages/chats/chats-options.component.ts
new file mode 100644
index 0000000..bd4cd56
--- /dev/null
+++ b/client/imports/pages/chats/chats-options.component.ts
@@ -0,0 +1,76 @@
+import {Component} from '@angular/core';
+import {NavController, ViewController, AlertController} from 'ionic-angular';
+import {Meteor} from 'meteor/meteor';
+import {ProfileComponent} from '../auth/profile.component';
+import {LoginComponent} from '../auth/login.component';
+import template from './chats-options.component.html';
+import * as style from "./chats-options.component.scss";
+ 
+@Component({
+  selector: 'chats-options',
+  template,
+  styles: [
+    style.innerHTML
+  ]
+})
+export class ChatsOptionsComponent {
+  constructor(
+    private navCtrl: NavController, 
+    private viewCtrl: ViewController,
+    private alertCtrl: AlertController
+  ) {}
+ 
+  editProfile(): void {
+    this.viewCtrl.dismiss().then(() => {
+      this.navCtrl.push(ProfileComponent);
+    });
+  }
+ 
+  logout(): void {
+    const alert = this.alertCtrl.create({
+      title: 'Logout',
+      message: 'Are you sure you would like to proceed?',
+      buttons: [
+        {
+          text: 'Cancel',
+          role: 'cancel'
+        },
+        {
+          text: 'Yes',
+          handler: () => {
+            this.handleLogout(alert);
+            return false;
+          }
+        }
+      ]
+    });
+ 
+    this.viewCtrl.dismiss().then(() => {
+      alert.present();
+    });
+  }
+ 
+  private handleLogout(alert): void {
+    Meteor.logout((e: Error) => {
+      alert.dismiss().then(() => {
+        if (e) return this.handleError(e);
+ 
+        this.navCtrl.setRoot(LoginComponent, {}, {
+          animate: true
+        });
+      });
+    });
+  }
+ 
+  private handleError(e: Error): void {
+    console.error(e);
+ 
+    const alert = this.alertCtrl.create({
+      title: 'Oops!',
+      message: e.message,
+      buttons: ['OK']
+    });
+ 
+    alert.present();
+  }
+}
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From ecaedeec35a863a6ddb3e892d804cd581325fc22 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 13:54:21 +0200
Subject: [PATCH 091/128] Step 5.29: Add the template

---
 .../imports/pages/chats/chats-options.component.html   | 18 ++++++++++++++++++
 1 file changed, 18 insertions(+)
 create mode 100644 client/imports/pages/chats/chats-options.component.html

diff --git a/client/imports/pages/chats/chats-options.component.html b/client/imports/pages/chats/chats-options.component.html
new file mode 100644
index 0000000..9017eb9
--- /dev/null
+++ b/client/imports/pages/chats/chats-options.component.html
@@ -0,0 +1,18 @@
+<ion-content class="chats-options-page-content">
+  <ion-list class="options">
+    <button ion-item class="option option-profile" (click)="editProfile()">
+      <ion-icon name="contact" class="option-icon"></ion-icon>
+      <div class="option-name">Profile</div>
+    </button>
+ 
+    <button ion-item class="option option-about">
+      <ion-icon name="information-circle" class="option-icon"></ion-icon>
+      <div class="option-name">About</div>
+    </button>
+ 
+    <button ion-item class="option option-logout" (click)="logout()">
+      <ion-icon name="log-out" class="option-icon"></ion-icon>
+      <div class="option-name">Logout</div>
+    </button>
+  </ion-list>
+</ion-content>
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From 97b42a1fc7259b0cfb80fc1bc94d6d19f82cf62a Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 13:54:43 +0200
Subject: [PATCH 092/128] Step 5.30: Define styles

---
 client/imports/pages/chats/chats-options.component.scss | 13 +++++++++++++
 1 file changed, 13 insertions(+)
 create mode 100644 client/imports/pages/chats/chats-options.component.scss

diff --git a/client/imports/pages/chats/chats-options.component.scss b/client/imports/pages/chats/chats-options.component.scss
new file mode 100644
index 0000000..be30282
--- /dev/null
+++ b/client/imports/pages/chats/chats-options.component.scss
@@ -0,0 +1,13 @@
+.chats-options-page-content {
+  .options {
+    margin: 0;
+  }
+ 
+  .option-name {
+    float: left;
+  }
+ 
+  .option-icon {
+    float: right;
+  }
+}
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From fedb4d8826a70928d589a89e8c7e83d6ff3eae9e Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 13:55:02 +0200
Subject: [PATCH 093/128] Step 5.31: Register ChatsOptionsComponent

---
 client/imports/app/app.module.ts | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/client/imports/app/app.module.ts b/client/imports/app/app.module.ts
index 6261397..cfc710c 100644
--- a/client/imports/app/app.module.ts
+++ b/client/imports/app/app.module.ts
@@ -8,6 +8,7 @@ import {MessagesPage} from "../pages/chat/messages-page.component";
 import {LoginComponent} from '../pages/auth/login.component';
 import {VerificationComponent} from '../pages/auth/verification.component';
 import {ProfileComponent} from '../pages/auth/profile.component';
+import {ChatsOptionsComponent} from '../pages/chats/chats-options.component';
 
 @NgModule({
   // Components, Pipes, Directive
@@ -18,7 +19,8 @@ import {ProfileComponent} from '../pages/auth/profile.component';
     MessagesPage,
     LoginComponent,
     VerificationComponent,
-    ProfileComponent
+    ProfileComponent,
+    ChatsOptionsComponent
   ],
   // Entry Components
   entryComponents: [
@@ -28,7 +30,8 @@ import {ProfileComponent} from '../pages/auth/profile.component';
     MessagesPage,
     LoginComponent,
     VerificationComponent,
-    ProfileComponent
+    ProfileComponent,
+    ChatsOptionsComponent
   ],
   // Providers
   providers: [
-- 
2.9.3 (Apple Git-75)


From eb7be77c6816d30d10be742a584978d301743517 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 13:55:33 +0200
Subject: [PATCH 094/128] Step 5.32: Add options-popover style to chats
 stylesheet

---
 client/imports/pages/chats/chats.component.scss | 12 ++++++++++++
 1 file changed, 12 insertions(+)

diff --git a/client/imports/pages/chats/chats.component.scss b/client/imports/pages/chats/chats.component.scss
index 6470e09..227c12c 100644
--- a/client/imports/pages/chats/chats.component.scss
+++ b/client/imports/pages/chats/chats.component.scss
@@ -17,4 +17,16 @@
       color: #9A9898;
     }
   }
+}
+
+.options-popover {
+  $popover-width: 200px;
+  $popover-margin: 5px;
+ 
+  .popover-content {
+    width: $popover-width;
+    transform-origin: right top 0px !important;
+    left: calc(100% - #{$popover-width} - #{$popover-margin}) !important;
+    top: $popover-margin !important;
+  }
 }
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From 8fda05e490ca10fe2c994b5e3877aedaff39f1d8 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 14 Oct 2016 09:58:35 +0200
Subject: [PATCH 095/128] Step 5: Authentication

---
 steps/step5.md | 0
 1 file changed, 0 insertions(+), 0 deletions(-)
 create mode 100644 steps/step5.md

diff --git a/steps/step5.md b/steps/step5.md
new file mode 100644
index 0000000..e69de29
-- 
2.9.3 (Apple Git-75)


From aaf512e477013e4f4e948f49235ef094debe1094 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 17:21:31 +0200
Subject: [PATCH 096/128] Step 6.1: Add 'addChat' method to ChatsComponent

---
 client/imports/pages/chats/chats.component.ts | 11 +++++++++--
 1 file changed, 9 insertions(+), 2 deletions(-)

diff --git a/client/imports/pages/chats/chats.component.ts b/client/imports/pages/chats/chats.component.ts
index c6c6235..a8a8c5e 100644
--- a/client/imports/pages/chats/chats.component.ts
+++ b/client/imports/pages/chats/chats.component.ts
@@ -6,9 +6,10 @@ import * as style from "./chats.component.scss";
 import {Chats} from "../../../../both/collections/chats.collection";
 import {Message} from "../../../../both/models/message.model";
 import {Messages} from "../../../../both/collections/messages.collection";
-import {NavController, PopoverController} from "ionic-angular";
+import {NavController, PopoverController, ModalController} from "ionic-angular";
 import {MessagesPage} from "../chat/messages-page.component";
 import {ChatsOptionsComponent} from '../chats/chats-options.component';
+import {NewChatComponent} from './new-chat.component';
 
 @Component({
   selector: "chats",
@@ -22,7 +23,8 @@ export class ChatsComponent implements OnInit {
 
   constructor(
     private navCtrl: NavController,
-    private popoverCtrl: PopoverController
+    private popoverCtrl: PopoverController,
+    private modalCtrl: ModalController
     ) {}
 
   ngOnInit() {
@@ -44,6 +46,11 @@ export class ChatsComponent implements OnInit {
       ).zone();
   }
 
+  addChat(): void {
+    const modal = this.modalCtrl.create(NewChatComponent);
+    modal.present();
+  }
+
   showOptions(): void {
     const popover = this.popoverCtrl.create(ChatsOptionsComponent, {}, {
       cssClass: 'options-popover'
-- 
2.9.3 (Apple Git-75)


From e175ffd5cce9cfbecd5873f725397f29bdd3e298 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 17:21:49 +0200
Subject: [PATCH 097/128] Step 6.2: Bind that method

---
 client/imports/pages/chats/chats.component.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/imports/pages/chats/chats.component.html b/client/imports/pages/chats/chats.component.html
index 6b77651..ca566d2 100644
--- a/client/imports/pages/chats/chats.component.html
+++ b/client/imports/pages/chats/chats.component.html
@@ -3,7 +3,7 @@
     <ion-title>Chats</ion-title>
 
     <ion-buttons end>
-      <button ion-button icon-only class="add-chat-button"><ion-icon name="person-add"></ion-icon></button>
+      <button ion-button icon-only class="add-chat-button" (click)="addChat()"><ion-icon name="person-add"></ion-icon></button>
       <button ion-button icon-only class="options-button" (click)="showOptions()"><ion-icon name="more"></ion-icon></button>
     </ion-buttons>
   </ion-navbar>
-- 
2.9.3 (Apple Git-75)


From 063c8a20eb9fe04c348827cca8282729e1fef76e Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 17:22:27 +0200
Subject: [PATCH 098/128] Step 6.3: Define 'addChat' Method

---
 server/imports/methods/methods.ts | 22 ++++++++++++++++++++++
 1 file changed, 22 insertions(+)

diff --git a/server/imports/methods/methods.ts b/server/imports/methods/methods.ts
index 1a75878..601b7e8 100644
--- a/server/imports/methods/methods.ts
+++ b/server/imports/methods/methods.ts
@@ -23,6 +23,28 @@ Meteor.methods({
       $set: {profile}
     });
   },
+  addChat(receiverId: string): void {
+    if (!this.userId) throw new Meteor.Error('unauthorized',
+      'User must be logged-in to create a new chat');
+ 
+    check(receiverId, nonEmptyString);
+ 
+    if (receiverId == this.userId) throw new Meteor.Error('illegal-receiver',
+      'Receiver must be different than the current logged in user');
+ 
+    const chatExists = !!Chats.collection.find({
+      memberIds: {$all: [this.userId, receiverId]}
+    }).count();
+ 
+    if (chatExists) throw new Meteor.Error('chat-exists',
+      'Chat already exists');
+ 
+    const chat = {
+      memberIds: [this.userId, receiverId]
+    };
+ 
+    Chats.insert(chat);
+  },
   addMessage(chatId: string, content: string): void {
     if (!this.userId) throw new Meteor.Error('unauthorized',
       'User must be logged-in to create a new chat');
-- 
2.9.3 (Apple Git-75)


From 5470e94fd455252f72fbf103ac66f28e7a31791b Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 17:23:27 +0200
Subject: [PATCH 099/128] Step 6.4: Add memberIds prop in Chat model

---
 both/models/chat.model.ts | 1 +
 1 file changed, 1 insertion(+)

diff --git a/both/models/chat.model.ts b/both/models/chat.model.ts
index 36e42ca..c4981f4 100644
--- a/both/models/chat.model.ts
+++ b/both/models/chat.model.ts
@@ -2,6 +2,7 @@ import {Message} from "./message.model";
 
 export interface Chat {
   _id?: string;
+  memberIds?: string[];
   title?: string;
   picture?: string;
   lastMessage?: Message;
-- 
2.9.3 (Apple Git-75)


From c9aec979f4a7b92bb5caba8d3975ee91c59ae086 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 17:24:09 +0200
Subject: [PATCH 100/128] Step 6.5: Create Observable collection from
 Meteor.users

---
 both/collections/users.collection.ts | 5 +++++
 1 file changed, 5 insertions(+)
 create mode 100644 both/collections/users.collection.ts

diff --git a/both/collections/users.collection.ts b/both/collections/users.collection.ts
new file mode 100644
index 0000000..3da1168
--- /dev/null
+++ b/both/collections/users.collection.ts
@@ -0,0 +1,5 @@
+import {Meteor} from 'meteor/meteor';
+import {MongoObservable} from "meteor-rxjs";
+import {User} from "../models/user.model";
+
+export const Users = MongoObservable.fromExisting<User>(Meteor.users);
-- 
2.9.3 (Apple Git-75)


From 7abce83d3ed160dd8972aef95560f5f4141b74d4 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 17:24:33 +0200
Subject: [PATCH 101/128] Step 6.6: Create a User model

---
 both/models/user.model.ts | 7 +++++++
 1 file changed, 7 insertions(+)
 create mode 100644 both/models/user.model.ts

diff --git a/both/models/user.model.ts b/both/models/user.model.ts
new file mode 100644
index 0000000..b15b28a
--- /dev/null
+++ b/both/models/user.model.ts
@@ -0,0 +1,7 @@
+import { Meteor } from 'meteor/meteor';
+
+import { Profile } from '../models/profile.model';
+
+export interface User extends Meteor.User {
+  profile?: Profile;
+}
-- 
2.9.3 (Apple Git-75)


From db69dc97627e8c19d25faaf620ce851f0d03e27e Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 17:25:01 +0200
Subject: [PATCH 102/128] Step 6.7: Create NewChatComponent

---
 client/imports/pages/chats/new-chat.component.ts | 84 ++++++++++++++++++++++++
 1 file changed, 84 insertions(+)
 create mode 100644 client/imports/pages/chats/new-chat.component.ts

diff --git a/client/imports/pages/chats/new-chat.component.ts b/client/imports/pages/chats/new-chat.component.ts
new file mode 100644
index 0000000..83f1c7a
--- /dev/null
+++ b/client/imports/pages/chats/new-chat.component.ts
@@ -0,0 +1,84 @@
+import {Component, OnInit} from '@angular/core';
+import {MeteorObservable, ObservableCursor} from 'meteor-rxjs';
+import {NavController, ViewController, AlertController} from 'ionic-angular';
+import {Meteor} from 'meteor/meteor';
+import {Observable} from 'rxjs/Observable';
+import {Chats} from '../../../../both/collections/chats.collection';
+import {Users} from '../../../../both/collections/users.collection';
+import {User} from '../../../../both/models/user.model';
+import template from './new-chat.component.html';
+import * as style from "./new-chat.component.scss";
+import 'rxjs/add/operator/mergeMap';
+import 'rxjs/add/operator/startWith';
+ 
+@Component({
+  selector: 'new-chat',
+  template,
+  styles: [
+    style.innerHTML
+  ]
+})
+export class NewChatComponent implements OnInit {
+  users: Observable<User>;
+  private senderId: string;
+ 
+  constructor(
+    private navCtrl: NavController, 
+    private viewCtrl: ViewController,
+    private alertCtrl: AlertController
+  ) {
+    this.senderId = Meteor.userId();
+  }
+
+  ngOnInit() {
+    MeteorObservable.autorun().zone().subscribe(() => {
+      this.users = this.findUsers().zone();
+    });
+  }
+ 
+  addChat(user): void {
+    MeteorObservable.call('addChat', user._id).subscribe({
+      next: () => {
+        this.viewCtrl.dismiss();
+      },
+      error: (e: Error) => {
+        this.viewCtrl.dismiss().then(() => {
+          this.handleError(e)
+        });
+      }
+    });
+  }
+ 
+  private findUsers(): Observable<User> {
+    return Chats.find({
+        memberIds: this.senderId
+      }, {
+        fields: {
+          memberIds: 1
+        }
+      })
+        .startWith([]) // empty result
+        .mergeMap((chats) => {
+          const recieverIds = chats
+            .map(({memberIds}) => memberIds)
+            .reduce((result, memberIds) => result.concat(memberIds), [])
+            .concat(this.senderId);
+          
+          return Users.find({
+            _id: {$nin: recieverIds}
+          })
+        });
+  }
+ 
+  private handleError(e: Error): void {
+    console.error(e);
+ 
+    const alert = this.alertCtrl.create({
+      title: 'Oops!',
+      message: e.message,
+      buttons: ['OK']
+    });
+ 
+    alert.present();
+  }
+}
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From ebac87421f673e133b01539c5fc543219a9c2381 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 17:25:49 +0200
Subject: [PATCH 103/128] Step 6.8: Create also a template

---
 client/imports/pages/chats/new-chat.component.html | 18 ++++++++++++++++++
 1 file changed, 18 insertions(+)
 create mode 100644 client/imports/pages/chats/new-chat.component.html

diff --git a/client/imports/pages/chats/new-chat.component.html b/client/imports/pages/chats/new-chat.component.html
new file mode 100644
index 0000000..8d2238b
--- /dev/null
+++ b/client/imports/pages/chats/new-chat.component.html
@@ -0,0 +1,18 @@
+<ion-header>
+  <ion-toolbar whatsapp>
+    <ion-title>New Chat</ion-title>
+ 
+    <ion-buttons end>
+      <button class="dismiss-button" (click)="viewCtrl.dismiss()"><ion-icon name="close"></ion-icon></button>
+    </ion-buttons>
+  </ion-toolbar>
+</ion-header>
+ 
+<ion-content class="new-chat">
+  <ion-list class="users">
+    <button ion-item *ngFor="let user of users | async" class="user" (click)="addChat(user)">
+      <img class="user-picture" [src]="user.profile.picture">
+      <h2 class="user-name">{{user.profile.name}}</h2>
+    </button>
+  </ion-list>
+</ion-content>
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From 7f4a783a4180429bd2829c116fd5017bc213dddf Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 17:26:07 +0200
Subject: [PATCH 104/128] Step 6.9: Define some styles

---
 client/imports/pages/chats/new-chat.component.scss | 14 ++++++++++++++
 1 file changed, 14 insertions(+)
 create mode 100644 client/imports/pages/chats/new-chat.component.scss

diff --git a/client/imports/pages/chats/new-chat.component.scss b/client/imports/pages/chats/new-chat.component.scss
new file mode 100644
index 0000000..a0698d8
--- /dev/null
+++ b/client/imports/pages/chats/new-chat.component.scss
@@ -0,0 +1,14 @@
+.new-chat {
+  .user-picture {
+    border-radius: 50%;
+    width: 50px;
+    float: left;
+  }
+ 
+  .user-name {
+    margin-left: 20px;
+    margin-top: 25px;
+    transform: translate(0, -50%);
+    float: left;
+  }
+}
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From 89a55b4d582c0b412b805efbde998cf7c6a56844 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 17:26:29 +0200
Subject: [PATCH 105/128] Step 6.10: Register that component

---
 client/imports/app/app.module.ts | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/client/imports/app/app.module.ts b/client/imports/app/app.module.ts
index cfc710c..dd4b8d5 100644
--- a/client/imports/app/app.module.ts
+++ b/client/imports/app/app.module.ts
@@ -9,6 +9,7 @@ import {LoginComponent} from '../pages/auth/login.component';
 import {VerificationComponent} from '../pages/auth/verification.component';
 import {ProfileComponent} from '../pages/auth/profile.component';
 import {ChatsOptionsComponent} from '../pages/chats/chats-options.component';
+import {NewChatComponent} from '../pages/chats/new-chat.component';
 
 @NgModule({
   // Components, Pipes, Directive
@@ -20,7 +21,8 @@ import {ChatsOptionsComponent} from '../pages/chats/chats-options.component';
     LoginComponent,
     VerificationComponent,
     ProfileComponent,
-    ChatsOptionsComponent
+    ChatsOptionsComponent,
+    NewChatComponent
   ],
   // Entry Components
   entryComponents: [
@@ -31,7 +33,8 @@ import {ChatsOptionsComponent} from '../pages/chats/chats-options.component';
     LoginComponent,
     VerificationComponent,
     ProfileComponent,
-    ChatsOptionsComponent
+    ChatsOptionsComponent,
+    NewChatComponent
   ],
   // Providers
   providers: [
-- 
2.9.3 (Apple Git-75)


From 38348342ff92d0fe68aec79dfe1e05b30805be4f Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 17:27:19 +0200
Subject: [PATCH 106/128] Step 6.11: Replace chats fabrication with users
 fabrication

---
 server/imports/server-main/main.ts | 94 +++++++++++++++-----------------------
 1 file changed, 36 insertions(+), 58 deletions(-)

diff --git a/server/imports/server-main/main.ts b/server/imports/server-main/main.ts
index e84b373..2f61ab9 100644
--- a/server/imports/server-main/main.ts
+++ b/server/imports/server-main/main.ts
@@ -1,66 +1,44 @@
 import {Chats} from "../../../both/collections/chats.collection";
 import {Messages} from "../../../both/collections/messages.collection";
-import * as moment from "moment";
+import {Users} from '../../../both/collections/users.collection';
+import {Accounts} from 'meteor/accounts-base';
 
 export class Main {
   start(): void {
-    if (Chats.collection.find().count()) return;
-
-    let chatId;
-
-    chatId = Chats.collection.insert({
-      title: 'Ethan Gonzalez',
-      picture: 'https://randomuser.me/api/portraits/thumb/men/1.jpg'
-    });
-
-    Messages.collection.insert({
-      chatId: chatId,
-      content: 'You on your way?',
-      createdAt: moment().subtract(1, 'hours').toDate()
-    });
-
-    chatId = Chats.collection.insert({
-      title: 'Bryan Wallace',
-      picture: 'https://randomuser.me/api/portraits/thumb/lego/1.jpg'
-    });
-
-    Messages.collection.insert({
-      chatId: chatId,
-      content: 'Hey, it\'s me',
-      createdAt: moment().subtract(2, 'hours').toDate()
-    });
-
-    chatId = Chats.collection.insert({
-      title: 'Avery Stewart',
-      picture: 'https://randomuser.me/api/portraits/thumb/women/1.jpg'
-    });
-
-    Messages.collection.insert({
-      chatId: chatId,
-      content: 'I should buy a boat',
-      createdAt: moment().subtract(1, 'days').toDate()
-    });
-
-    chatId = Chats.collection.insert({
-      title: 'Katie Peterson',
-      picture: 'https://randomuser.me/api/portraits/thumb/women/2.jpg'
-    });
-
-    Messages.collection.insert({
-      chatId: chatId,
-      content: 'Look at my mukluks!',
-      createdAt: moment().subtract(4, 'days').toDate()
-    });
-
-    chatId = Chats.collection.insert({
-      title: 'Ray Edwards',
-      picture: 'https://randomuser.me/api/portraits/thumb/men/2.jpg'
-    });
-
-    Messages.collection.insert({
-      chatId: chatId,
-      content: 'This is wicked good ice cream.',
-      createdAt: moment().subtract(2, 'weeks').toDate()
+    if (Users.collection.find().count()) return;
+
+    [{
+      phone: '+972540000001',
+      profile: {
+        name: 'Ethan Gonzalez',
+        picture: 'https://randomuser.me/api/portraits/thumb/men/1.jpg'
+      }
+    }, {
+      phone: '+972540000002',
+      profile: {
+        name: 'Bryan Wallace',
+        picture: 'https://randomuser.me/api/portraits/thumb/lego/1.jpg'
+      }
+    }, {
+      phone: '+972540000003',
+      profile: {
+        name: 'Avery Stewart',
+        picture: 'https://randomuser.me/api/portraits/thumb/women/1.jpg'
+      }
+    }, {
+      phone: '+972540000004',
+      profile: {
+        name: 'Katie Peterson',
+        picture: 'https://randomuser.me/api/portraits/thumb/women/2.jpg'
+      }
+    }, {
+      phone: '+972540000005',
+      profile: {
+        name: 'Ray Edwards',
+        picture: 'https://randomuser.me/api/portraits/thumb/men/2.jpg'
+      }
+    }].forEach(user => {
+      Accounts.createUserWithPhone(user);
     });
   }
 }
-- 
2.9.3 (Apple Git-75)


From 42313cbf830a044b00703c00543bf9eedf5241c2 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 20:48:13 +0200
Subject: [PATCH 107/128] Step 6.12: Add title and picture to chat

---
 client/imports/pages/chats/chats.component.ts | 14 +++++++++++++-
 1 file changed, 13 insertions(+), 1 deletion(-)

diff --git a/client/imports/pages/chats/chats.component.ts b/client/imports/pages/chats/chats.component.ts
index a8a8c5e..6d4f05f 100644
--- a/client/imports/pages/chats/chats.component.ts
+++ b/client/imports/pages/chats/chats.component.ts
@@ -1,6 +1,7 @@
 import {Component, OnInit} from "@angular/core";
 import template from "./chats.component.html"
 import {Observable} from "rxjs";
+import {Meteor} from 'meteor/meteor';
 import {Chat} from "../../../../both/models/chat.model";
 import * as style from "./chats.component.scss";
 import {Chats} from "../../../../both/collections/chats.collection";
@@ -20,6 +21,7 @@ import {NewChatComponent} from './new-chat.component';
 })
 export class ChatsComponent implements OnInit {
   chats: Observable<Chat[]>;
+  senderId: string;
 
   constructor(
     private navCtrl: NavController,
@@ -28,6 +30,7 @@ export class ChatsComponent implements OnInit {
     ) {}
 
   ngOnInit() {
+    this.senderId = Meteor.userId();
     this.chats = Chats
       .find({})
       .mergeMap<Chat[]>(chats =>
@@ -43,7 +46,16 @@ export class ChatsComponent implements OnInit {
  
           )
         )
-      ).zone();
+      ).map(chats => {
+        chats.forEach(chat => {
+          const receiver = Meteor.users.findOne(chat.memberIds.find(memberId => memberId !== this.senderId))
+
+          chat.title = receiver.profile.name;
+          chat.picture = receiver.profile.picture;
+        });
+
+        return chats;
+      }).zone();
   }
 
   addChat(): void {
-- 
2.9.3 (Apple Git-75)


From 2f2b6ea340bf76410cb9b84a3232219e911e722c Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 14 Oct 2016 10:00:57 +0200
Subject: [PATCH 108/128] Step 6: Chats creation and removal

---
 steps/step6.md | 0
 1 file changed, 0 insertions(+), 0 deletions(-)
 create mode 100644 steps/step6.md

diff --git a/steps/step6.md b/steps/step6.md
new file mode 100644
index 0000000..e69de29
-- 
2.9.3 (Apple Git-75)


From b0ce88ec3c3024fa9fbce6f9adf781245e8d225e Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 21:48:02 +0200
Subject: [PATCH 109/128] Step 7.1: Remove 'insecure' package

---
 .meteor/packages | 1 -
 .meteor/versions | 8 +++++---
 2 files changed, 5 insertions(+), 4 deletions(-)

diff --git a/.meteor/packages b/.meteor/packages
index 75bf691..3f3aa96 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -15,7 +15,6 @@ standard-minifier-js@1.2.0    # JS minifier run for production mode
 es5-shim@4.6.14                # ECMAScript 5 compatibility for older browsers.
 
 autopublish@1.0.7             # Publish all data to the clients (for prototyping)
-insecure@1.0.7                # Allow all DB writes from clients (for prototyping)
 angular2-compilers
 practicalmeteor:mocha
 xolvio:cleaner
diff --git a/.meteor/versions b/.meteor/versions
index 7042bef..61b0ecf 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -32,6 +32,7 @@ dispatch:phantomjs-tests@0.0.5
 ecmascript@0.5.8
 ecmascript-runtime@0.3.14
 ejson@1.0.12
+email@1.0.16
 es5-shim@4.6.14
 geojson-utils@1.0.9
 hot-code-push@1.0.4
@@ -40,7 +41,6 @@ htmljs@1.0.11
 http@1.1.8
 hwillson:stub-collections@1.0.1
 id-map@1.0.8
-insecure@1.0.7
 jquery@1.11.9
 launch-screen@1.0.12
 livedata@1.0.18
@@ -56,7 +56,9 @@ modules@0.7.6
 modules-runtime@0.7.6
 mongo@1.1.12
 mongo-id@1.0.5
+mys:accounts-phone@0.0.21
 mys:fonts@0.0.2
+npm-bcrypt@0.9.1
 npm-mongo@1.5.49
 observe-sequence@1.0.12
 ordered-dict@1.0.8
@@ -73,9 +75,11 @@ reload@1.1.10
 retry@1.0.8
 routepolicy@1.0.11
 service-configuration@1.0.10
+sha@1.0.8
 shell-server@0.2.1
 spacebars@1.0.13
 spacebars-compiler@1.0.13
+srp@1.0.9
 standard-minifier-css@1.2.0
 standard-minifier-js@1.2.0
 templating@1.1.14
@@ -89,5 +93,3 @@ url@1.0.10
 webapp@1.3.11
 webapp-hashing@1.0.9
 xolvio:cleaner@0.3.1
-mys:accounts-phone@0.0.21
-npm-bcrypt@0.9.1
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From d99f48f6d011a848123b4ee25ad9a902f26efd3b Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 21:49:30 +0200
Subject: [PATCH 110/128] Step 7.2: Define 'removeChat' Method

---
 server/imports/methods/methods.ts | 14 ++++++++++++++
 1 file changed, 14 insertions(+)

diff --git a/server/imports/methods/methods.ts b/server/imports/methods/methods.ts
index 601b7e8..6a47ed3 100644
--- a/server/imports/methods/methods.ts
+++ b/server/imports/methods/methods.ts
@@ -45,6 +45,20 @@ Meteor.methods({
  
     Chats.insert(chat);
   },
+  removeChat(chatId: string): void {
+    if (!this.userId) throw new Meteor.Error('unauthorized',
+      'User must be logged-in to remove chat');
+ 
+    check(chatId, nonEmptyString);
+ 
+    const chatExists = !!Chats.collection.find(chatId).count();
+ 
+    if (!chatExists) throw new Meteor.Error('chat-not-exists',
+      'Chat doesn\'t exist');
+ 
+    Messages.remove({chatId});
+    Chats.remove(chatId);
+  },
   addMessage(chatId: string, content: string): void {
     if (!this.userId) throw new Meteor.Error('unauthorized',
       'User must be logged-in to create a new chat');
-- 
2.9.3 (Apple Git-75)


From b17fc823cf4798b4f17114b253638fc25ad7ca47 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 22:12:34 +0200
Subject: [PATCH 111/128] Step 7.3: Create MessagesOptionsComponent

---
 .../pages/chat/messages-options.component.ts       | 80 ++++++++++++++++++++++
 1 file changed, 80 insertions(+)
 create mode 100644 client/imports/pages/chat/messages-options.component.ts

diff --git a/client/imports/pages/chat/messages-options.component.ts b/client/imports/pages/chat/messages-options.component.ts
new file mode 100644
index 0000000..bcf3e7f
--- /dev/null
+++ b/client/imports/pages/chat/messages-options.component.ts
@@ -0,0 +1,80 @@
+import {Component} from '@angular/core';
+import {NavParams, NavController, ViewController, AlertController} from 'ionic-angular';
+import {Meteor} from 'meteor/meteor';
+import {MeteorObservable} from 'meteor-rxjs';
+import template from './messages-options.component.html';
+import * as style from "./messages-options.component.scss";
+import {TabsContainerComponent} from '../tabs-container/tabs-container.component';
+ 
+@Component({
+  selector: 'messages-options',
+  template,
+  styles: [
+    style.innerHTML
+  ]
+})
+export class MessagesOptionsComponent {
+  constructor(
+    private navCtrl: NavController, 
+    private viewCtrl: ViewController,
+    private alertCtrl: AlertController,
+    private params: NavParams
+  ) {}
+ 
+  remove(): void {
+    const alert = this.alertCtrl.create({
+      title: 'Remove',
+      message: 'Are you sure you would like to proceed?',
+      buttons: [
+        {
+          text: 'Cancel',
+          role: 'cancel'
+        },
+        {
+          text: 'Yes',
+          handler: () => {
+            this.handleRemove(alert);
+            return false;
+          }
+        }
+      ]
+    });
+ 
+    this.viewCtrl.dismiss().then(() => {
+      alert.present();
+    });
+  }
+ 
+  private handleRemove(alert): void {
+    MeteorObservable.call('removeChat', this.params.get('chat')._id).subscribe({
+      next: () => {
+        alert.dismiss().then(() => {
+          this.navCtrl.setRoot(TabsContainerComponent, {}, {
+            animate: true
+          });
+        });
+      },
+      error: (e: Error) => {
+        alert.dismiss().then(() => {
+          if (e) return this.handleError(e);
+  
+          this.navCtrl.setRoot(TabsContainerComponent, {}, {
+            animate: true
+          });
+        });
+      }
+    });
+  }
+ 
+  private handleError(e: Error): void {
+    console.error(e);
+ 
+    const alert = this.alertCtrl.create({
+      title: 'Oops!',
+      message: e.message,
+      buttons: ['OK']
+    });
+ 
+    alert.present();
+  }
+}
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From befc33fbfd1253a69bccdb61bec09923941f7b26 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 22:12:48 +0200
Subject: [PATCH 112/128] Step 7.4: Create a template

---
 client/imports/pages/chat/messages-options.component.html | 8 ++++++++
 1 file changed, 8 insertions(+)
 create mode 100644 client/imports/pages/chat/messages-options.component.html

diff --git a/client/imports/pages/chat/messages-options.component.html b/client/imports/pages/chat/messages-options.component.html
new file mode 100644
index 0000000..b5c4947
--- /dev/null
+++ b/client/imports/pages/chat/messages-options.component.html
@@ -0,0 +1,8 @@
+<ion-content class="chats-options-page-content">
+  <ion-list class="options">
+    <button ion-item class="option option-remove" (click)="remove()">
+      <ion-icon name="remove" class="option-icon"></ion-icon>
+      <div class="option-name">Remove</div>
+    </button>
+  </ion-list>
+</ion-content>
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From 726d42808f3f77031923f6d8a83754b5e7243bad Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 22:13:00 +0200
Subject: [PATCH 113/128] Step 7.5: Add styles

---
 client/imports/pages/chat/messages-options.component.scss | 13 +++++++++++++
 1 file changed, 13 insertions(+)
 create mode 100644 client/imports/pages/chat/messages-options.component.scss

diff --git a/client/imports/pages/chat/messages-options.component.scss b/client/imports/pages/chat/messages-options.component.scss
new file mode 100644
index 0000000..be30282
--- /dev/null
+++ b/client/imports/pages/chat/messages-options.component.scss
@@ -0,0 +1,13 @@
+.chats-options-page-content {
+  .options {
+    margin: 0;
+  }
+ 
+  .option-name {
+    float: left;
+  }
+ 
+  .option-icon {
+    float: right;
+  }
+}
\ No newline at end of file
-- 
2.9.3 (Apple Git-75)


From 7b433c4d605a4470e2cc39ebde476f788f605e6c Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 22:13:19 +0200
Subject: [PATCH 114/128] Step 7.6: Register the component

---
 client/imports/app/app.module.ts | 7 +++++--
 1 file changed, 5 insertions(+), 2 deletions(-)

diff --git a/client/imports/app/app.module.ts b/client/imports/app/app.module.ts
index dd4b8d5..adb48c5 100644
--- a/client/imports/app/app.module.ts
+++ b/client/imports/app/app.module.ts
@@ -10,6 +10,7 @@ import {VerificationComponent} from '../pages/auth/verification.component';
 import {ProfileComponent} from '../pages/auth/profile.component';
 import {ChatsOptionsComponent} from '../pages/chats/chats-options.component';
 import {NewChatComponent} from '../pages/chats/new-chat.component';
+import {MessagesOptionsComponent} from '../pages/chat/messages-options.component';
 
 @NgModule({
   // Components, Pipes, Directive
@@ -22,7 +23,8 @@ import {NewChatComponent} from '../pages/chats/new-chat.component';
     VerificationComponent,
     ProfileComponent,
     ChatsOptionsComponent,
-    NewChatComponent
+    NewChatComponent,
+    MessagesOptionsComponent
   ],
   // Entry Components
   entryComponents: [
@@ -34,7 +36,8 @@ import {NewChatComponent} from '../pages/chats/new-chat.component';
     VerificationComponent,
     ProfileComponent,
     ChatsOptionsComponent,
-    NewChatComponent
+    NewChatComponent,
+    MessagesOptionsComponent
   ],
   // Providers
   providers: [
-- 
2.9.3 (Apple Git-75)


From 08cf39eb23bfde8d5949335bfd171e0d8933db16 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 22:13:52 +0200
Subject: [PATCH 115/128] Step 7.7: Define component's method to open options

---
 client/imports/pages/chat/messages-page.component.ts | 18 ++++++++++++++++--
 1 file changed, 16 insertions(+), 2 deletions(-)

diff --git a/client/imports/pages/chat/messages-page.component.ts b/client/imports/pages/chat/messages-page.component.ts
index 062034a..5c5235f 100644
--- a/client/imports/pages/chat/messages-page.component.ts
+++ b/client/imports/pages/chat/messages-page.component.ts
@@ -1,5 +1,5 @@
 import {Component, OnInit, OnDestroy} from "@angular/core";
-import {NavParams} from "ionic-angular";
+import {NavParams, PopoverController} from "ionic-angular";
 import {Meteor} from 'meteor/meteor';
 import {Chat} from "../../../../both/models/chat.model";
 import {Messages} from "../../../../both/collections/messages.collection";
@@ -7,6 +7,7 @@ import {Observable, Subscription} from "rxjs";
 import {Message} from "../../../../both/models/message.model";
 import template from "./messages-page.component.html";
 import * as style from "./messages-page.component.scss";
+import {MessagesOptionsComponent} from './messages-options.component';
 import {MeteorObservable} from "meteor-rxjs";
 
 @Component({
@@ -25,7 +26,10 @@ export class MessagesPage implements OnInit, OnDestroy {
   private message = "";
   private autoScroller: Subscription;
 
-  constructor(navParams: NavParams) {
+  constructor(
+    navParams: NavParams,
+    private popoverCtrl: PopoverController
+  ) {
     this.selectedChat = <Chat>navParams.get('chat');
     this.title = this.selectedChat.title;
     this.picture = this.selectedChat.picture;
@@ -70,6 +74,16 @@ export class MessagesPage implements OnInit, OnDestroy {
     return this.messagesList.querySelector('.scroll-content');
   }
 
+  showOptions(): void {
+    const popover = this.popoverCtrl.create(MessagesOptionsComponent, {
+      chat: this.selectedChat
+    }, {
+      cssClass: 'options-popover'
+    });
+ 
+    popover.present();
+  }
+
   ngOnDestroy() {
     if (this.autoScroller) {
       this.autoScroller.unsubscribe();
-- 
2.9.3 (Apple Git-75)


From 10ce5832dd6bbcce5a283a3c6dcd6ff58ccc55db Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 22:14:04 +0200
Subject: [PATCH 116/128] Step 7.8: Implement it in the view

---
 client/imports/pages/chat/messages-page.component.html | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/client/imports/pages/chat/messages-page.component.html b/client/imports/pages/chat/messages-page.component.html
index 9e6483e..9f2d333 100644
--- a/client/imports/pages/chat/messages-page.component.html
+++ b/client/imports/pages/chat/messages-page.component.html
@@ -8,7 +8,7 @@
 
     <ion-buttons end>
       <button ion-button icon-only class="attach-button"><ion-icon name="attach"></ion-icon></button>
-      <button ion-button icon-only class="settings-button"><ion-icon name="more"></ion-icon></button>
+      <button ion-button icon-only class="settings-button" (click)="showOptions()"><ion-icon name="more"></ion-icon></button>
     </ion-buttons>
   </ion-navbar>
 </ion-header>
-- 
2.9.3 (Apple Git-75)


From 2833f144714643f6d2aa9d23aebd1b321c11428e Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 22:15:40 +0200
Subject: [PATCH 117/128] Step 7.9: Add 'autopublish' package

---
 .meteor/packages | 1 -
 .meteor/versions | 1 -
 2 files changed, 2 deletions(-)

diff --git a/.meteor/packages b/.meteor/packages
index 3f3aa96..42e095c 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -14,7 +14,6 @@ standard-minifier-css@1.2.0   # CSS minifier run for production mode
 standard-minifier-js@1.2.0    # JS minifier run for production mode
 es5-shim@4.6.14                # ECMAScript 5 compatibility for older browsers.
 
-autopublish@1.0.7             # Publish all data to the clients (for prototyping)
 angular2-compilers
 practicalmeteor:mocha
 xolvio:cleaner
diff --git a/.meteor/versions b/.meteor/versions
index 61b0ecf..08a195e 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -1,7 +1,6 @@
 accounts-base@1.2.11
 allow-deny@1.0.5
 angular2-compilers@0.6.1
-autopublish@1.0.7
 autoupdate@1.2.11
 babel-compiler@6.9.1
 babel-runtime@0.1.11
-- 
2.9.3 (Apple Git-75)


From 3522028bc97cb36e346caa3203f67f0c8d07f549 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 22:18:00 +0200
Subject: [PATCH 118/128] Step 7.10: Add 'reywood-publish-composite'

---
 .meteor/packages | 1 +
 .meteor/versions | 1 +
 2 files changed, 2 insertions(+)

diff --git a/.meteor/packages b/.meteor/packages
index 42e095c..f35a466 100644
--- a/.meteor/packages
+++ b/.meteor/packages
@@ -26,3 +26,4 @@ launch-screen
 check
 accounts-base
 mys:accounts-phone
+reywood:publish-composite
diff --git a/.meteor/versions b/.meteor/versions
index 08a195e..de8cf45 100644
--- a/.meteor/versions
+++ b/.meteor/versions
@@ -72,6 +72,7 @@ rate-limit@1.0.5
 reactive-var@1.0.10
 reload@1.1.10
 retry@1.0.8
+reywood:publish-composite@1.4.2
 routepolicy@1.0.11
 service-configuration@1.0.10
 sha@1.0.8
-- 
2.9.3 (Apple Git-75)


From 108d5e55af6b35276725fef2814eade49dff7fbd Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 22:19:32 +0200
Subject: [PATCH 119/128] Step 7.11: Add typings for that package

---
 typings.json | 1 +
 1 file changed, 1 insertion(+)

diff --git a/typings.json b/typings.json
index d2599c3..0e36153 100644
--- a/typings.json
+++ b/typings.json
@@ -7,6 +7,7 @@
   "globalDependencies": {
     "meteor": "github:meteor-typings/meteor/1.3#955b89a4e2af892d1736bc570b490a97e860d5b7",
     "meteor-accounts-phone": "registry:dt/meteor-accounts-phone#0.0.21+20160724055843",
+    "meteor-publish-composite": "registry:dt/meteor-publish-composite#0.0.0+20160724055739",
     "moment": "registry:dt/moment#2.11.1+20160829143156"
   }
 }
-- 
2.9.3 (Apple Git-75)


From d270e5a4f7b07eb3f0a838efe8017c70e8cc83b0 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 22:22:12 +0200
Subject: [PATCH 120/128] Step 7.12: Create publication for Users

---
 server/imports/publications/users.publication.ts | 15 +++++++++++++++
 1 file changed, 15 insertions(+)
 create mode 100644 server/imports/publications/users.publication.ts

diff --git a/server/imports/publications/users.publication.ts b/server/imports/publications/users.publication.ts
new file mode 100644
index 0000000..dd48870
--- /dev/null
+++ b/server/imports/publications/users.publication.ts
@@ -0,0 +1,15 @@
+import { Meteor } from 'meteor/meteor';
+import { Mongo } from 'meteor/mongo';
+
+import { Users } from '../../../both/collections/users.collection';
+import { User } from '../../../both/models/user.model';
+
+Meteor.publish('users', function(): Mongo.Cursor<User> {
+  if (!this.userId) return;
+ 
+  return Users.collection.find({}, {
+    fields: {
+      profile: 1
+    }
+  });
+});
-- 
2.9.3 (Apple Git-75)


From e159f5ec7072c555c5c55a9aa44d39a2dc9c4335 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 22:25:41 +0200
Subject: [PATCH 121/128] Step 7.13: Add publication for Chats

---
 server/imports/publications/chats.publication.ts | 38 ++++++++++++++++++++++++
 1 file changed, 38 insertions(+)
 create mode 100644 server/imports/publications/chats.publication.ts

diff --git a/server/imports/publications/chats.publication.ts b/server/imports/publications/chats.publication.ts
new file mode 100644
index 0000000..a440ac2
--- /dev/null
+++ b/server/imports/publications/chats.publication.ts
@@ -0,0 +1,38 @@
+import { Meteor } from 'meteor/meteor';
+
+import { Chats } from '../../../both/collections/chats.collection';
+import { Chat } from '../../../both/models/chat.model';
+import { Messages } from '../../../both/collections/messages.collection';
+import { Message } from '../../../both/models/message.model';
+import { Users } from '../../../both/collections/users.collection';
+import { User } from '../../../both/models/user.model';
+
+Meteor.publishComposite('chats', function(): PublishCompositeConfig<Chat> {
+  if (!this.userId) return;
+ 
+  return {
+    find: () => {
+      return Chats.collection.find({memberIds: this.userId});
+    },
+ 
+    children: [
+      <PublishCompositeConfig1<Chat, Message>> {
+        find: (chat) => {
+          return Messages.collection.find({chatId: chat._id}, {
+            sort: {createdAt: -1},
+            limit: 1
+          });
+        }
+      },
+      <PublishCompositeConfig1<Chat, User>> {
+        find: (chat) => {
+          return Users.collection.find({
+            _id: {$in: chat.memberIds}
+          }, {
+            fields: {profile: 1}
+          });
+        }
+      }
+    ]
+  };
+});
-- 
2.9.3 (Apple Git-75)


From 144c74fda559c0a1c8c42e0763b85dc00ad3889e Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 22:26:52 +0200
Subject: [PATCH 122/128] Step 7.14: Add publication for Messages

---
 server/imports/publications/messages.publication.ts | 12 ++++++++++++
 1 file changed, 12 insertions(+)
 create mode 100644 server/imports/publications/messages.publication.ts

diff --git a/server/imports/publications/messages.publication.ts b/server/imports/publications/messages.publication.ts
new file mode 100644
index 0000000..1a50b55
--- /dev/null
+++ b/server/imports/publications/messages.publication.ts
@@ -0,0 +1,12 @@
+import { Meteor } from 'meteor/meteor';
+import { Mongo } from 'meteor/mongo';
+
+import { Messages } from '../../../both/collections/messages.collection';
+import { Message } from '../../../both/models/message.model';
+
+Meteor.publish('messages', function(chatId: string): Mongo.Cursor<Message> {
+  if (!this.userId) return;
+  if (!chatId) return;
+ 
+  return Messages.collection.find({chatId});
+});
-- 
2.9.3 (Apple Git-75)


From a156ceb156e2c133494ce6ce0a85941ff6676ad0 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Mon, 10 Oct 2016 22:27:48 +0200
Subject: [PATCH 123/128] Step 7.15: Expose publications

---
 server/main.ts | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/server/main.ts b/server/main.ts
index 33fe19a..1ca747b 100644
--- a/server/main.ts
+++ b/server/main.ts
@@ -1,5 +1,8 @@
 import { Main } from './imports/server-main/main';
 import './imports/methods/methods';
+import './imports/publications/chats.publication';
+import './imports/publications/messages.publication';
+import './imports/publications/users.publication';
 import './imports/api/sms';
 
 const mainInstance = new Main();
-- 
2.9.3 (Apple Git-75)


From fabb0e3027bad0cff4a076ac852613ed793d645a Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Tue, 11 Oct 2016 10:13:05 +0200
Subject: [PATCH 124/128] Step 7.16: Subscribe to 'chats'

---
 client/imports/pages/chats/chats.component.ts | 52 +++++++++++++++------------
 1 file changed, 29 insertions(+), 23 deletions(-)

diff --git a/client/imports/pages/chats/chats.component.ts b/client/imports/pages/chats/chats.component.ts
index 6d4f05f..4f97544 100644
--- a/client/imports/pages/chats/chats.component.ts
+++ b/client/imports/pages/chats/chats.component.ts
@@ -2,6 +2,7 @@ import {Component, OnInit} from "@angular/core";
 import template from "./chats.component.html"
 import {Observable} from "rxjs";
 import {Meteor} from 'meteor/meteor';
+import {MeteorObservable} from 'meteor-rxjs';
 import {Chat} from "../../../../both/models/chat.model";
 import * as style from "./chats.component.scss";
 import {Chats} from "../../../../both/collections/chats.collection";
@@ -31,31 +32,36 @@ export class ChatsComponent implements OnInit {
 
   ngOnInit() {
     this.senderId = Meteor.userId();
-    this.chats = Chats
-      .find({})
-      .mergeMap<Chat[]>(chats =>
-        Observable.combineLatest(
-          ...chats.map(chat =>
-           
-            Messages.find({ chatId: chat._id }, { sort: { createdAt: -1 }, limit: 1 })
-              .startWith(null)
-              .map(messages => {
-                if (messages) chat.lastMessage = messages[0];
-                return chat;
-              })
- 
-          )
-        )
-      ).map(chats => {
-        chats.forEach(chat => {
-          const receiver = Meteor.users.findOne(chat.memberIds.find(memberId => memberId !== this.senderId))
+    
+    MeteorObservable.subscribe('chats').subscribe(() => {
+      MeteorObservable.autorun().subscribe(() => {
+        this.chats = Chats
+          .find({})
+          .mergeMap<Chat[]>(chats =>
+            Observable.combineLatest(
+              ...chats.map(chat =>
+              
+                Messages.find({ chatId: chat._id }, { sort: { createdAt: -1 }, limit: 1 })
+                  .startWith(null)
+                  .map(messages => {
+                    if (messages) chat.lastMessage = messages[0];
+                    return chat;
+                  })
+    
+              )
+            )
+          ).map(chats => {
+            chats.forEach(chat => {
+              const receiver = Meteor.users.findOne(chat.memberIds.find(memberId => memberId !== this.senderId))
 
-          chat.title = receiver.profile.name;
-          chat.picture = receiver.profile.picture;
-        });
+              chat.title = receiver.profile.name;
+              chat.picture = receiver.profile.picture;
+            });
 
-        return chats;
-      }).zone();
+            return chats;
+          }).zone();
+      });
+    });
   }
 
   addChat(): void {
-- 
2.9.3 (Apple Git-75)


From f6594bfcc4bd3cdb7d80f83ada95c40b9f91b394 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Tue, 11 Oct 2016 10:13:23 +0200
Subject: [PATCH 125/128] Step 7.17: Subscribe to 'users'

---
 client/imports/pages/chats/new-chat.component.ts | 6 ++++--
 1 file changed, 4 insertions(+), 2 deletions(-)

diff --git a/client/imports/pages/chats/new-chat.component.ts b/client/imports/pages/chats/new-chat.component.ts
index 83f1c7a..bf03180 100644
--- a/client/imports/pages/chats/new-chat.component.ts
+++ b/client/imports/pages/chats/new-chat.component.ts
@@ -31,8 +31,10 @@ export class NewChatComponent implements OnInit {
   }
 
   ngOnInit() {
-    MeteorObservable.autorun().zone().subscribe(() => {
-      this.users = this.findUsers().zone();
+    MeteorObservable.subscribe('users').subscribe(() => {
+      MeteorObservable.autorun().subscribe(() => {
+        this.users = this.findUsers().zone();
+      });
     });
   }
  
-- 
2.9.3 (Apple Git-75)


From f8ac3b26d393790a51c6979ac7760686fb4b34b0 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Tue, 11 Oct 2016 10:14:02 +0200
Subject: [PATCH 126/128] Step 7.18: Subscribe to 'messages'

---
 client/imports/pages/chat/messages-page.component.ts | 20 ++++++++++++--------
 1 file changed, 12 insertions(+), 8 deletions(-)

diff --git a/client/imports/pages/chat/messages-page.component.ts b/client/imports/pages/chat/messages-page.component.ts
index 5c5235f..f326f13 100644
--- a/client/imports/pages/chat/messages-page.component.ts
+++ b/client/imports/pages/chat/messages-page.component.ts
@@ -37,15 +37,19 @@ export class MessagesPage implements OnInit, OnDestroy {
   }
 
   ngOnInit() {
-    this.messages = Messages.find(
-      {chatId: this.selectedChat._id},
-      {sort: {createdAt: 1}}
-    ).map((messages: Message[]) => {
-      messages.forEach((message: Message) => {
-        message.ownership = this.senderId == message.senderId ? 'mine' : 'other';
-      });
+    MeteorObservable.subscribe('messages', this.selectedChat._id).subscribe(() => {
+      MeteorObservable.autorun().subscribe(() => {
+        this.messages = Messages.find(
+          {chatId: this.selectedChat._id},
+          {sort: {createdAt: 1}}
+        ).map((messages: Message[]) => {
+          messages.forEach((message: Message) => {
+            message.ownership = this.senderId == message.senderId ? 'mine' : 'other';
+          });
 
-      return messages;
+          return messages;
+        });
+      });
     });
 
     this.autoScroller = MeteorObservable.autorun().subscribe(() => {
-- 
2.9.3 (Apple Git-75)


From be6401d8fa7f2664606c75ff41b92d40d7170c18 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 14 Oct 2016 10:03:23 +0200
Subject: [PATCH 127/128] Step 7: Privacy and security

---
 steps/step7.md | 0
 1 file changed, 0 insertions(+), 0 deletions(-)
 create mode 100644 steps/step7.md

diff --git a/steps/step7.md b/steps/step7.md
new file mode 100644
index 0000000..e69de29
-- 
2.9.3 (Apple Git-75)


From 9277e6d818e326f7e6cfd7dbc4dbefbfff9ac105 Mon Sep 17 00:00:00 2001
From: Kamil Kisiela <kamil.kisiela@gmail.com>
Date: Fri, 14 Oct 2016 10:03:35 +0200
Subject: [PATCH 128/128] Step 8: Summary

---
 steps/step8.md | 0
 1 file changed, 0 insertions(+), 0 deletions(-)
 create mode 100644 steps/step8.md

diff --git a/steps/step8.md b/steps/step8.md
new file mode 100644
index 0000000..e69de29
-- 
2.9.3 (Apple Git-75)

